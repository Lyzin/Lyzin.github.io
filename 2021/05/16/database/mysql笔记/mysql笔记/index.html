<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL笔记 | 笔记小窝</title><meta name="keywords" content="MySQL"><meta name="author" content="刘阳"><meta name="copyright" content="刘阳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、mysql安装 推荐使用Docker安装mysql https:&#x2F;&#x2F;registry.hub.docker.com&#x2F;_&#x2F;mysql 黑马程序员 https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Kr4y1i7ru?spm_id_from&#x3D;333.999.0.0&amp;vd_source&#x3D;501c3f3a75e1512aa5b62c6a10d15">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL笔记">
<meta property="og:url" content="https://www.lynote.top/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="笔记小窝">
<meta property="og:description" content="一、mysql安装 推荐使用Docker安装mysql https:&#x2F;&#x2F;registry.hub.docker.com&#x2F;_&#x2F;mysql 黑马程序员 https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Kr4y1i7ru?spm_id_from&#x3D;333.999.0.0&amp;vd_source&#x3D;501c3f3a75e1512aa5b62c6a10d15">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.lynote.top/posts_cover_img/database/mysql_logo.png">
<meta property="article:published_time" content="2021-05-16T11:31:21.000Z">
<meta property="article:modified_time" content="2024-09-24T16:38:39.405Z">
<meta property="article:author" content="刘阳">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.lynote.top/posts_cover_img/database/mysql_logo.png"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="https://www.lynote.top/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-25 00:38:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 博客分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 文章标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 博客归档</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/posts_cover_img/database/mysql_logo.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">笔记小窝</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 博客分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 文章标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 博客归档</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-16T11:31:21.000Z" title="发表于 2021-05-16 19:31:21">2021-05-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-24T16:38:39.405Z" title="更新于 2024-09-25 00:38:39">2024-09-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL%E7%AC%94%E8%AE%B0/">MySQL笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、mysql安装"><a href="#一、mysql安装" class="headerlink" title="一、mysql安装"></a>一、mysql安装</h2><blockquote>
<p>推荐使用Docker安装mysql</p>
<p><a target="_blank" rel="noopener" href="https://registry.hub.docker.com/_/mysql">https://registry.hub.docker.com/_&#x2F;mysql</a></p>
<p>黑马程序员</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kr4y1i7ru?spm_id_from=333.999.0.0&vd_source=501c3f3a75e1512aa5b62c6a10d1550c">https://www.bilibili.com/video/BV1Kr4y1i7ru?spm_id_from&#x3D;333.999.0.0&amp;vd_source&#x3D;501c3f3a75e1512aa5b62c6a10d1550c</a></p>
</blockquote>
<h3 id="1、拉取mysql镜像"><a href="#1、拉取mysql镜像" class="headerlink" title="1、拉取mysql镜像"></a>1、拉取mysql镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取最新的mysql镜像</span></span><br><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>

<h3 id="2、创建mysql容器"><a href="#2、创建mysql容器" class="headerlink" title="2、创建mysql容器"></a>2、创建mysql容器</h3><h4 id="1-1-设置国内时区"><a href="#1-1-设置国内时区" class="headerlink" title="1.1 设置国内时区"></a>1.1 设置国内时区</h4><blockquote>
<p>时区参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/w8y56f/article/details/115445442">https://blog.csdn.net/w8y56f/article/details/115445442</a></p>
</blockquote>
<blockquote>
<p>因为mysql镜像里的时区默认是UTC时区，这样和国内就差了8个小时，所以为了后面创建了mysql容器能够获取时间和国内一致，所以需要提前修改时区</p>
<p>基于当前的mysql镜像创建一个支持国内时区的镜像，然后基于创建的镜像启动容器，就支持国内时区了</p>
</blockquote>
<h5 id="1-1-1-新镜像的DockerFile"><a href="#1-1-1-新镜像的DockerFile" class="headerlink" title="1.1.1 新镜像的DockerFile"></a>1.1.1 新镜像的DockerFile</h5><blockquote>
<p>下面镜像的DockerFile用来创建支持国内的时间的镜像，需要提前拉取<code>mysql:latest</code>镜像</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Desc: 用来构建自定义的Docker镜像</span></span><br><span class="line"><span class="comment"># Author: 刘阳</span></span><br><span class="line"><span class="comment"># Time: 2021-04-21 17:59:00</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础镜像，来自官方的centos7版本，默认的centos镜像是centos8版本</span></span><br><span class="line">FROM mysql:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础描述信息</span></span><br><span class="line">LABEL version=<span class="string">&quot;V1.0&quot;</span></span><br><span class="line">LABEL author=<span class="string">&quot;刘阳&quot;</span></span><br><span class="line">LABEL description=<span class="string">&quot;基础镜像来自官方mysql，设置时区为中国，然后编码方式为utf8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line">WORKDIR /root/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定执行命令的用户</span></span><br><span class="line">USER root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时区变量</span></span><br><span class="line">ENV TZ=<span class="string">&quot;Asia/Shanghai&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-用DockerFile创建镜像"><a href="#1-1-2-用DockerFile创建镜像" class="headerlink" title="1.1.2 用DockerFile创建镜像"></a>1.1.2 用DockerFile创建镜像</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 步骤一：创建一个目录，将上面的DockerFile内容复制进去，并且文件命名为Dockerfile</span></span><br><span class="line"><span class="comment"># 步骤二：当上面存放Dockerfile的文件目录下执行下面命令，后面的.(点)不能忘了，因为是用来关系上下文的</span></span><br><span class="line">docker build -t mysqlzh:v1.0 .</span><br><span class="line"><span class="comment"># 构建完成后查看镜像就有了支持国内时区的mysql镜像</span></span><br><span class="line">docker image <span class="built_in">ls</span> -a</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220711133734301.png" class="" title="image-20220711133734301.png">

<blockquote>
<p>到这里镜像创建完毕，就可以使用这个镜像开始创建<code>mysql</code>容器了</p>
</blockquote>
<h4 id="1-2-创建Mysql容器"><a href="#1-2-创建Mysql容器" class="headerlink" title="1.2 创建Mysql容器"></a>1.2 创建Mysql容器</h4><blockquote>
<p>使用新的<code>mysqlzh</code>镜像来创建<code>mysql</code>容器</p>
<p>字符序解释看这里：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lxyit/p/9359325.html">https://www.cnblogs.com/lxyit/p/9359325.html</a></p>
<p>docker的mysql容器配置文件映射：<a target="_blank" rel="noopener" href="https://www.jb51.net/server/321611iv8.htm">https://www.jb51.net/server/321611iv8.htm</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run  -dit -u root --name mysql -p 3306:3306 -v /home/ly/docker_volumn/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456  mysqlzh:v1.0 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name mysql 表示创建的容器名字是mysql</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-u root 表示容器的用户是root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 3306:3306 表示将容器的3306映射到宿主机的3306端口</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MYSQL_ROOT_PASSWORD后面跟的是数据库用户root的登录密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v /home/ly/docker_volumn/mysql:/var/lib/mysql 表示容器中数据存储的位置</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下面两个参数必须放到镜像名后面，如果创建容器时出现3306端口占用，需要先关掉端口被占用的程序，再来创建容器</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--character-set-server=utf8mb4 表示设置mysql字符集支持是utf-8编码，可以支持中文</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--collation-server=utf8mb4_unicode_ci 表示字符序（collation），定义了字符的比较规则</span></span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220711134149094.png" class="" title="image-20220711134149094.png">

<blockquote>
<p>从上图的Image的ID可以看出和使用DockerFile创建的镜像是同一个</p>
</blockquote>
<h4 id="1-3-mysql容器数据持久化"><a href="#1-3-mysql容器数据持久化" class="headerlink" title="1.3 mysql容器数据持久化"></a>1.3 mysql容器数据持久化</h4><blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/530d00f97cbf">https://www.jianshu.com/p/530d00f97cbf</a></p>
<p>持久化的作用：</p>
<ul>
<li>当没有mysql容器持久化，当mysql容器被删除或者故障时，对应的mysql里的数据也会随着mysql容器被删除</li>
<li>当mysql容器被删除或者故障时，可以快速启动另一个mysql容器，只需要将持久化的数据挂载到新的mysql容器上，就可以快速使用mysql</li>
</ul>
</blockquote>
<blockquote>
<p>mysql容器内的默认数据存储位置：</p>
<ul>
<li>mysql容器将容器内的<code>/var/lib/mysql</code>路径作为默认的volume挂载</li>
</ul>
</blockquote>
<blockquote>
<p>如何持久化？</p>
<ul>
<li>使用docker的逻辑卷功能，将宿主机的一个存储mysql数据的文件夹与容器内的<code>/var/lib/mysql</code>路径作为volume挂载</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -dit -u root --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456  mysqlzh:v1.0 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci </span><br></pre></td></tr></table></figure>

<h3 id="3、docker搭建mysql主从复制"><a href="#3、docker搭建mysql主从复制" class="headerlink" title="3、docker搭建mysql主从复制"></a>3、docker搭建mysql主从复制</h3><h4 id="1-1-搭建主mysql"><a href="#1-1-搭建主mysql" class="headerlink" title="1.1 搭建主mysql"></a>1.1 搭建主mysql</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -dit -u root --name master_mysql --net mysql-net -p 3308:3306 -v ~/mysql_docker/master_sql/conf:/etc/mysql/conf.d -v ~/mysql_docker/master_sql/logs:/logs -v ~/mysql_docker/master_sql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456  mysqlzh:v1.0 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>

<h4 id="1-2-搭建从mysql"><a href="#1-2-搭建从mysql" class="headerlink" title="1.2 搭建从mysql"></a>1.2 搭建从mysql</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -dit -u root --name slave_mysql --net mysql-net -p 3309:3306 -v ~/mysql_docker/slave_sql/conf:/etc/mysql/conf.d -v ~/mysql_docker/slave_sql/logs:/logs -v ~/mysql_docker/slave_sql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456  mysqlzh:v1.0 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>

<h3 id="4、命令行连接mysql"><a href="#4、命令行连接mysql" class="headerlink" title="4、命令行连接mysql"></a>4、命令行连接mysql</h3><h4 id="1-1-登录mysql"><a href="#1-1-登录mysql" class="headerlink" title="1.1 登录mysql"></a>1.1 登录mysql</h4><blockquote>
<p>可以使用<code>mycli</code>这个连接工具，安装以来python环境</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输入创建mysql容器时设置的root密码，就可以登录mysql中了</span></span><br><span class="line">mycli -h127.0.0.1 -uroot -p</span><br></pre></td></tr></table></figure>

<h4 id="1-2-查看时区"><a href="#1-2-查看时区" class="headerlink" title="1.2 查看时区"></a>1.2 查看时区</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like <span class="string">&#x27;%time_zone%&#x27;</span></span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220711141248016.png" class="" title="image-20220711141248016">

<blockquote>
<p>可以看到时区：</p>
<ul>
<li>system_time_zone是CST<ul>
<li>CST表示China Standard Time UT+8:00 中国标准时间</li>
</ul>
</li>
<li>time_zone 的值是SYSTEM<ul>
<li>表示跟system_time_zone取值一样，安装MySQL后默认就是SYSTEM，就是新镜像里设置的Asia&#x2F;Shanghai时间</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="1-3-查看字符集"><a href="#1-3-查看字符集" class="headerlink" title="1.3 查看字符集"></a>1.3 查看字符集</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like <span class="string">&#x27;%character%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220711140015891.png" class="" title="image-20220711140015891.png">

<blockquote>
<p>可以看到数据库都是utf8编码</p>
</blockquote>
<h3 id="5、SQL语法分类"><a href="#5、SQL语法分类" class="headerlink" title="5、SQL语法分类"></a>5、SQL语法分类</h3><table>
<thead>
<tr>
<th>分类</th>
<th>英文名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>Data Definition Language</td>
<td>数据定义语言，用来定义数据库对象，比如数据库、表、字段等</td>
</tr>
<tr>
<td>DML</td>
<td>Data Manipulation Language</td>
<td>数据库操作语言，对数据库表进行增删改</td>
</tr>
<tr>
<td>DQL</td>
<td>Data Query Language</td>
<td>数据库查询语言，对数据库表进行查询</td>
</tr>
<tr>
<td>DCL</td>
<td>Data Control Language</td>
<td>数据库控制语言，对数据库进行创建用户，分配访问权限</td>
</tr>
</tbody></table>
<h2 id="二、mysql基础"><a href="#二、mysql基础" class="headerlink" title="二、mysql基础"></a>二、mysql基础</h2><blockquote>
<p>老男孩 老郭</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1bJ411k7ET?p=27&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c">https://www.bilibili.com/video/BV1bJ411k7ET?p=27&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c</a></p>
</blockquote>
<blockquote>
<p>黑马程序员：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1vi4y137PN/?spm_id_from=333.999.0.0&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c">https://www.bilibili.com/video/BV1vi4y137PN/?spm_id_from=333.999.0.0&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1M541147Cn?p=9&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c">https://www.bilibili.com/video/BV1M541147Cn?p=9&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=4&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=4&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c</a></p>
<p>数据库调优</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1zJ411M7TB?p=4&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c">https://www.bilibili.com/video/BV1zJ411M7TB?p=4&amp;vd_source=501c3f3a75e1512aa5b62c6a10d1550c</a></p>
</blockquote>
<h3 id="1、数据库操作-DDL"><a href="#1、数据库操作-DDL" class="headerlink" title="1、数据库操作(DDL)"></a>1、数据库操作(DDL)</h3><h4 id="1-1-创建数据库"><a href="#1-1-创建数据库" class="headerlink" title="1.1 创建数据库"></a>1.1 创建数据库</h4><blockquote>
<ul>
<li>default character set utf8：<ul>
<li>数据库字符集，设置数据库的默认编码为utf8，utf8中间不要”-“</li>
</ul>
</li>
<li>default collate utf8_general_ci:<ul>
<li>数据库校对规则，ci是case insensitive的缩写，意思是大小写不敏感；</li>
<li>相对的是cs，即case sensitive，大小写敏感；</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MySQL root@localhost:(none)&gt; create database goods default utf8 collate utf8_general_ci;</span><br><span class="line">Query OK, 1 row affected</span><br><span class="line">Time: 0.062s</span><br></pre></td></tr></table></figure>

<h4 id="1-2-查看数据库"><a href="#1-2-查看数据库" class="headerlink" title="1.2 查看数据库"></a>1.2 查看数据库</h4><blockquote>
<p>查看数据库：show databases;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MySQL root@localhost:(none)&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+   |</span><br><span class="line">| information_schema |</span><br></pre></td></tr></table></figure>

<h4 id="1-2-使用数据库"><a href="#1-2-使用数据库" class="headerlink" title="1.2 使用数据库"></a>1.2 使用数据库</h4><blockquote>
<p>使用数据库：use 数据库名称</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MySQL root@localhost:(none)&gt; use goods;</span><br><span class="line">You are now connected to database &quot;goods&quot; as user &quot;root&quot;</span><br><span class="line">Time: 0.007s</span><br></pre></td></tr></table></figure>

<h4 id="1-4-删除数据库"><a href="#1-4-删除数据库" class="headerlink" title="1.4 删除数据库"></a>1.4 删除数据库</h4><blockquote>
<p>删除数据库：drop database 数据库名称</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MySQL root@localhost:goods&gt; drop database goods;</span><br><span class="line">You&#x27;re about to run a destructive command.</span><br><span class="line">Do you want to proceed? (y/n): y</span><br><span class="line">Your call!</span><br><span class="line">Query OK, 0 rows affected</span><br><span class="line">Time: 0.124s</span><br></pre></td></tr></table></figure>

<h3 id="2、数据表的操作"><a href="#2、数据表的操作" class="headerlink" title="2、数据表的操作"></a>2、数据表的操作</h3><h4 id="1-1-创建表"><a href="#1-1-创建表" class="headerlink" title="1.1 创建表"></a>1.1 创建表</h4><blockquote>
<p>创建表需要使用： <code>create table 表名</code>语句</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">	列名 类型,</span><br><span class="line">    列名 类型,</span><br><span class="line">    列名 类型</span><br><span class="line">) default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-1-建表语句注释"><a href="#1-1-1-建表语句注释" class="headerlink" title="1.1.1 建表语句注释"></a>1.1.1 建表语句注释</h5><blockquote>
<p>在建表语句中，两个<code>-</code>表示注释</p>
</blockquote>
<h5 id="1-1-2-not-null"><a href="#1-1-2-not-null" class="headerlink" title="1.1.2 not null"></a>1.1.2 not null</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- mysql中 not null 表示不允许为空</span><br><span class="line">create table m1(</span><br><span class="line">	name not null -- 表示name字段不可以为空</span><br><span class="line">)default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-1-null"><a href="#1-1-1-null" class="headerlink" title="1.1.1 null"></a>1.1.1 null</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- mysql中null表示允许为空</span><br><span class="line">create table m1(</span><br><span class="line">	name null -- 表示name字段可以为空</span><br><span class="line">)default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-4-default"><a href="#1-1-4-default" class="headerlink" title="1.1.4 default"></a>1.1.4 default</h5><blockquote>
<p>插入数据时，如果没有给该字段设置值，该字段的值就是设置的默认值</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table m1(</span><br><span class="line">	name default sam -- 表示name字段默认值是sam</span><br><span class="line">)default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-5-primary-key"><a href="#1-1-5-primary-key" class="headerlink" title="1.1.5 primary key"></a>1.1.5 primary key</h5><blockquote>
<p>主键的意思，不允许为空，不可以重复</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table m1(</span><br><span class="line">	id int primary key -- id是主键</span><br><span class="line">    name default sam -- 表示name字段默认值是sam</span><br><span class="line">)default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-6-auto-incremnet"><a href="#1-1-6-auto-incremnet" class="headerlink" title="1.1.6 auto_incremnet"></a>1.1.6 auto_incremnet</h5><blockquote>
<p>表示该字段的值会随着插入数据自己进行自增</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table m1(</span><br><span class="line">	id int primary key auto_increment -- id是主键且自增</span><br><span class="line">    name default sam -- 表示name字段默认值是sam</span><br><span class="line">)default charset=utf8; </span><br></pre></td></tr></table></figure>

<h4 id="1-2-查看所有表"><a href="#1-2-查看所有表" class="headerlink" title="1.2 查看所有表"></a>1.2 查看所有表</h4><blockquote>
<p>查看表需要经过两步</p>
<ul>
<li>第一步：进入数据库 use 数据库名称</li>
<li>第二步：查看数据库 show tables</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名称;</span><br><span class="line">show tables;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-删除表"><a href="#1-3-删除表" class="headerlink" title="1.3 删除表"></a>1.3 删除表</h4><h5 id="1-1-1-drop"><a href="#1-1-1-drop" class="headerlink" title="1.1.1 drop"></a>1.1.1 drop</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 会将表和表里的数据全部删除</span><br><span class="line">drop table 表名</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-delete"><a href="#1-1-2-delete" class="headerlink" title="1.1.2 delete"></a>1.1.2 delete</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 会将表里的数据全部删除，表仍然留着</span><br><span class="line">delete from 表名</span><br></pre></td></tr></table></figure>

<h5 id="1-1-3-truncate"><a href="#1-1-3-truncate" class="headerlink" title="1.1.3 truncate"></a>1.1.3 truncate</h5><blockquote>
<p>速度很快，不可回滚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 会将表里的数据全部删除，表仍然留着</span><br><span class="line">truncate table 表名</span><br></pre></td></tr></table></figure>

<h4 id="1-4-修改表"><a href="#1-4-修改表" class="headerlink" title="1.4 修改表"></a>1.4 修改表</h4><h5 id="1-1-1-添加列"><a href="#1-1-1-添加列" class="headerlink" title="1.1.1 添加列"></a>1.1.1 添加列</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 给表增加字段</span><br><span class="line">alter table 表名 add 列名 类型;</span><br><span class="line"></span><br><span class="line">-- 给表增加字段并设置默认值</span><br><span class="line">alter table 表名 add 列名 类型 default 默认值;</span><br><span class="line"></span><br><span class="line">-- 给表增加字段并设置默认值，且该列不能为空</span><br><span class="line">alter table 表名 add 列名 类型 not null default 默认值;</span><br><span class="line"></span><br><span class="line">-- 给表添加列指定位置</span><br><span class="line">-- 指定在第一个位置</span><br><span class="line">alter table 表名 add 列名 类型 default 默认值 first;</span><br><span class="line"></span><br><span class="line">-- 指定在某个字段后面: existing_column表示将新添加的列放在某个列后面，并且某个列必须存在</span><br><span class="line">alter table 表名 add 列名 类型 default 默认值 after existing_column; </span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-删除列"><a href="#1-1-2-删除列" class="headerlink" title="1.1.2 删除列"></a>1.1.2 删除列</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop column 列名;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-3-修改列的类型"><a href="#1-1-3-修改列的类型" class="headerlink" title="1.1.3 修改列的类型"></a>1.1.3 修改列的类型</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify column 列名 类型</span><br></pre></td></tr></table></figure>

<h5 id="1-1-4-修改列的类型和名称"><a href="#1-1-4-修改列的类型和名称" class="headerlink" title="1.1.4 修改列的类型和名称"></a>1.1.4 修改列的类型和名称</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 change 原列名 新列名 新类型;</span><br><span class="line"></span><br><span class="line">-- 下面语句时将tb1的原name列修改为username，并且给username设置了类型为varchar(32)</span><br><span class="line">alter table tb1 change name username varchar(32);</span><br></pre></td></tr></table></figure>

<h5 id="1-1-5-修改列的默认值"><a href="#1-1-5-修改列的默认值" class="headerlink" title="1.1.5 修改列的默认值"></a>1.1.5 修改列的默认值</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 alter 列名 set default 新默认值;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-6-删除列的默认值"><a href="#1-1-6-删除列的默认值" class="headerlink" title="1.1.6 删除列的默认值"></a>1.1.6 删除列的默认值</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 alter 列名 drop default;</span><br></pre></td></tr></table></figure>

<h4 id="2-5-表的字段类型"><a href="#2-5-表的字段类型" class="headerlink" title="2.5 表的字段类型"></a>2.5 表的字段类型</h4><blockquote>
<p>下面列出来的是经常用到的建表语句字段</p>
</blockquote>
<h5 id="1-1-1-int"><a href="#1-1-1-int" class="headerlink" title="1.1.1 int"></a>1.1.1 int</h5><blockquote>
<p>int表示整型</p>
<ul>
<li>int 表示有符号，取值范围<code>-2147483648 ~ 2147483648</code><ul>
<li>有符号表示可以为<code>负值</code></li>
</ul>
</li>
<li>int unsigned 表示无符号，取值范围<code>0 ~ 4294967295</code><ul>
<li>无符号表示必须是正整数，从0开始计数</li>
</ul>
</li>
<li>int(5)zerofill 仅用于显示，当不满足5位时，给左边补0<ul>
<li>比如02不满足五位，就会显示为：00002</li>
</ul>
</li>
<li>需要注意，当给字段设置类型后，超过了类型的范围，就会报<code>out of range value for column 列名</code>的错误</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table m1(</span><br><span class="line">	id int primary key  -- 表示id是一个int整数</span><br><span class="line">    name default sam</span><br><span class="line">)default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-tinyint"><a href="#1-1-2-tinyint" class="headerlink" title="1.1.2 tinyint"></a>1.1.2 tinyint</h5><blockquote>
<p>用来表示整型，不能范围比较小</p>
<ul>
<li>tinyint 表示有符号，取值范围<code>-128 ~ 127</code></li>
<li>tinyint unsigned 表示无符号，取值范围<code>0 ~ 255</code></li>
<li>tinyint(5)zerofill 和int使用一样</li>
</ul>
</blockquote>
<h5 id="1-1-3-bigint"><a href="#1-1-3-bigint" class="headerlink" title="1.1.3 bigint"></a>1.1.3 bigint</h5><blockquote>
<p>用来表示整型，范围更大</p>
<ul>
<li>bigint 表示有符号，取值范围<code>-922337203685477808 ~ 922337203685477808</code></li>
<li>bigint unsigned 表示无符号，取值范围<code>0 ~ 18446744073709551615</code></li>
<li>bigint(5)zerofill 和int使用一样</li>
</ul>
</blockquote>
<h5 id="1-1-4-decimal"><a href="#1-1-4-decimal" class="headerlink" title="1.1.4 decimal"></a>1.1.4 decimal</h5><blockquote>
<p>用来表示小数，准确的小数，decimal需要写两个值，第一个是数字总个数(总个数&#x3D;整数部分数字个数+小数部分数字个数)，第二个是小数点后的个数</p>
<ul>
<li><p>第一个数最大值是65</p>
<ul>
<li>如果有符号，不算进去</li>
</ul>
</li>
<li><p>第二个数最大值时30</p>
</li>
<li><p>如果插入数据时小数点的位数大于列的字段设置的值，那么对进行四舍五入</p>
</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table m1(</span><br><span class="line">	id int primary key  -- 表示id是一个int整数</span><br><span class="line">    price decimal(4, 2) -- 4表示price最多接收的数字个数，2表示小数点后的位数</span><br><span class="line">)default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-6-char"><a href="#1-1-6-char" class="headerlink" title="1.1.6 char"></a>1.1.6 char</h5><blockquote>
<ul>
<li>定长字符串，<code>char(m)</code>表示字符串的长度，最多可以容纳<code>255</code>个字符<ul>
<li>字符可以是一个英文字母，可以是一个汉字，只要满足设置的<code>m</code>长度，都可以被存进去</li>
</ul>
</li>
<li>定长理解<ul>
<li>存储固定字符长度的内容</li>
<li>即使内容长度小于m，也会占用<code>m</code>个长度，不够会用空格来补齐，但是查询时，会将空白自动去除</li>
<li>如果超过了<code>m</code>的长度，就会报错</li>
</ul>
</li>
</ul>
</blockquote>
<h5 id="1-1-7-varchar"><a href="#1-1-7-varchar" class="headerlink" title="1.1.7 varchar"></a>1.1.7 varchar</h5><blockquote>
<ul>
<li>可变长字符串，<code>varchar(m)</code>表示字符串的长度，最多可以容纳<code>65535</code>个字符</li>
<li>变长理解<ul>
<li>插入的值长度小于m，会按照真实数据长度存储</li>
<li>如果超过了<code>m</code>设置的值，就会报错</li>
</ul>
</li>
<li>这里可以借助<code>length</code>函数查询字段所占用的字符长度</li>
</ul>
</blockquote>
<h5 id="1-1-8-text"><a href="#1-1-8-text" class="headerlink" title="1.1.8 text"></a>1.1.8 text</h5><blockquote>
<p>用来保存变长的大字符串</p>
<p>用来存储文章、新闻才会用到</p>
</blockquote>
<h5 id="1-1-9-datetime"><a href="#1-1-9-datetime" class="headerlink" title="1.1.9 datetime"></a>1.1.9 datetime</h5><blockquote>
<p>用来表示时间日期，存储和取出的时间不做任何转换</p>
<p>范围：1000-01-01 00:00:00 到 9999-12-31 23:59:59</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">表示格式：YYYY-MM-DD HH:MM:SS</span><br><span class="line">比如： 2022-01-02 10:00:22</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MySQL root@localhost:goods&gt; create table user(</span><br><span class="line">                         -&gt;  id int not null auto_increment primary key,</span><br><span class="line">                         -&gt;  create_time datetime,</span><br><span class="line">                         -&gt;  update_time timestamp) default charset=utf8;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-10-timestamp"><a href="#1-1-10-timestamp" class="headerlink" title="1.1.10 timestamp"></a>1.1.10 timestamp</h5><blockquote>
<p>timestamp会把客户端时间插入的时间从当前时区转换为UTC时间进行存储，查询时又会将时间转换为客户端当前时区进行返回</p>
<ul>
<li>范围：1970-01-01 00:00:00 到 2037年</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MySQL root@localhost:goods&gt; create table user(</span><br><span class="line">                         -&gt;  id int not null auto_increment primary key,</span><br><span class="line">                         -&gt;  create_time datetime,</span><br><span class="line">                         -&gt;  update_time timestamp) default charset=utf8;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220807214513402.png" class="" title="image-20220807214513402">

<blockquote>
<p>从上面图中查看：</p>
<ul>
<li>create_time是datetime类型，update_time是timestamp类型</li>
</ul>
</blockquote>
<h5 id="1-1-11-current-timestamp"><a href="#1-1-11-current-timestamp" class="headerlink" title="1.1.11 current_timestamp"></a>1.1.11 current_timestamp</h5><blockquote>
<p>官网解释：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/timestamp-initialization.html">current_timestamp</a></p>
</blockquote>
<blockquote>
<p>下面来自官网的翻译</p>
<ul>
<li>TIMESTAMP或DATETIME列的定义可以为默认值和自动更新值都指定当前的时间戳，也可以为其中一个而不是另一个，或者两者都不指定。不同的列可以有不同的自动属性组合。下面的规则描述了这些可能性。</li>
<li>在DEFAULT CURRENT_TIMESTAMP和ON UPDATE CURRENT_TIMESTAMP这两种情况下，该列的默认值是当前的时间戳，并自动更新为当前的时间戳。</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t1 (</span><br><span class="line">  ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  dt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>timestamp<ul>
<li>表示该字段在插入和更新时都不会自动设置为当前时间。</li>
</ul>
</li>
<li>timestamp default current_timestamp<ul>
<li>字段插入时如果没有时间则自动设置为当前时间，更新没有变化。</li>
</ul>
</li>
<li>timestamp on update current_timestamp<ul>
<li>字段插入不会自动设置，字段更新时没有指定时间则自动设置为当前时间。</li>
</ul>
</li>
<li>default current_timestamp on update current_timestamp (常用)<ul>
<li>插入和修改字段时如果没有指定时间则会自动设置为当前时间</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>current_timestamp使用示例</p>
<ul>
<li>create_time默认是当前时间</li>
<li>update_time默认也是当前时间，但是当数据表数据有修改时，该字段会更新为修改的时间</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS `user_address`;</span><br><span class="line">CREATE TABLE `user_address` (</span><br><span class="line">    `id` int not null auto_increment comment &#x27;主键Id&#x27;,</span><br><span class="line">    `user_id` int not null comment &#x27;用户uid&#x27;,</span><br><span class="line">    `name` varchar(32) not null comment &#x27;用户名&#x27;,</span><br><span class="line">    `city` varchar(64) not null comment &#x27;城市&#x27;,</span><br><span class="line">    `create_time` timestamp not null default current_timestamp comment &#x27;创建时间&#x27;,</span><br><span class="line">    `update_time` timestamp not null default current_timestamp on update current_timestamp comment &#x27;更新时间&#x27;,</span><br><span class="line">    primary key(`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>

<h3 id="3-表数据的增删改"><a href="#3-表数据的增删改" class="headerlink" title="3 表数据的增删改"></a>3 表数据的增删改</h3><h4 id="1-1-新增数据"><a href="#1-1-新增数据" class="headerlink" title="1.1 新增数据"></a>1.1 新增数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 插入一条数据</span><br><span class="line">insert into 表名(列名,列名,列名) values(对应列的值,对应列的值,对应列的值);</span><br><span class="line"></span><br><span class="line">-- 插入多条数据</span><br><span class="line">insert into 表名(列名,列名,列名) values(对应列的值,对应列的值,对应列的值),(对应列的值,对应列的值,对应列的值);</span><br></pre></td></tr></table></figure>

<h4 id="2-删除数据"><a href="#2-删除数据" class="headerlink" title=".2 删除数据"></a>.2 删除数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 清空所有表数据</span><br><span class="line">delete from 表名</span><br><span class="line"></span><br><span class="line">-- 按条件删除数据</span><br><span class="line">delete from 表名 where 条件</span><br></pre></td></tr></table></figure>

<h4 id="3-更新数据"><a href="#3-更新数据" class="headerlink" title=".3 更新数据"></a>.3 更新数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 将表中该列全部修改为该值</span><br><span class="line">update 表名 set 列名=值;</span><br><span class="line"></span><br><span class="line">-- 修改多个列的值</span><br><span class="line">update 表名 set 列名=值,列名=值;</span><br><span class="line"></span><br><span class="line">-- 按照条件进行更新</span><br><span class="line">update 表名 set 列名=值 where 条件;</span><br></pre></td></tr></table></figure>

<h3 id="4、查询语句"><a href="#4、查询语句" class="headerlink" title="4、查询语句"></a>4、查询语句</h3><h4 id="1-1-查询所有数据"><a href="#1-1-查询所有数据" class="headerlink" title="1.1 查询所有数据"></a>1.1 查询所有数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看表里所有数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-条件查询语句"><a href="#1-2-条件查询语句" class="headerlink" title="1.2 条件查询语句"></a>1.2 条件查询语句</h4><blockquote>
<p>使用where与条件列表，可以进行条件查询</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 查询符合条件的所有数据</span><br><span class="line">select * from 表名 where 条件;</span><br><span class="line"></span><br><span class="line">-- 查询符合条件的列数据</span><br><span class="line">select 列名 from 表名 where 条件;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下面是支持的条件</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">比较运算符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&gt;</td>
<td align="center">大于</td>
</tr>
<tr>
<td align="center">&gt;&#x3D;</td>
<td align="center">大于等于</td>
</tr>
<tr>
<td align="center">&lt;</td>
<td align="center">小于</td>
</tr>
<tr>
<td align="center">&lt;&#x3D;</td>
<td align="center">小于等于</td>
</tr>
<tr>
<td align="center">&#x3D;</td>
<td align="center">等于</td>
</tr>
<tr>
<td align="center">&lt;&gt; 或 !&#x3D;</td>
<td align="center">不等于</td>
</tr>
<tr>
<td align="center">between  … AND …</td>
<td align="center">在某个范围，并且包含最小值和最大值</td>
</tr>
<tr>
<td align="center">IN (…)</td>
<td align="center">在in之后的列表中任选一个</td>
</tr>
<tr>
<td align="center">LIKE 占位符</td>
<td align="center">模糊匹配：_匹配单个字符 %模糊匹配</td>
</tr>
<tr>
<td align="center">IS NULL</td>
<td align="center">是NULL</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>逻辑运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AND 或 &amp;&amp;</td>
<td>且，多个条件都需要匹配才会查询到哦数据true</td>
</tr>
<tr>
<td>OR 或 ||</td>
<td>或，多个条件只要有一个满足就会查到数据</td>
</tr>
<tr>
<td>NOT 或 !</td>
<td>非，不满足条件</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 有下面一张表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_info` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;用户年龄&#x27;</span>,</span><br><span class="line">  `uid` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户UID&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">7</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="operator">=</span><span class="string">&#x27;用户信息表&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>user_center</code>表中数据如下</p>
</blockquote>
<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132051411.png" class="" title="image-20230417132051411">

<h5 id="1-1-1-大于和大于等于查询"><a href="#1-1-1-大于和大于等于查询" class="headerlink" title="1.1.1 大于和大于等于查询"></a>1.1.1 大于和大于等于查询</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="number">3</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="operator">&gt;=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132200930.png" class="" title="image-20230417132200930">

<h5 id="1-1-2-小于和小于等于查询"><a href="#1-1-2-小于和小于等于查询" class="headerlink" title="1.1.2 小于和小于等于查询"></a>1.1.2 小于和小于等于查询</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="operator">&lt;</span> <span class="number">3</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="operator">&lt;=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132258609.png" class="" title="image-20230417132258609">

<h5 id="1-1-3-等于和不等于查询"><a href="#1-1-3-等于和不等于查询" class="headerlink" title="1.1.3 等于和不等于查询"></a>1.1.3 等于和不等于查询</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132415653.png" class="" title="image-20230417132415653">

<blockquote>
<p>不等于符号<code>&lt;&gt;</code>可以想象成<code>&lt;</code>和<code>&gt;</code>的组合，当这两个拼接在一起，也就是表示既要大于还要小于，那就是不等于的意思</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="operator">!=</span> <span class="number">3</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="operator">&lt;&gt;</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132533059.png" class="" title="image-20230417132533059">

<h5 id="1-1-4-between范围查询"><a href="#1-1-4-between范围查询" class="headerlink" title="1.1.4 between范围查询"></a>1.1.4 between范围查询</h5><blockquote>
<p>使用between时，会将最小值和最大值的数据也查出来，比如下面的查询id在2和4之间的数据，可以看到将2和4这两条数据也查询出来了</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="keyword">between</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132749237.png" class="" title="image-20230417132749237">

<h5 id="1-1-5-in查询数据"><a href="#1-1-5-in查询数据" class="headerlink" title="1.1.5 in查询数据"></a>1.1.5 in查询数据</h5><blockquote>
<p>in查询数据会匹配列表中的数据</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_center <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">2</span>, <span class="number">13</span>, <span class="number">14</span>);</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132938126.png" class="" title="image-20230417132938126">

<h5 id="1-1-6-like模糊查询"><a href="#1-1-6-like模糊查询" class="headerlink" title="1.1.6 like模糊查询"></a>1.1.6 like模糊查询</h5><blockquote>
<p>单个字符匹配，只会匹配单个字符的数据，注意只是单个字符</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> name <span class="keyword">like</span> &quot;王_&quot;;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> name <span class="keyword">like</span> &quot;_敏&quot;;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417133133060.png" class="" title="image-20230417133133060">

<blockquote>
<ul>
<li><p>通配符：%，任意多个字符，包含0个字符</p>
</li>
<li><p>模糊匹配，匹配所有数据中都有<code>王</code>字的数据，该sql查询效率比较低，慎用</p>
</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> name <span class="keyword">like</span> &quot;%王%&quot;;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417133357950.png" class="" title="image-20230417133357950">

<h5 id="1-1-7-is-null查询"><a href="#1-1-7-is-null查询" class="headerlink" title="1.1.7 is null查询"></a>1.1.7 is null查询</h5><blockquote>
<p>注意&#x3D;或&lt;&gt;(不等于)不能判断是不是null值</p>
<ul>
<li><p>下面这两个可以来判断null值</p>
<ul>
<li><p>is null</p>
</li>
<li><p>is not null</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> name <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-8-逻辑运算-与"><a href="#1-1-8-逻辑运算-与" class="headerlink" title="1.1.8 逻辑运算-与"></a>1.1.8 逻辑运算-与</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> `id`<span class="operator">=</span><span class="number">3</span> <span class="keyword">and</span> `name`<span class="operator">=</span>&quot;王敏&quot;;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417133710924.png" class="" title="image-20230417133710924">

<h5 id="1-1-9-逻辑运算-或"><a href="#1-1-9-逻辑运算-或" class="headerlink" title="1.1.9 逻辑运算-或"></a>1.1.9 逻辑运算-或</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> `id`<span class="operator">=</span><span class="number">3</span> <span class="keyword">or</span> `id`<span class="operator">=</span><span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417133740500.png" class="" title="image-20230417133740500">



<h5 id="1-1-10-逻辑运算-非"><a href="#1-1-10-逻辑运算-非" class="headerlink" title="1.1.10 逻辑运算-非"></a>1.1.10 逻辑运算-非</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> `id`<span class="operator">!=</span><span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417133816275.png" class="" title="image-20230417133816275">

<h4 id="1-3-起别名"><a href="#1-3-起别名" class="headerlink" title="1.3 起别名"></a>1.3 起别名</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name as &quot;姓名&quot; from user_info;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-去重"><a href="#1-4-去重" class="headerlink" title="1.4 去重"></a>1.4 去重</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct uid from user_info;</span><br></pre></td></tr></table></figure>

<h4 id="1-5-号作用"><a href="#1-5-号作用" class="headerlink" title="1.5 +号作用"></a>1.5 +号作用</h4><blockquote>
<p>在mysql中，+号只有一个功能，做运算符</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 两个操作数都是数值型，则会进行加法运算</span><br><span class="line">select 100+90;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805100625454.png" class="" title="image-20240805100625454">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 其中一个数字为字符串型，则mysql会尝试将字符串型转为数值型，</span><br><span class="line">-- 转换成功，则字符串型数值会转为数值型，然后继续进行加法运算</span><br><span class="line">-- 转换失败，则字符串型数值会转为0，然后继续进行加法运算</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805100848140.png" class="" title="image-20240805100848140">

<h4 id="1-6-字符串拼接"><a href="#1-6-字符串拼接" class="headerlink" title="1.6 字符串拼接"></a>1.6 字符串拼接</h4><blockquote>
<p>使用concat函数拼接2个或多个字符串</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(&quot;alex &quot;, &quot;Luis&quot;);</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805120628170.png" class="" title="image-20240805120628170">

<h4 id="1-7、排序查询order-by"><a href="#1-7、排序查询order-by" class="headerlink" title="1.7、排序查询order by"></a>1.7、排序查询order by</h4><blockquote>
<p>order by [field] ASC  正向排序</p>
<p>order by [field] DESC  逆向排序</p>
<p>filed支持多个字段、表达式</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student order by student_id desc;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805161435868.png" class="" title="image-20240805161435868">

<h3 id="5、函数调用"><a href="#5、函数调用" class="headerlink" title="5、函数调用"></a>5、函数调用</h3><blockquote>
<p>函数是MySql内置的函数，可以用来快速实现一些功能</p>
</blockquote>
<h4 id="1-1-单行函数"><a href="#1-1-单行函数" class="headerlink" title="1.1 单行函数"></a>1.1 单行函数</h4><blockquote>
<p>如concat、length、ifnull、upper、lower等</p>
<ul>
<li>length统计个数时，需要关注当前mysql的字符集是什么，<ul>
<li>当为utf-8时，一个中文词表示3个字节，一个英文字母表示1个字节</li>
<li>当为gbk时，一个中文词表示2个字节</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select length(student_name) from student;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805162455180.png" class="" title="image-20240805162455180">

<h4 id="1-2-聚合函数"><a href="#1-2-聚合函数" class="headerlink" title="1.2 聚合函数"></a>1.2 聚合函数</h4><blockquote>
<ul>
<li><p>聚合函数主要是对数据进行处理，主要是将一列数据作为一个整体进行纵向计算</p>
<ul>
<li><p>比如获取数据的条数、最大、最小、平均值等</p>
</li>
<li><p>聚合函数是作用于某一列数据的，也就是数据库表的字段</p>
</li>
<li><p>需要注意的是字段有null值是不参与运算的</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>同样的表和数据使用第四小节查询语句的表数据</p>
</blockquote>
<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417132051411.png" class="" title="image-20230417132051411">

<h5 id="1-1-1-count函数"><a href="#1-1-1-count函数" class="headerlink" title="1.1.1 count函数"></a>1.1.1 count函数</h5><blockquote>
<ul>
<li>统计某一列的数量<ul>
<li><code>count(*)</code>是用来统计行数，当一行数据只要有一个字段不为null，都可以统计上，所以一般来讲会用到<code>count(*)</code></li>
<li>count(1)表示每一行都是1，所以把这些1都加起来来统计行数</li>
</ul>
</li>
</ul>
<p>INNODB存储引擎下，<code>count(*)</code>和<code>count(1)</code>效率差不多</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> user_info;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417231757271.png" class="" title="image-20230417231757271">

<h5 id="1-1-2-max函数"><a href="#1-1-2-max函数" class="headerlink" title="1.1.2 max函数"></a>1.1.2 max函数</h5><blockquote>
<p>求某一列的数据中的最大值</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(age) <span class="keyword">from</span> user_info;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417232009615.png" class="" title="image-20230417232009615">

<h5 id="1-1-3-min函数"><a href="#1-1-3-min函数" class="headerlink" title="1.1.3 min函数"></a>1.1.3 min函数</h5><blockquote>
<p>求某一列的数据中的最小值</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(age) <span class="keyword">from</span> user_info;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417232058161.png" class="" title="image-20230417232058161">

<h5 id="1-1-4-avg函数"><a href="#1-1-4-avg函数" class="headerlink" title="1.1.4 avg函数"></a>1.1.4 avg函数</h5><blockquote>
<p>求某一列的数据的平均值</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(age) <span class="keyword">from</span> user_info;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417231926598.png" class="" title="image-20230417231926598">

<h5 id="1-1-5-sum函数"><a href="#1-1-5-sum函数" class="headerlink" title="1.1.5 sum函数"></a>1.1.5 sum函数</h5><blockquote>
<p>对某一列数据进行求和</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(age) <span class="keyword">from</span> user_info;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230417232142484.png" class="" title="image-20230417232142484">

<blockquote>
<p>sum与distinct搭配</p>
<p>当使用sum求和时，可以用distinct去重，然后再求和</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sum(distinct course_id), sum(course_id) from score;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805164756726.png" class="" title="image-20240805164756726">

<h4 id="1-3-日期函数"><a href="#1-3-日期函数" class="headerlink" title="1.3 日期函数"></a>1.3 日期函数</h4><h5 id="1-1-1-当前系统日期与时间"><a href="#1-1-1-当前系统日期与时间" class="headerlink" title="1.1.1 当前系统日期与时间"></a>1.1.1 当前系统日期与时间</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select NOW();</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805163338565.png" class="" title="image-20240805163338565">

<h5 id="1-1-2-当前时间"><a href="#1-1-2-当前时间" class="headerlink" title="1.1.2 当前时间"></a>1.1.2 当前时间</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select curtime();</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805163437066.png" class="" title="image-20240805163437066">

<h5 id="1-1-3-获取年月日"><a href="#1-1-3-获取年月日" class="headerlink" title="1.1.3 获取年月日"></a>1.1.3 获取年月日</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 年</span><br><span class="line">select year(now());</span><br><span class="line"></span><br><span class="line">-- 月</span><br><span class="line">select month(now());</span><br><span class="line"></span><br><span class="line">-- 日</span><br><span class="line">select day(now());</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240805163555074.png" class="" title="image-20240805163555074">

<h3 id="6、分组查询"><a href="#6、分组查询" class="headerlink" title="6、分组查询"></a>6、分组查询</h3><blockquote>
<p>分组查询是指使用group by子句将表中的数据分为若干组</p>
<p>分组查询时一般都是要配合聚合函数来使用，即<code>5.2聚合函数</code>小节</p>
<p>与聚合函数一起查询的字段，必须是group by后跟的字段</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- name 与count()函数一起出现在select后面时，name字段必须是跟在group by后面的字段</span><br><span class="line">select count(score), name from student group by name;</span><br></pre></td></tr></table></figure>

<h4 id="1-1-分组查询特点"><a href="#1-1-分组查询特点" class="headerlink" title="1.1 分组查询特点"></a>1.1 分组查询特点</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分组查询的语法</span></span><br><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">group</span> <span class="keyword">by</span> 字段分组名 [<span class="keyword">having</span> 分组后过滤条件] </span><br></pre></td></tr></table></figure>

<blockquote>
<p>where和having的区别：</p>
<ul>
<li>执行时机不同：<ul>
<li>where是分组之前进行过滤，不满足where条件，不参与分组</li>
<li>having是在分组之后对结果进行过滤</li>
</ul>
</li>
<li>判断条件不同：<ul>
<li>where不能对聚合函数进行判断</li>
<li>having可以对聚合函数进行判断</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>下面是分组查询用的表以及数据</p>
</blockquote>
<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230518142100316.png" class="" title="image-20230518142100316">

<h4 id="1-1-分组查询示例1"><a href="#1-1-分组查询示例1" class="headerlink" title="1.1 分组查询示例1"></a>1.1 分组查询示例1</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 根据性别分组，统计男生、女生的数量</span></span><br><span class="line"><span class="keyword">select</span> gender,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20230518142116565.png" class="" title="image-20230518142116565">

<blockquote>
<p>编写sql上面问题的思路：</p>
<p>1、首先按照性别分组，那么就先写下面的语句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、然后是需要统计男生、女生的数量，那么需要对分组后的数据进行统计，很容易就联想到聚合函数的count函数</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br></pre></td></tr></table></figure>

<h3 id="7、表关系"><a href="#7、表关系" class="headerlink" title="7、表关系"></a>7、表关系</h3><blockquote>
<p>表关系有下面三种</p>
<ul>
<li>单表关系</li>
<li>一对多关系</li>
<li>多对多关系</li>
</ul>
</blockquote>
<h4 id="1-1-单表关系"><a href="#1-1-单表关系" class="headerlink" title="1.1 单表关系"></a>1.1 单表关系</h4><blockquote>
<p>单独一张表就可以存储数据，不需要其他表的数据</p>
</blockquote>
<h4 id="1-2-一对多表关系"><a href="#1-2-一对多表关系" class="headerlink" title="1.2 一对多表关系"></a>1.2 一对多表关系</h4><blockquote>
<p><code>一对多</code>需要两张表存储数据，并且两张表有<code>一对多</code>或<code>多对一</code>关系</p>
</blockquote>
<h5 id="1-1-1-创建表时添加外键约束"><a href="#1-1-1-创建表时添加外键约束" class="headerlink" title="1.1.1 创建表时添加外键约束"></a>1.1.1 创建表时添加外键约束</h5><blockquote>
<p>下面的depart表的id字段关联了employee表的depart_id字段，且depart表的id字段关联了employee表的多条数据</p>
<ul>
<li>比如depart的id等于1，关联了employee表的<code>sam</code>、<code>jam</code>两条数据，这就形成了一对多的表关系</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 部门表depart字段</span></span><br><span class="line">id  <span class="type">int</span></span><br><span class="line">depart_name <span class="type">varchar</span>(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表employee字段</span></span><br><span class="line">id  <span class="type">int</span></span><br><span class="line">name <span class="type">varchar</span>(<span class="number">32</span>)</span><br><span class="line">age <span class="type">int</span></span><br><span class="line">depart_id</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220809081143388.png" class="" title="image-20220809081143388">



<blockquote>
<ul>
<li><p>在一对多关系中，会给一对多关系中<code>多</code>的表添加一个**<code>外键约束</code>**，保证某一列的值必须是其它表中的特定已存在的值</p>
</li>
<li><p>如果在给<code>关系【多】</code>的表中插入数据时，如果关联字段插入时，在<code>关系【一】</code>的表里不存在时，就会报错</p>
</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面是depart表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> depart(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    depart_name <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">)<span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面是employee表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employee(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    depart_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    <span class="keyword">constraint</span> fk_employee_depart <span class="keyword">foreign</span> key (depart_id) <span class="keyword">references</span> depart(id) <span class="comment">-- 创建外键约束</span></span><br><span class="line">)<span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建外键约束语法</span></span><br><span class="line"><span class="keyword">constraint</span> fk_employee_depart <span class="keyword">foreign</span> key (depart_id) <span class="keyword">references</span> depart(id)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- constraint 约束</span></span><br><span class="line"><span class="comment">-- fk_employee_depart 表示外键的名字，是&quot;foreignkey_当前表名_需要被关联表名”格式</span></span><br><span class="line"><span class="comment">-- foreign key 表示外键</span></span><br><span class="line"><span class="comment">-- (depart_id) 表示当前表需要被外键约束的字段</span></span><br><span class="line"><span class="comment">-- references depart(id) 表示需要被关联的表和字段，格式：需要被关联表名(约束字段)</span></span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-表存在添加外键约束"><a href="#1-1-2-表存在添加外键约束" class="headerlink" title="1.1.2 表存在添加外键约束"></a>1.1.2 表存在添加外键约束</h5><blockquote>
<p>当表存在时，想要添加外键约束</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee <span class="keyword">add</span> <span class="keyword">constraint</span> fk_employee_depart <span class="keyword">foreign</span> key (depart_id) <span class="keyword">references</span> depart(id)</span><br></pre></td></tr></table></figure>

<h5 id="1-1-3-删除添加的外键约束"><a href="#1-1-3-删除添加的外键约束" class="headerlink" title="1.1.3 删除添加的外键约束"></a>1.1.3 删除添加的外键约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee <span class="keyword">drop</span> <span class="keyword">foreign</span> key fk_employee_depart;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- fk_employee_depart 是外键名字</span></span><br></pre></td></tr></table></figure>

<h5 id="1-1-4-外键约束示例"><a href="#1-1-4-外键约束示例" class="headerlink" title="1.1.4 外键约束示例"></a>1.1.4 外键约束示例</h5><blockquote>
<p>查看depart表和employee表语句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- depart表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `depart` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `depart_name` <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">-- employee表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `employee` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `depart_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `fk_employee_depart` (`depart_id`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_employee_depart` <span class="keyword">FOREIGN</span> KEY (`depart_id`) <span class="keyword">REFERENCES</span> `depart` (`id`) <span class="comment">-- 添加了外键约束</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">3</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220809084323004.png" class="" title="image-20220809084323004">



<blockquote>
<p>当depart表中存在id为1的数据时，给employee表插入数据，并且depart_id为1</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 先给depart表插入数据，并且id为1，因为是第一次插入数据，id默认从1开始</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> depart(depart_name) <span class="keyword">values</span>(&quot;研发&quot;);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再给employee表插入数据，指定depart_id为1</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employee(name, age, depart_id) <span class="keyword">values</span>(&quot;sam&quot;, <span class="number">21</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时depart表和employee表插入数据都没问题</span></span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220809084627766.png" class="" title="image-20220809084627766">

<blockquote>
<p>但给employee表插入数据时，指定depart_id为2，但是id为2的数据再depart表中不存在，就会提示插入数据错误</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employee(name, age, depart_id) <span class="keyword">values</span>(&quot;jam&quot;, <span class="number">22</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>会提示报错：(1452, ‘Cannot add or update a child row: a foreign key constraint fails (<code>lyuse</code>.<code>employee</code>, CONSTRAINT <code>fk_employee_depart</code> FOREIGN KEY (<code>depart_id</code>) REFERENCES <code>depart</code> (<code>id</code>))’)</li>
<li>翻译：(1452, ‘无法添加或更新子行：外键约束失败 (<code>lyuse</code>.<code>employee</code>, CONSTRAINT <code>fk_employee_depart</code> FOREIGN KEY (<code>depart_id</code>) REFERENCES <code>depart</code> (<code>id</code>)))</li>
</ul>
</blockquote>
<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220809084820490.png" class="" title="image-20220809084820490">

<h4 id="1-3-多对多表关系"><a href="#1-3-多对多表关系" class="headerlink" title="1.3 多对多表关系"></a>1.3 多对多表关系</h4><blockquote>
<p><code>多对多</code>需要三张表来存储数据，两张单表+关系表，创造出两个单表之间多对多关系</p>
</blockquote>
<h5 id="1-1-1-创建表时添加外键约束-1"><a href="#1-1-1-创建表时添加外键约束-1" class="headerlink" title="1.1.1 创建表时添加外键约束"></a>1.1.1 创建表时添加外键约束</h5><blockquote>
<p>下面的表</p>
<ul>
<li>course表是课程表，单表</li>
<li>student表是学生信息表，单标</li>
<li>class表是学生选课表，是关联表<ul>
<li>关联了学生id和课程id</li>
<li>其中既有学生id关联了多个课程id的数据</li>
<li>也有多个课程id关联了多个学生id的数据</li>
<li>这就形成了多对多的表关系</li>
</ul>
</li>
</ul>
</blockquote>
<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20220809085611898.png" class="" title="image-20220809085611898">

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- course表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `course` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `course_name` <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">-- stuudent表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- class表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `class` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `student_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `course_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">constraint</span> fk_class_student <span class="keyword">foreign</span> key (student_id) <span class="keyword">references</span> student(id), <span class="comment">-- 添加student表外键约束</span></span><br><span class="line">  <span class="keyword">constraint</span> fk_class_course <span class="keyword">foreign</span> key (couser_id) <span class="keyword">references</span> couser(id),  <span class="comment">-- 添加course表外键约束</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-表存在添加外键约束-1"><a href="#1-1-2-表存在添加外键约束-1" class="headerlink" title="1.1.2 表存在添加外键约束"></a>1.1.2 表存在添加外键约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> class <span class="keyword">add</span> <span class="keyword">constraint</span> fk_class_student <span class="keyword">foreign</span> key (student_id) <span class="keyword">references</span> student(id), <span class="comment">-- 添加student表外键约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> class <span class="keyword">add</span> <span class="keyword">constraint</span> fk_class_course <span class="keyword">foreign</span> key (couser_id) <span class="keyword">references</span> couser(id),  <span class="comment">-- 添加course表外键约束</span></span><br></pre></td></tr></table></figure>

<h5 id="1-1-3-删除添加的外键约束-1"><a href="#1-1-3-删除添加的外键约束-1" class="headerlink" title="1.1.3 删除添加的外键约束"></a>1.1.3 删除添加的外键约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> class <span class="keyword">drop</span> <span class="keyword">foreign</span> key fk_class_student;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> class <span class="keyword">drop</span> <span class="keyword">foreign</span> key fk_class_course;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-4-外键约束示例-1"><a href="#1-1-4-外键约束示例-1" class="headerlink" title="1.1.4 外键约束示例"></a>1.1.4 外键约束示例</h5><blockquote>
</blockquote>
<h2 id="三、Mysql进阶"><a href="#三、Mysql进阶" class="headerlink" title="三、Mysql进阶"></a>三、Mysql进阶</h2><h3 id="1、事务"><a href="#1、事务" class="headerlink" title="1、事务"></a>1、事务</h3><h4 id="1-1-事务介绍"><a href="#1-1-事务介绍" class="headerlink" title="1.1 事务介绍"></a>1.1 事务介绍</h4><blockquote>
<p>事务是一组操作的集合，是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败</p>
<ul>
<li>当开启事务后，如果出现异常，那么就会回滚事务，那就保证了数据的完整性和一致性</li>
</ul>
<p>Mysql的增删改会默认开启事务，也就是事务是自动提交的，当执行一条DML语句，那么Mysql就会立即隐式提交事务</p>
</blockquote>
<h4 id="1-2-事务操作"><a href="#1-2-事务操作" class="headerlink" title="1.2 事务操作"></a>1.2 事务操作</h4><blockquote>
<p>查看&#x2F;设置事务提交方式</p>
</blockquote>
<h5 id="1-1-1-查看事务提交状态"><a href="#1-1-1-查看事务提交状态" class="headerlink" title="1.1.1 查看事务提交状态"></a>1.1.1 查看事务提交状态</h5><blockquote>
<p>默认是开启事务的，所以查询结果是1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 查看事务</span><br><span class="line">select @@autocommit;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240919091810560.png" class="" title="image-20240919091810560">

<h5 id="1-1-2-开启手动事务"><a href="#1-1-2-开启手动事务" class="headerlink" title="1.1.2 开启手动事务"></a>1.1.2 开启手动事务</h5><blockquote>
<p>关闭自动事务提交，设置autocommit&#x3D;0就是关闭自动提交，开启为手动提交</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 设置为手动提交，禁用自动提交，从而允许手动控制事务的开始和结束</span><br><span class="line">set @@autocommit=0;</span><br><span class="line"></span><br><span class="line">-- 开启事务</span><br><span class="line">start transaction  或  begin</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提交事务</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commit;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>遇到执行sql出现问题，那就回滚事务</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rollback;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-事务四大特性ACID"><a href="#1-3-事务四大特性ACID" class="headerlink" title="1.3 事务四大特性ACID"></a>1.3 事务四大特性ACID</h4><h5 id="1-1-1-原子性-A"><a href="#1-1-1-原子性-A" class="headerlink" title="1.1.1 原子性-A"></a>1.1.1 原子性-A</h5><blockquote>
<p>原子性（Atomicity）：事务是不可分割的最小操作单元，要么全部成功，要么全部失败</p>
</blockquote>
<h5 id="1-1-2-一致性-C"><a href="#1-1-2-一致性-C" class="headerlink" title="1.1.2 一致性-C"></a>1.1.2 一致性-C</h5><blockquote>
<p>一致性（Consistency）：事务完成时，必须使所有的数据都保持一致状态</p>
</blockquote>
<h5 id="1-1-3-隔离性-I"><a href="#1-1-3-隔离性-I" class="headerlink" title="1.1.3 隔离性-I"></a>1.1.3 隔离性-I</h5><blockquote>
<p>隔离性（Isolation）：数据库系统提供的隔离机制，保证事务在不收外部并发操作影响的独立环境下运行</p>
<ul>
<li>有若干个并发事务，多个事务之间互相独立，比如A事务、B事务都对数据库有操作，那么A事务的操作不会对B事务有影响，是在独立环境下运行的</li>
</ul>
</blockquote>
<h5 id="1-1-4-持久性-D"><a href="#1-1-4-持久性-D" class="headerlink" title="1.1.4 持久性-D"></a>1.1.4 持久性-D</h5><blockquote>
<p>持久性（Durability）：事务一旦提交或回滚，对数据库中的数据的改变是永久的</p>
<ul>
<li>数据库中的数据是最终存储在磁盘中，那么就会永久保存下来</li>
</ul>
</blockquote>
<h4 id="1-4-并发事务问题"><a href="#1-4-并发事务问题" class="headerlink" title="1.4 并发事务问题"></a>1.4 并发事务问题</h4><blockquote>
<p>并发事务问题一般会出现在A事务、B事务同时操作某个数据库或某张表的问题，会有如下问题</p>
<ul>
<li>脏读</li>
<li>不可重复度</li>
<li>幻读</li>
</ul>
</blockquote>
<h5 id="1-1-1-脏读"><a href="#1-1-1-脏读" class="headerlink" title="1.1.1 脏读"></a>1.1.1 脏读</h5><blockquote>
<p>是指事务读到另一个事务还没提交的数据</p>
</blockquote>
<blockquote>
<p>假设有两个事务 A 和 B，数据库中的某个表 <code>users</code> 有一条记录 <code>id=1</code>，初始值为 <code>name=&#39;Alice&#39;</code>。</p>
</blockquote>
<blockquote>
<p><strong>事务 A：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 开始事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 读取 id=1 的数据</span><br><span class="line">SELECT name FROM users WHERE id = 1;  -- 返回 &#x27;Alice&#x27;</span><br><span class="line"></span><br><span class="line">-- 更新 id=1 的数据</span><br><span class="line">UPDATE users SET name = &#x27;Bob&#x27; WHERE id = 1;</span><br><span class="line"></span><br><span class="line">-- 此时事务 A 还没有提交</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>事务 B：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 开始事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 读取 id=1 的数据</span><br><span class="line">SELECT name FROM users WHERE id = 1;  -- 返回 &#x27;Bob&#x27;，即使事务 A 还没有提交</span><br><span class="line"></span><br><span class="line">-- 提交事务 B</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这个例子中，事务 B 读取到了事务 A 尚未提交的更新数据 <code>name=&#39;Bob&#39;</code>，这就是脏读。</p>
</blockquote>
<blockquote>
<p>如何解决脏读？</p>
<ul>
<li>脏读问题可以通过提高事务的隔离级别来解决。MySQL 提供了四种事务隔离级别：<ol>
<li><strong>READ UNCOMMITTED</strong>：最低的隔离级别，允许脏读、不可重复读和幻读。</li>
<li><strong>READ COMMITTED</strong>：不允许脏读，但允许不可重复读和幻读。<ol>
<li>隔离级别设置为 <code>READ COMMITTED</code>，那么事务 B 在读取数据时，只会读取到已经提交的数据，而不会读取到事务 A 尚未提交的数据。</li>
</ol>
</li>
<li><strong>REPEATABLE READ</strong>：不允许脏读和不可重复读，但允许幻读。</li>
<li><strong>SERIALIZABLE</strong>：最高的隔离级别，不允许脏读、不可重复读和幻读。</li>
</ol>
</li>
<li>还可以通过加锁来避免脏读。例如，使用 <code>SELECT ... FOR UPDATE</code> 或 <code>SELECT ... LOCK IN SHARE MODE</code> 来显式地锁定数据。</li>
</ul>
</blockquote>
<h5 id="1-1-2-不可重复读"><a href="#1-1-2-不可重复读" class="headerlink" title="1.1.2 不可重复读"></a>1.1.2 不可重复读</h5><blockquote>
<p>是指一个事务先后读取同一条记录，但两次读取的数据不同，称为不可重复读，这种情况通常发生在事务隔离级别较低的情况下，例如 <code>READ COMMITTED</code></p>
<p>核心理解：</p>
<ul>
<li>在一个事务中，两次读取<code>同一行</code>数据时，得到的结果不一致</li>
<li>是对同一条数据</li>
</ul>
</blockquote>
<blockquote>
<p>假设有两个事务 A 和 B，数据库中的某个表 <code>users</code> 有一条记录 <code>id=1</code>，初始值为 <code>name=&#39;Alice&#39;</code>。</p>
</blockquote>
<blockquote>
<p><strong>事务 A：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- 开始事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 读取 id=1 的数据</span><br><span class="line">SELECT name FROM users WHERE id = 1;  -- 返回 &#x27;Alice&#x27;</span><br><span class="line"></span><br><span class="line">-- 此时事务 A 还没有提交</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>事务 B：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 开始事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 更新 id=1 的数据</span><br><span class="line">UPDATE users SET name = &#x27;Bob&#x27; WHERE id = 1;</span><br><span class="line"></span><br><span class="line">-- 提交事务 B</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>事务 A：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 再次读取 id=1 的数据</span><br><span class="line">SELECT name FROM users WHERE id = 1;  -- 返回 &#x27;Bob&#x27;，因为事务 B 已经提交</span><br><span class="line"></span><br><span class="line">-- 提交事务 A</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这个例子中，事务 A 在第一次读取和第二次读取之间，事务 B 对 <code>id=1</code> 的数据进行了更新并提交，导致事务 A 两次读取的结果不一致，这就是不可重复读。</p>
</blockquote>
<blockquote>
<p>如何解决不可重复读？</p>
<ul>
<li>提高事务隔离级别（如 <code>REPEATABLE READ</code>）</li>
</ul>
</blockquote>
<h5 id="1-1-3-幻读"><a href="#1-1-3-幻读" class="headerlink" title="1.1.3 幻读"></a>1.1.3 幻读</h5><blockquote>
<p>一个事务按照提交查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在了，好像出现了”幻影“</p>
<p>核心理解：</p>
<ul>
<li>两次查询同一范围的数据时，得到的结果集不一致</li>
<li>是同一范围内的数据</li>
</ul>
</blockquote>
<blockquote>
<p>假设有两个事务 A 和 B，数据库中的某个表 <code>users</code> 有一条记录 <code>id=1</code>，初始值为 <code>name=&#39;Alice&#39;</code>。</p>
<p><strong>事务 A：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- 开始事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 查询所有数据</span><br><span class="line">SELECT * FROM users;  -- 返回一条记录 &#x27;Alice&#x27;</span><br><span class="line"></span><br><span class="line">-- 此时事务 A 还没有提交</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>事务 B：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 开始事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 插入一条新记录</span><br><span class="line">INSERT INTO users (id, name) VALUES (2, &#x27;Bob&#x27;);</span><br><span class="line"></span><br><span class="line">-- 提交事务 B</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>事务 A：</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 再次查询所有数据</span><br><span class="line">SELECT * FROM users;  -- 返回两条记录 &#x27;Alice&#x27; 和 &#x27;Bob&#x27;</span><br><span class="line"></span><br><span class="line">-- 提交事务 A</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这个例子中，事务 A 在第一次查询和第二次查询之间，事务 B 插入了一条新记录 <code>id=2</code>，导致事务 A 两次查询的结果集不一致，这就是幻读。</p>
</blockquote>
<blockquote>
<p>幻读解决？</p>
<ul>
<li>提高事务隔离级别（如 <code>SERIALIZABLE</code>），有效地避免幻读问题，确保数据的一致性和完整性，但是会带来性能的额外开销</li>
</ul>
</blockquote>
<h4 id="1-5-事务隔离级别"><a href="#1-5-事务隔离级别" class="headerlink" title="1.5 事务隔离级别"></a>1.5 事务隔离级别</h4><h5 id="1-1-查看当前事务隔离级别"><a href="#1-1-查看当前事务隔离级别" class="headerlink" title="1.1 查看当前事务隔离级别"></a>1.1 查看当前事务隔离级别</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@transaction_isolation;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240919091734650.png" class="" title="image-20240919091734650">

<h3 id="2、索引"><a href="#2、索引" class="headerlink" title="2、索引"></a>2、索引</h3><blockquote>
<ul>
<li><p>索引是帮助<code>Mysql高效获取数据</code>的数据结构（有序）</p>
</li>
<li><p>在数据之外，数据库系统还维护者满足特定查找算法的数据结构，这些数据结构以某种方式引用数据，这样就可以在数据结构实现高级查找算法，这种数据结构就是<code>索引</code></p>
</li>
</ul>
</blockquote>
<h4 id="1-1-无索引"><a href="#1-1-无索引" class="headerlink" title="1.1 无索引"></a>1.1 无索引</h4><blockquote>
<p>下面这条语句，即使查询到了id&#x3D;1，也会继续往下找，这就全表扫描</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where id = 1;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-索引分类"><a href="#1-2-索引分类" class="headerlink" title="1.2 索引分类"></a>1.2 索引分类</h4><h5 id="1-1-1-索引分类"><a href="#1-1-1-索引分类" class="headerlink" title="1.1.1 索引分类"></a>1.1.1 索引分类</h5><blockquote>
<p>主键索引</p>
<ul>
<li>针对表中主键创建的索引</li>
<li>默认自动创建，只能有一个</li>
<li>关键字：primary</li>
</ul>
<p>唯一索引</p>
<ul>
<li>避免同一个表中某个数据列中的数据重复</li>
<li>可以有多个</li>
<li>关键字：unique</li>
</ul>
<p>常规索引</p>
<ul>
<li>快速定位特定数据</li>
<li>可以有多个</li>
<li>关键字：无</li>
</ul>
<p>全文索引</p>
<ul>
<li>全文索引查找的是文本中的关键词，而不是比较索引中的值</li>
<li>可以有多个</li>
<li>关键字：fulltext</li>
</ul>
</blockquote>
<h5 id="1-1-2-InnoDB按存储分类"><a href="#1-1-2-InnoDB按存储分类" class="headerlink" title="1.1.2 InnoDB按存储分类"></a>1.1.2 InnoDB按存储分类</h5><blockquote>
<p>聚集索引</p>
<ul>
<li>将数据存储与索引放到一起，索引结构的叶子结点保存了行数据</li>
<li>特点：必须有，而且只有一个</li>
</ul>
<p>二级索引</p>
<ul>
<li>将数据域索引分开存储，索引结构的叶子结点关联的是对应的主键</li>
<li>特点：可以存在多个</li>
</ul>
</blockquote>
<blockquote>
<p>聚集索引选取规则：</p>
<ul>
<li>如果有主键，主键索引就是聚集索引</li>
<li>如果不存在主键，将使用第一个唯一(unique)索引作为聚集索引</li>
<li>如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowId作为隐藏的聚集索引</li>
</ul>
</blockquote>
<h4 id="1-3-索引语法"><a href="#1-3-索引语法" class="headerlink" title="1.3 索引语法"></a>1.3 索引语法</h4><h5 id="1-1-1-创建索引"><a href="#1-1-1-创建索引" class="headerlink" title="1.1.1 创建索引"></a>1.1.1 创建索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create [unique|fulltext] index index_name on table_name (index_col_name,...);</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-查看索引"><a href="#1-1-2-查看索引" class="headerlink" title="1.1.2 查看索引"></a>1.1.2 查看索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from table_name;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240923095239294.png" class="" title="image-20240923095239294">

<blockquote>
<p>可以看到</p>
<ul>
<li><p>Key_name：primary，表示主键ID</p>
</li>
<li><p>Index_type：BTREE的类型</p>
</li>
</ul>
</blockquote>
<h5 id="1-1-3-删除索引"><a href="#1-1-3-删除索引" class="headerlink" title="1.1.3 删除索引"></a>1.1.3 删除索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index index_name on table_name;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-索引实操"><a href="#1-4-索引实操" class="headerlink" title="1.4 索引实操"></a>1.4 索引实操</h4><h5 id="1-1-1-创建常规索引"><a href="#1-1-1-创建常规索引" class="headerlink" title="1.1.1 创建常规索引"></a>1.1.1 创建常规索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create index idx_user_name on user(user_name);</span><br><span class="line"></span><br><span class="line">-- 详细解释</span><br><span class="line">-- create 后的index是指这是创建常规索引索引，并且没有用[unique|fulltext]</span><br><span class="line">-- idx_user_name 是索引名称，idx是索引的简写，一般推荐都这么写，user_name是索引的字段，所以见到idx_user_name名就是表示给user_name字段加了索引，且索引名称叫idx_user_name</span><br><span class="line">-- on user(user_name) 是指给表里的哪个字段</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看索引</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from user;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240923101202627.png" class="" title="image-20240923101202627">

<blockquote>
<p>可以看到有两个索引</p>
<ul>
<li>id：唯一索引</li>
<li>idx_user_name：普通索引</li>
</ul>
</blockquote>
<h5 id="1-1-2-创建联合索引"><a href="#1-1-2-创建联合索引" class="headerlink" title="1.1.2 创建联合索引"></a>1.1.2 创建联合索引</h5><blockquote>
<p>联合索引就是多个字段创建的一个索引</p>
<p>注意：</p>
<ul>
<li>创建联合索引需要关注<code>字段顺序</code></li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_phone_gender_nickname on user(phone,gender,nickname);</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240923102349512.png" class="" title="image-20240923102349512">

<h5 id="1-1-3-删除索引-1"><a href="#1-1-3-删除索引-1" class="headerlink" title="1.1.3 删除索引"></a>1.1.3 删除索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index idx_user_name on `user`;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240923101308006.png" class="" title="image-20240923101308006">

<h4 id="1-5-SQL性能分析"><a href="#1-5-SQL性能分析" class="headerlink" title="1.5 SQL性能分析"></a>1.5 SQL性能分析</h4><h5 id="1-1-1-查看SQL执行频次"><a href="#1-1-1-查看SQL执行频次" class="headerlink" title="1.1.1 查看SQL执行频次"></a>1.1.1 查看SQL执行频次</h5><blockquote>
<p>SQL执行频率</p>
<p>Mysql客户端连接成功后，可以查看当前数据库的<code>insert</code>、<code>update</code>、<code>delete</code>、<code>select</code>的访问频率</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Com后面是7个下划线</span><br><span class="line">show global status like &#x27;Com_______&#x27;;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240923103810699.png" class="" title="image-20240923103810699">

<h4 id="1-6-慢查询日志"><a href="#1-6-慢查询日志" class="headerlink" title="1.6 慢查询日志"></a>1.6 慢查询日志</h4><blockquote>
<p>慢查询日志记录了所有执行时间超过指定参数(long_query_time，单位:秒，默认10秒)的所有SQL语句的日志</p>
<p>Mysql的慢查询日志默认没有开启，需要在Mysql的配置文件(&#x2F;etc&#x2F;my.cnf)中配置</p>
</blockquote>
<blockquote>
<p>查看慢查询日志开关</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;slow_query_log&#x27;;</span><br></pre></td></tr></table></figure>

<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240923104111906.png" class="" title="image-20240923104111906">

<blockquote>
<p>开启慢查询日志</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启慢查询日志查询开关</span></span><br><span class="line">slow_query_log=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置慢日志的时间2秒，SQL语句执行时间超过2秒，就会被视为慢查询，记录慢查询日志</span></span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在docker启动mysql中，将配置文件做逻辑卷映射出来，那么就可以在宿主机上配置额外的mysql配置</p>
<ol>
<li>创建一个新的配置文件，例如 <code>mycustom.cnf</code>。</li>
<li>添加所需的配置选项。</li>
<li>注意顶部一定要加[mysqld]这个节点</li>
<li>重启mysql</li>
</ol>
</blockquote>
<blockquote>
<p>示例配置文件 <code>mycustom.cnf</code> 内容：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># 开启慢查询日志查询开关</span><br><span class="line">slow_query_log=1</span><br><span class="line"></span><br><span class="line"># 设置慢日志的时间2秒，SQL语句执行时间超过2秒，就会被视为慢查询，记录慢查询日志</span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>再次查看慢查询日志已经打开了</p>
</blockquote>
<img src="/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/image-20240923105121877.png" class="" title="image-20240923105121877">



<h3 id="4、锁"><a href="#4、锁" class="headerlink" title="4、锁"></a>4、锁</h3><h4 id="1-1-锁的分类"><a href="#1-1-锁的分类" class="headerlink" title="1.1 锁的分类"></a>1.1 锁的分类</h4><blockquote>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制，在数据库中，除传统的计算机资源（CPU、RAM、I&#x2F;O）的征用意外，数据也是一种供许多用户共享的资源，如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是数据库并发访问性能的一个重要因数。从这个角度来说，锁对数据库而言显得尤为重要</p>
</blockquote>
<blockquote>
<p>Mysql的锁分类</p>
<ul>
<li>全局锁<ul>
<li>锁定数据库中的所有表</li>
</ul>
</li>
<li>表级锁<ul>
<li>每次操作锁住整张表</li>
</ul>
</li>
<li>行级锁<ul>
<li>每次操作锁住对应的行数据</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="1-2-全局锁"><a href="#1-2-全局锁" class="headerlink" title="1.2 全局锁"></a>1.2 全局锁</h4><blockquote>
<p>全局锁是对整个数据库实例加锁，加锁以后整个实例就处于只读状态，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都会被阻塞</p>
<p>典型的使用场景是做<code>全库的逻辑备份</code>，对所有的表进行锁定，从而获取一致性视图，保证数据的完整性</p>
</blockquote>
<h5 id="1-1-1-未加锁使用场景"><a href="#1-1-1-未加锁使用场景" class="headerlink" title="1.1.1 未加锁使用场景"></a>1.1.1 未加锁使用场景</h5><blockquote>
<p>有三张表tb_stock、tb_order、tb_orderlog 举例：</p>
<ul>
<li>备份tb_stock表的时候，出现业务扣减库存、生成订单</li>
<li>备份tb_order表的时候，出现业务插入订单日志</li>
<li>备份tb_orderlog表</li>
</ul>
<p>上面的备份数据操作，是不能保证<code>数据的一致性</code>，因为在备份的还有业务数据在写入中，那么这份数据是没有的</p>
</blockquote>
<h5 id="1-1-2-加锁使用场景"><a href="#1-1-2-加锁使用场景" class="headerlink" title="1.1.2 加锁使用场景"></a>1.1.2 加锁使用场景</h5><blockquote>
<p>使用mysqldump时加锁，然后再进行备份，</p>
<p>但是加了全局锁是可以实现查询语句的，但是不能写入</p>
</blockquote>
<h5 id="1-1-3-全局锁语句"><a href="#1-1-3-全局锁语句" class="headerlink" title="1.1.3 全局锁语句"></a>1.1.3 全局锁语句</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush tables with read lock;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-表级锁"><a href="#1-3-表级锁" class="headerlink" title="1.3 表级锁"></a>1.3 表级锁</h4><blockquote>
<p>表级锁每次操作锁住整张表，锁定粒度大，发生所冲突的概率最高，并发度最低，应用在MyISAM&#x2F;InnoDB&#x2F;BDB等存储引擎中</p>
<p>对于表级锁又可以分为：</p>
<ul>
<li>表锁</li>
<li>元数据锁</li>
<li>意向锁</li>
</ul>
</blockquote>
<h5 id="1-1-1-表锁"><a href="#1-1-1-表锁" class="headerlink" title="1.1.1 表锁"></a>1.1.1 表锁</h5><blockquote>
<p>表锁分为：</p>
<ul>
<li>表共享读锁（read lock）</li>
<li>表独占写锁（write lock）</li>
</ul>
</blockquote>
<blockquote>
<p>语法：</p>
<ul>
<li>加锁：lock tables 表名… read&#x2F;write<ul>
<li>这里的表明可以一次锁定单个、多个表</li>
</ul>
</li>
<li>释放锁：unlock tables</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 加读锁，只能读，不能写</span><br><span class="line">lock tables xxx read;</span><br><span class="line"></span><br><span class="line"># 客户端断开连接</span><br><span class="line">unlock tables</span><br></pre></td></tr></table></figure>

<h4 id="1-4-行级锁"><a href="#1-4-行级锁" class="headerlink" title="1.4 行级锁"></a>1.4 行级锁</h4><blockquote>
<p>行级锁，每次操作锁住对应的行数据。锁定粒度最小，发生锁冲突的概率最低，并发度最高，应用在InnoDB存储引擎中</p>
<p>InnoDB数据是基于索引组织的，行锁是通过对索引上的索引项加锁来实现的，而不是对记录加的锁。对于行级锁，主要分为以下三类：</p>
<ul>
<li>行锁（Record Lock）：锁定单个行记录的锁，防止其他事务对此进行update和delete，在RC、RR隔离级别下都支持</li>
<li>间隙锁（Gap Lock）：锁定索引记录间隙（不含该记录），确保索引记录间隙不变，防止其他事务在这个间隙进行insert产生幻读，在RR隔离级别下都支持</li>
<li>临键锁（Next-Key Lock）：行锁和间隙锁组合，同时锁住数据，病锁住数据前面的间隙Gap，在RR隔离级别下支持</li>
</ul>
</blockquote>
<h5 id="1-1-1-行锁"><a href="#1-1-1-行锁" class="headerlink" title="1.1.1 行锁"></a>1.1.1 行锁</h5></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.lynote.top">刘阳</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.lynote.top/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/">https://www.lynote.top/2021/05/16/database/mysql%E7%AC%94%E8%AE%B0/mysql%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.lynote.top" target="_blank">笔记小窝</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="/posts_cover_img/database/mysql_logo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/05/16/database/redis%E7%AC%94%E8%AE%B0/redis%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="/posts_cover_img/database/redis_logo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Redis笔记</div></div></a></div><div class="next-post pull-right"><a href="/2021/05/16/golang/go_mysql%E4%BD%BF%E7%94%A8/go_mysql%E4%BD%BF%E7%94%A8/"><img class="next-cover" src="/posts_cover_img/golang/go_mysql.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Go Mysql笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/05/16/golang/go_mysql%E4%BD%BF%E7%94%A8/go_mysql%E4%BD%BF%E7%94%A8/" title="Go Mysql笔记"><img class="cover" src="/posts_cover_img/golang/go_mysql.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="title">Go Mysql笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">刘阳</div><div class="author-info__description">学习与记录</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lyzin"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81mysql%E5%AE%89%E8%A3%85"><span class="toc-text">一、mysql安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%8B%89%E5%8F%96mysql%E9%95%9C%E5%83%8F"><span class="toc-text">1、拉取mysql镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BAmysql%E5%AE%B9%E5%99%A8"><span class="toc-text">2、创建mysql容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%AE%BE%E7%BD%AE%E5%9B%BD%E5%86%85%E6%97%B6%E5%8C%BA"><span class="toc-text">1.1 设置国内时区</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E6%96%B0%E9%95%9C%E5%83%8F%E7%9A%84DockerFile"><span class="toc-text">1.1.1 新镜像的DockerFile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E7%94%A8DockerFile%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-text">1.1.2 用DockerFile创建镜像</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%88%9B%E5%BB%BAMysql%E5%AE%B9%E5%99%A8"><span class="toc-text">1.2 创建Mysql容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-mysql%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">1.3 mysql容器数据持久化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81docker%E6%90%AD%E5%BB%BAmysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">3、docker搭建mysql主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%90%AD%E5%BB%BA%E4%B8%BBmysql"><span class="toc-text">1.1 搭建主mysql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%90%AD%E5%BB%BA%E4%BB%8Emysql"><span class="toc-text">1.2 搭建从mysql</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%BF%9E%E6%8E%A5mysql"><span class="toc-text">4、命令行连接mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%99%BB%E5%BD%95mysql"><span class="toc-text">1.1 登录mysql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9F%A5%E7%9C%8B%E6%97%B6%E5%8C%BA"><span class="toc-text">1.2 查看时区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%9F%A5%E7%9C%8B%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="toc-text">1.3 查看字符集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81SQL%E8%AF%AD%E6%B3%95%E5%88%86%E7%B1%BB"><span class="toc-text">5、SQL语法分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81mysql%E5%9F%BA%E7%A1%80"><span class="toc-text">二、mysql基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-DDL"><span class="toc-text">1、数据库操作(DDL)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">1.1 创建数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">1.2 查看数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">1.2 使用数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">1.4 删除数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">2、数据表的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-text">1.1 创建表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5%E6%B3%A8%E9%87%8A"><span class="toc-text">1.1.1 建表语句注释</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-not-null"><span class="toc-text">1.1.2 not null</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-null"><span class="toc-text">1.1.1 null</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-default"><span class="toc-text">1.1.4 default</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-5-primary-key"><span class="toc-text">1.1.5 primary key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-6-auto-incremnet"><span class="toc-text">1.1.6 auto_incremnet</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E8%A1%A8"><span class="toc-text">1.2 查看所有表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-text">1.3 删除表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-drop"><span class="toc-text">1.1.1 drop</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-delete"><span class="toc-text">1.1.2 delete</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-truncate"><span class="toc-text">1.1.3 truncate</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-text">1.4 修改表</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E6%B7%BB%E5%8A%A0%E5%88%97"><span class="toc-text">1.1.1 添加列</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E5%88%A0%E9%99%A4%E5%88%97"><span class="toc-text">1.1.2 删除列</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E4%BF%AE%E6%94%B9%E5%88%97%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">1.1.3 修改列的类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-%E4%BF%AE%E6%94%B9%E5%88%97%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%90%8D%E7%A7%B0"><span class="toc-text">1.1.4 修改列的类型和名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-5-%E4%BF%AE%E6%94%B9%E5%88%97%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">1.1.5 修改列的默认值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-6-%E5%88%A0%E9%99%A4%E5%88%97%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">1.1.6 删除列的默认值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E8%A1%A8%E7%9A%84%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.5 表的字段类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-int"><span class="toc-text">1.1.1 int</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-tinyint"><span class="toc-text">1.1.2 tinyint</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-bigint"><span class="toc-text">1.1.3 bigint</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-decimal"><span class="toc-text">1.1.4 decimal</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-6-char"><span class="toc-text">1.1.6 char</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-7-varchar"><span class="toc-text">1.1.7 varchar</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-8-text"><span class="toc-text">1.1.8 text</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-9-datetime"><span class="toc-text">1.1.9 datetime</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-10-timestamp"><span class="toc-text">1.1.10 timestamp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-11-current-timestamp"><span class="toc-text">1.1.11 current_timestamp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-text">3 表数据的增删改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="toc-text">1.1 新增数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-text">.2 删除数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-text">.3 更新数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-text">4、查询语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE"><span class="toc-text">1.1 查询所有数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-text">1.2 条件查询语句</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%A4%A7%E4%BA%8E%E5%92%8C%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1.1 大于和大于等于查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E5%B0%8F%E4%BA%8E%E5%92%8C%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1.2 小于和小于等于查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E7%AD%89%E4%BA%8E%E5%92%8C%E4%B8%8D%E7%AD%89%E4%BA%8E%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1.3 等于和不等于查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-between%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1.4 between范围查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-5-in%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-text">1.1.5 in查询数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-6-like%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1.6 like模糊查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-7-is-null%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1.7 is null查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-8-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97-%E4%B8%8E"><span class="toc-text">1.1.8 逻辑运算-与</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-9-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97-%E6%88%96"><span class="toc-text">1.1.9 逻辑运算-或</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-10-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97-%E9%9D%9E"><span class="toc-text">1.1.10 逻辑运算-非</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E8%B5%B7%E5%88%AB%E5%90%8D"><span class="toc-text">1.3 起别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%8E%BB%E9%87%8D"><span class="toc-text">1.4 去重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E5%8F%B7%E4%BD%9C%E7%94%A8"><span class="toc-text">1.5 +号作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-text">1.6 字符串拼接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7%E3%80%81%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2order-by"><span class="toc-text">1.7、排序查询order by</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-text">5、函数调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-text">1.1 单行函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-text">1.2 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-count%E5%87%BD%E6%95%B0"><span class="toc-text">1.1.1 count函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-max%E5%87%BD%E6%95%B0"><span class="toc-text">1.1.2 max函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-min%E5%87%BD%E6%95%B0"><span class="toc-text">1.1.3 min函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-avg%E5%87%BD%E6%95%B0"><span class="toc-text">1.1.4 avg函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-5-sum%E5%87%BD%E6%95%B0"><span class="toc-text">1.1.5 sum函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-text">1.3 日期函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4"><span class="toc-text">1.1.1 当前系统日期与时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4"><span class="toc-text">1.1.2 当前时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E8%8E%B7%E5%8F%96%E5%B9%B4%E6%9C%88%E6%97%A5"><span class="toc-text">1.1.3 获取年月日</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-text">6、分组查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E7%89%B9%E7%82%B9"><span class="toc-text">1.1 分组查询特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B1"><span class="toc-text">1.1 分组查询示例1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">7、表关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%8D%95%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">1.1 单表关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%B8%80%E5%AF%B9%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">1.2 一对多表关系</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-text">1.1.1 创建表时添加外键约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E8%A1%A8%E5%AD%98%E5%9C%A8%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-text">1.1.2 表存在添加外键约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E5%88%A0%E9%99%A4%E6%B7%BB%E5%8A%A0%E7%9A%84%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-text">1.1.3 删除添加的外键约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F%E7%A4%BA%E4%BE%8B"><span class="toc-text">1.1.4 外键约束示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">1.3 多对多表关系</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F-1"><span class="toc-text">1.1.1 创建表时添加外键约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E8%A1%A8%E5%AD%98%E5%9C%A8%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F-1"><span class="toc-text">1.1.2 表存在添加外键约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E5%88%A0%E9%99%A4%E6%B7%BB%E5%8A%A0%E7%9A%84%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F-1"><span class="toc-text">1.1.3 删除添加的外键约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F%E7%A4%BA%E4%BE%8B-1"><span class="toc-text">1.1.4 外键约束示例</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Mysql%E8%BF%9B%E9%98%B6"><span class="toc-text">三、Mysql进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BA%8B%E5%8A%A1"><span class="toc-text">1、事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.1 事务介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-text">1.2 事务操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E6%9F%A5%E7%9C%8B%E4%BA%8B%E5%8A%A1%E6%8F%90%E4%BA%A4%E7%8A%B6%E6%80%81"><span class="toc-text">1.1.1 查看事务提交状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E5%BC%80%E5%90%AF%E6%89%8B%E5%8A%A8%E4%BA%8B%E5%8A%A1"><span class="toc-text">1.1.2 开启手动事务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E4%BA%8B%E5%8A%A1%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7ACID"><span class="toc-text">1.3 事务四大特性ACID</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%8E%9F%E5%AD%90%E6%80%A7-A"><span class="toc-text">1.1.1 原子性-A</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E4%B8%80%E8%87%B4%E6%80%A7-C"><span class="toc-text">1.1.2 一致性-C</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E9%9A%94%E7%A6%BB%E6%80%A7-I"><span class="toc-text">1.1.3 隔离性-I</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-%E6%8C%81%E4%B9%85%E6%80%A7-D"><span class="toc-text">1.1.4 持久性-D</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-text">1.4 并发事务问题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E8%84%8F%E8%AF%BB"><span class="toc-text">1.1.1 脏读</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-text">1.1.2 不可重复读</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E5%B9%BB%E8%AF%BB"><span class="toc-text">1.1.3 幻读</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">1.5 事务隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">1.1 查看当前事务隔离级别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%B4%A2%E5%BC%95"><span class="toc-text">2、索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%97%A0%E7%B4%A2%E5%BC%95"><span class="toc-text">1.1 无索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-text">1.2 索引分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-text">1.1.1 索引分类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-InnoDB%E6%8C%89%E5%AD%98%E5%82%A8%E5%88%86%E7%B1%BB"><span class="toc-text">1.1.2 InnoDB按存储分类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-text">1.3 索引语法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">1.1.1 创建索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-text">1.1.2 查看索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text">1.1.3 删除索引</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E7%B4%A2%E5%BC%95%E5%AE%9E%E6%93%8D"><span class="toc-text">1.4 索引实操</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%88%9B%E5%BB%BA%E5%B8%B8%E8%A7%84%E7%B4%A2%E5%BC%95"><span class="toc-text">1.1.1 创建常规索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E5%88%9B%E5%BB%BA%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-text">1.1.2 创建联合索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95-1"><span class="toc-text">1.1.3 删除索引</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-SQL%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-text">1.5 SQL性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E6%9F%A5%E7%9C%8BSQL%E6%89%A7%E8%A1%8C%E9%A2%91%E6%AC%A1"><span class="toc-text">1.1.1 查看SQL执行频次</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">1.6 慢查询日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E9%94%81"><span class="toc-text">4、锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">1.1 锁的分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-text">1.2 全局锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E6%9C%AA%E5%8A%A0%E9%94%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">1.1.1 未加锁使用场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E5%8A%A0%E9%94%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">1.1.2 加锁使用场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E5%85%A8%E5%B1%80%E9%94%81%E8%AF%AD%E5%8F%A5"><span class="toc-text">1.1.3 全局锁语句</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-text">1.3 表级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E8%A1%A8%E9%94%81"><span class="toc-text">1.1.1 表锁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-text">1.4 行级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E8%A1%8C%E9%94%81"><span class="toc-text">1.1.1 行锁</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/28/java/Mybatis%E4%BD%BF%E7%94%A8/Mybatis%E4%BD%BF%E7%94%A8/" title="Mybatis使用"><img src="/img/index.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mybatis使用"/></a><div class="content"><a class="title" href="/2024/09/28/java/Mybatis%E4%BD%BF%E7%94%A8/Mybatis%E4%BD%BF%E7%94%A8/" title="Mybatis使用">Mybatis使用</a><time datetime="2024-09-27T18:33:26.000Z" title="发表于 2024-09-28 02:33:26">2024-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/28/java/Maven%E4%BD%BF%E7%94%A8/Maven%E4%BD%BF%E7%94%A8/" title="Maven使用"><img src="/source/posts_cover_img/java/maven-logo-black-on-white.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Maven使用"/></a><div class="content"><a class="title" href="/2024/09/28/java/Maven%E4%BD%BF%E7%94%A8/Maven%E4%BD%BF%E7%94%A8/" title="Maven使用">Maven使用</a><time datetime="2024-09-27T18:23:10.000Z" title="发表于 2024-09-28 02:23:10">2024-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/22/java/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" title="Java基础语法"><img src="/posts_cover_img/java/java_logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java基础语法"/></a><div class="content"><a class="title" href="/2024/09/22/java/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" title="Java基础语法">Java基础语法</a><time datetime="2024-09-22T07:08:33.000Z" title="发表于 2024-09-22 15:08:33">2024-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/17/golang/kafka%E4%BD%BF%E7%94%A8/kafka%E4%BD%BF%E7%94%A8/" title="kafka使用"><img src="/posts_cover_img/golang/kafka_logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kafka使用"/></a><div class="content"><a class="title" href="/2024/09/17/golang/kafka%E4%BD%BF%E7%94%A8/kafka%E4%BD%BF%E7%94%A8/" title="kafka使用">kafka使用</a><time datetime="2024-09-17T01:48:14.000Z" title="发表于 2024-09-17 09:48:14">2024-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/11/golang/elasticsearch/elasticsearch%E4%BD%BF%E7%94%A8/" title="elasticsearch使用"><img src="/posts_cover_img/golang/elastic.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="elasticsearch使用"/></a><div class="content"><a class="title" href="/2024/09/11/golang/elasticsearch/elasticsearch%E4%BD%BF%E7%94%A8/" title="elasticsearch使用">elasticsearch使用</a><time datetime="2024-09-11T05:49:03.000Z" title="发表于 2024-09-11 13:49:03">2024-09-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/posts_cover_img/database/mysql_logo.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By 刘阳</div><div class="footer_custom_text">努力终会有回报</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="/pluginsSrc/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>