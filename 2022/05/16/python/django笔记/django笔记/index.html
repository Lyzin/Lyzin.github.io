<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Django笔记 | 笔记小窝</title><meta name="keywords" content="Python,Django"><meta name="author" content="刘阳"><meta name="copyright" content="刘阳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、Web框架介绍1、Socket实现http服务端123456789101112131415161718192021import socket  # 导入socket模块，用于网络通信socket &#x3D; socket.socket()  # 创建一个TCP Socket对象socket.bind((&quot;127.0.0.1&quot;, 8888))  # 将Socket绑定到本地地址和端口">
<meta property="og:type" content="article">
<meta property="og:title" content="Django笔记">
<meta property="og:url" content="https://www.lynote.top/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="笔记小窝">
<meta property="og:description" content="一、Web框架介绍1、Socket实现http服务端123456789101112131415161718192021import socket  # 导入socket模块，用于网络通信socket &#x3D; socket.socket()  # 创建一个TCP Socket对象socket.bind((&quot;127.0.0.1&quot;, 8888))  # 将Socket绑定到本地地址和端口">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.lynote.top/posts_cover_img/python/django.png">
<meta property="article:published_time" content="2022-05-16T11:31:21.000Z">
<meta property="article:modified_time" content="2024-09-12T05:26:26.731Z">
<meta property="article:author" content="刘阳">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.lynote.top/posts_cover_img/python/django.png"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="https://www.lynote.top/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Django笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-12 13:26:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 博客分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 文章标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 博客归档</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/posts_cover_img/python/django.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">笔记小窝</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 博客分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 文章标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 博客归档</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-16T11:31:21.000Z" title="发表于 2022-05-16 19:31:21">2022-05-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-12T05:26:26.731Z" title="更新于 2024-09-12 13:26:26">2024-09-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django%E7%AC%94%E8%AE%B0/">Django笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Django笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、Web框架介绍"><a href="#一、Web框架介绍" class="headerlink" title="一、Web框架介绍"></a>一、Web框架介绍</h2><h3 id="1、Socket实现http服务端"><a href="#1、Socket实现http服务端" class="headerlink" title="1、Socket实现http服务端"></a>1、Socket实现http服务端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket  <span class="comment"># 导入socket模块，用于网络通信</span></span><br><span class="line"></span><br><span class="line">socket = socket.socket()  <span class="comment"># 创建一个TCP Socket对象</span></span><br><span class="line">socket.bind((<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8888</span>))  <span class="comment"># 将Socket绑定到本地地址和端口8888</span></span><br><span class="line">socket.listen(<span class="number">5</span>)  <span class="comment"># 开始监听连接，最多允许5个未处理的连接</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># 进入无限循环，等待客户端连接</span></span><br><span class="line">    conn, addr = socket.accept()  <span class="comment"># 接受客户端连接，返回一个新的Socket对象和客户端地址</span></span><br><span class="line"></span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)  <span class="comment"># 从客户端接收数据，最多接收1024字节</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;recv data:<span class="subst">&#123;data&#125;</span>&quot;</span>)  <span class="comment"># 打印接收到的数据</span></span><br><span class="line"></span><br><span class="line">    conn.send(<span class="string">b&quot;HTTP/1.1 200 OK\r\n\r\n &lt;h1&gt;hello li lei&lt;/h1&gt;&quot;</span>)  <span class="comment"># 发送HTTP响应给客户端</span></span><br><span class="line">    <span class="comment"># 在网络通信中，关闭连接是一个重要的步骤，原因如下：</span></span><br><span class="line">    <span class="comment"># 资源管理：每个连接都会占用系统资源（如内存、文件描述符等）。如果不关闭连接，这些资源将无法释放，最终可能导致资源耗尽，影响服务器的性能和稳定性。</span></span><br><span class="line">    <span class="comment"># 连接复用：在HTTP/1.0中，默认使用短连接（即每次请求后关闭连接）。虽然HTTP/1.1引入了长连接（Keep-Alive），但在某些情况下，短连接仍然是必要的，特别是在处理大量并发请求时。</span></span><br><span class="line">    <span class="comment"># 安全性：关闭连接可以防止潜在的安全风险，如连接劫持或数据泄露。及时关闭连接可以减少这些风险。</span></span><br><span class="line">	<span class="comment"># 协议规范：</span></span><br><span class="line">	<span class="comment"># HTTP协议要求在每次请求后关闭连接，除非客户端和服务器都支持长连接。遵循协议规范可以确保兼容性和互操作性。</span></span><br><span class="line">    conn.close()  <span class="comment"># 关闭连接</span></span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器打开<code>http://127.0.0.1:8888</code></li>
</ul>
<blockquote>
<p>终端内有两条请求记录，目前只关心<code>GET /</code> 这一条，<code>/favicon.ico</code>暂时不关心</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211025193840271.png" class="" title="image-20211025193840271">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">print</span>(<span class="string">f&quot;recv data:<span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;data type is:&quot;</span>,<span class="built_in">type</span>(data))  <span class="comment"># &lt;class &#x27;bytes&#x27;&gt;</span></span><br><span class="line"><span class="comment"># 上面两行代码返回的data结果</span></span><br><span class="line"> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    b&#x27;GET / HTTP/1.1\r\n</span></span><br><span class="line"><span class="string">    Host: 127.0.0.1:8888\r\n</span></span><br><span class="line"><span class="string">    Connection: keep-alive\r\n</span></span><br><span class="line"><span class="string">    Upgrade-Insecure-Requests: 1\r\n</span></span><br><span class="line"><span class="string">    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\r\n</span></span><br><span class="line"><span class="string">    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n</span></span><br><span class="line"><span class="string">    Sec-Fetch-Site: none\r\n</span></span><br><span class="line"><span class="string">    Sec-Fetch-Mode: navigate\r\n</span></span><br><span class="line"><span class="string">    Sec-Fetch-User: ?1\r\n</span></span><br><span class="line"><span class="string">    Sec-Fetch-Dest: document\r\n</span></span><br><span class="line"><span class="string">    Accept-Encoding: gzip, deflate, br\r\n</span></span><br><span class="line"><span class="string">    Accept-Language: zh-CN,zh;q=0.9\r\n</span></span><br><span class="line"><span class="string">    Cookie: csrftoken=SwCZzdzHFXp8uGWHUqjfrIycQ1P4X6MMo0OG1EhPLPzfMYV1yeSaxmaOEq8GqbXe\r\n\r\n&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2、http请求协议"><a href="#2、http请求协议" class="headerlink" title="2、http请求协议"></a>2、http请求协议</h3><blockquote>
<p>画图软件：<a target="_blank" rel="noopener" href="https://boardmix.cn/app/editor/lIR3ZWynWj79OaRD1wMQmQ">https://boardmix.cn/app/editor/lIR3ZWynWj79OaRD1wMQmQ</a></p>
<p>时序图：<a target="_blank" rel="noopener" href="https://mermaid.nodejs.cn/intro/getting-started.html#using-the-mermaid-live-editor">https://mermaid.nodejs.cn/intro/getting-started.html#using-the-mermaid-live-editor</a></p>
</blockquote>
<blockquote>
<p>请求协议：请求格式+请求方法</p>
<p>下面是一个请求报文的内容</p>
</blockquote>
<h4 id="1-1-GET请求"><a href="#1-1-GET请求" class="headerlink" title="1.1 GET请求"></a>1.1 GET请求</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /ping?name=sam&amp;age=19 HTTP/1.1</span><br><span class="line">User-Agent: PostmanRuntime/7.32.2</span><br><span class="line">Accept: */*</span><br><span class="line">Postman-Token: 64e87079-9973-42cf-be94-413ae9081771</span><br><span class="line">Host: 127.0.0.1:8888</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911182256951.png" class="" title="image-20240911182256951">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911182737783.png" class="" title="image-20240911182737783">

<h4 id="1-2-POST请求"><a href="#1-2-POST请求" class="headerlink" title="1.2 POST请求"></a>1.2 POST请求</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /ping HTTP/1.1</span><br><span class="line">User-Agent: PostmanRuntime/7.32.2</span><br><span class="line">Accept: */*</span><br><span class="line">Postman-Token: 1bdcef93-9b32-4095-8dfd-49e5339d3b21</span><br><span class="line">Host: 127.0.0.1:8888</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 15</span><br><span class="line"> </span><br><span class="line">name=sam&amp;age=18</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911181030565.png" class="" title="image-20240911181030565">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911181905609.png" class="" title="image-20240911181905609">

<h3 id="3、http响应协议"><a href="#3、http响应协议" class="headerlink" title="3、http响应协议"></a>3、http响应协议</h3><h4 id="1-1-GET响应"><a href="#1-1-GET响应" class="headerlink" title="1.1 GET响应"></a>1.1 GET响应</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Wed, 11 Sep 2024 09:15:22 GMT</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line"> </span><br><span class="line">Hello li lei</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911182126729.png" class="" title="image-20240911182126729">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911183546801.png" class="" title="image-20240911183546801">

<h4 id="1-2-POST响应"><a href="#1-2-POST响应" class="headerlink" title="1.2 POST响应"></a>1.2 POST响应</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Wed, 11 Sep 2024 09:15:22 GMT</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line"> </span><br><span class="line">Hello li lei</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911182036721.png" class="" title="image-20240911182036721">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911183542745.png" class="" title="image-20240911183542745">

<h4 id="1-3-响应报文的响应首行字段"><a href="#1-3-响应报文的响应首行字段" class="headerlink" title="1.3 响应报文的响应首行字段"></a>1.3 响应报文的响应首行字段</h4><blockquote>
<p>响应报文的响应行字段默认都是空，只有响应头，但是我们在server端可以添加key-value作为响应豹纹的响应行字段</p>
<p>server返回的响应中有响应首行字段，并且都是<code>\r\n</code>换行</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911182952515.png" class="" title="image-20240911182952515">

<h4 id="1-4-响应状态码"><a href="#1-4-响应状态码" class="headerlink" title="1.4 响应状态码"></a>1.4 响应状态码</h4><blockquote>
<p>1xx: 接受的请求正在处理</p>
<p>2xx: 请求正常处理完毕</p>
<p>3xx: 需要进行附加操作以完成请求</p>
<p>4xx: 服务器无法处理请求</p>
<p>5xx: 服务器处理请求出错</p>
</blockquote>
<h3 id="4、wsgiref模块"><a href="#4、wsgiref模块" class="headerlink" title="4、wsgiref模块"></a>4、wsgiref模块</h3><h4 id="1-1-为什么要有wsgiref模块？"><a href="#1-1-为什么要有wsgiref模块？" class="headerlink" title="1.1 为什么要有wsgiref模块？"></a>1.1 为什么要有wsgiref模块？</h4><blockquote>
<p>首先最初始的socket实现的http服务，有两个问题</p>
<ul>
<li>请求参数解析</li>
<li>响应数据返回</li>
</ul>
</blockquote>
<h5 id="1-1-1-请求参数解析"><a href="#1-1-1-请求参数解析" class="headerlink" title="1.1.1 请求参数解析"></a>1.1.1 请求参数解析</h5><blockquote>
<p>下面这一行代码是在解析请求参数</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911184816739.png" class="" title="image-20240911184816739">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recv data:b<span class="string">&#x27;GET /ping?name=sam&amp;age=19 HTTP/1.1\r\nUser-Agent: PostmanRuntime/7.32.2\r\nAccept: */*\r\nPostman-Token: 3657068e-ea01-4c71-aab8-cec4bf38ac8c\r\nHost: 127.0.0.1:8888\r\nAccept-Encoding: gzip, deflate, br\r\nConnection: keep-alive\r\n\r\n&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>可以看到拿到客户端的请求，它返回的是字符串</li>
<li>但是我想以字典的形式拿到请求参数里的路由、请求头里的key-value、请求路径那还得需要自己做处理，比较繁琐</li>
</ul>
</blockquote>
<h5 id="1-1-2-响应数据返回"><a href="#1-1-2-响应数据返回" class="headerlink" title="1.1.2 响应数据返回"></a>1.1.2 响应数据返回</h5><img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911185129203.png" class="" title="image-20240911185129203">

<blockquote>
<ul>
<li>可以看到响应数据的返回每次都需手动写，</li>
<li>那请求路由比较多了，代码编写会更加繁琐</li>
</ul>
</blockquote>
<h5 id="1-1-3-总结"><a href="#1-1-3-总结" class="headerlink" title="1.1.3 总结"></a>1.1.3 总结</h5><blockquote>
<ul>
<li><p>请求参数解析、响应数据返回都是比较底层代码，每次都需要手工操作，很繁琐。那就需要有一个模块来帮我们处理请求和响应，减少重复处理请求和响应的操作</p>
</li>
<li><p>那么就需要有一个统一的接口协议来实现这样的处理逻辑，那就是<code>WSGI(Web Server GateWay)</code></p>
</li>
<li><p>wsgiref模块就是python基于wsgi协议开发的服务模块</p>
</li>
</ul>
</blockquote>
<h4 id="1-2-wsgiref模块做了哪些事情？"><a href="#1-2-wsgiref模块做了哪些事情？" class="headerlink" title="1.2 wsgiref模块做了哪些事情？"></a>1.2 wsgiref模块做了哪些事情？</h4><h5 id="1-1-1-wsgiref实现服务"><a href="#1-1-1-wsgiref实现服务" class="headerlink" title="1.1.1 wsgiref实现服务"></a>1.1.1 wsgiref实现服务</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2024/9/11 18:57</span></span><br><span class="line"><span class="comment"># @Author  : ly zin</span></span><br><span class="line"><span class="comment"># @File    : wsgiref_demo.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param environ: 依据http协议解析数据</span></span><br><span class="line"><span class="string">    :param start_response: 喜剧http协议组装数据</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 下面的start_response和return所做的事情等价于</span></span><br><span class="line">    <span class="comment"># conn.send(b&quot;HTTP/1.1 200 OK\r\nContent-Type: application/json\r\n\r\n\r\nHello li lei&quot;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构造响应首行以及响应首行字段</span></span><br><span class="line">    start_response(<span class="string">&quot;200 OK&quot;</span>, [(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>)])</span><br><span class="line">    <span class="comment"># 发送的真正的响应数据</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&quot;hello world&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装socket</span></span><br><span class="line">server = make_server(<span class="string">&quot;&quot;</span>, <span class="number">8090</span>, application)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待用户连接：conn, addr = sock,accept</span></span><br><span class="line"><span class="comment"># 会自动给application添加两个参数</span></span><br><span class="line">server.serve_forever()  <span class="comment"># application(environ, start_response)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>访问接口可以看到正常</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911190814907.png" class="" title="image-20240911190814907">

<h5 id="1-1-2-environ参数是什么？"><a href="#1-1-2-environ参数是什么？" class="headerlink" title="1.1.2 environ参数是什么？"></a>1.1.2 environ参数是什么？</h5><img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911191115734.png" class="" title="image-20240911191115734">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">environ:&#123;<span class="string">&#x27;PATH&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/allure-commandline-2.30.0/bin:/Users/hibiscus/protoc-27.3-osx-x86_64/bin:/Users/hibiscus/.nvm/versions/node/v22.3.0/bin:/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home/bin:/Users/hibiscus/ffmpeg:/Users/hibiscus/go/bin:/Users/hibiscus/android_sdk/cmdline-tools/latest/bin:/Users/hibiscus/android_sdk/platform-tools:/Users/hibiscus/android_sdk/build-tools/35.0.0:/Library/Frameworks/Python.framework/Versions/3.10/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/usr/local/go/bin:.&#x27;</span>, <span class="string">&#x27;JAVA_HOME&#x27;</span>: <span class="string">&#x27;/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home&#x27;</span>, <span class="string">&#x27;COMMAND_MODE&#x27;</span>: <span class="string">&#x27;unix2003&#x27;</span>, <span class="string">&#x27;ANDROID_HOME&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/android_sdk&#x27;</span>, <span class="string">&#x27;GOPROXY&#x27;</span>: <span class="string">&#x27;https://goproxy.cn&#x27;</span>, <span class="string">&#x27;GO_HOME&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/go&#x27;</span>, <span class="string">&#x27;NVM_INC&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/.nvm/versions/node/v22.3.0/include/node&#x27;</span>, <span class="string">&#x27;FFMPEG_ENV&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/ffmpeg&#x27;</span>, <span class="string">&#x27;LOGNAME&#x27;</span>: <span class="string">&#x27;hibiscus&#x27;</span>, <span class="string">&#x27;HOMEBREW_BREW_GIT_REMOTE&#x27;</span>: <span class="string">&#x27;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&#x27;</span>, <span class="string">&#x27;allure2&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/allure-commandline-2.30.0&#x27;</span>, <span class="string">&#x27;XPC_SERVICE_NAME&#x27;</span>: <span class="string">&#x27;application.com.jetbrains.pycharm.810107.810805&#x27;</span>, <span class="string">&#x27;PWD&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/Desktop/code/py_code/py_web/django_web/django_source_code_study&#x27;</span>, <span class="string">&#x27;PYCHARM_HOSTED&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;PYCHARM_DISPLAY_PORT&#x27;</span>: <span class="string">&#x27;63343&#x27;</span>, <span class="string">&#x27;PROTOC_HOME&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/protoc-27.3-osx-x86_64&#x27;</span>, <span class="string">&#x27;__CFBundleIdentifier&#x27;</span>: <span class="string">&#x27;com.jetbrains.pycharm&#x27;</span>, <span class="string">&#x27;HOMEBREW_PIP_INDEX_URL&#x27;</span>: <span class="string">&#x27;https://pypi.tuna.tsinghua.edu.cn/simple&#x27;</span>, <span class="string">&#x27;HOMEBREW_CORE_GIT_REMOTE&#x27;</span>: <span class="string">&#x27;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&#x27;</span>, <span class="string">&#x27;PYTHONPATH&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/Desktop/code/py_code/py_web/django_web/django_source_code_study:/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm_matplotlib_backend:/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm_display&#x27;</span>, <span class="string">&#x27;NVM_CD_FLAGS&#x27;</span>: <span class="string">&#x27;-q&#x27;</span>, <span class="string">&#x27;SHELL&#x27;</span>: <span class="string">&#x27;/bin/zsh&#x27;</span>, <span class="string">&#x27;NVM_DIR&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/.nvm&#x27;</span>, <span class="string">&#x27;MKL_THREADING_LAYER&#x27;</span>: <span class="string">&#x27;TBB&#x27;</span>, <span class="string">&#x27;PAGER&#x27;</span>: <span class="string">&#x27;less&#x27;</span>, <span class="string">&#x27;LSCOLORS&#x27;</span>: <span class="string">&#x27;Gxfxcxdxbxegedabagacad&#x27;</span>, <span class="string">&#x27;PYTHONIOENCODING&#x27;</span>: <span class="string">&#x27;UTF-8&#x27;</span>, <span class="string">&#x27;HOMEBREW_BOTTLE_DOMAIN&#x27;</span>: <span class="string">&#x27;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&#x27;</span>, <span class="string">&#x27;OLDPWD&#x27;</span>: <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;hibiscus&#x27;</span>, <span class="string">&#x27;CLASSPATH&#x27;</span>: <span class="string">&#x27;/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home/lib/dt.jar:&#x27;</span>, <span class="string">&#x27;ZSH&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/.oh-my-zsh&#x27;</span>, <span class="string">&#x27;TMPDIR&#x27;</span>: <span class="string">&#x27;/var/folders/5y/3ymnzfm963g0gmzh20fn4vq80000gn/T/&#x27;</span>, <span class="string">&#x27;GO111MODULE&#x27;</span>: <span class="string">&#x27;on&#x27;</span>, <span class="string">&#x27;SSH_AUTH_SOCK&#x27;</span>: <span class="string">&#x27;/private/tmp/com.apple.launchd.1sgypUKGMi/Listeners&#x27;</span>, <span class="string">&#x27;PYCHARM_INTERACTIVE_PLOTS&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;XPC_FLAGS&#x27;</span>: <span class="string">&#x27;0x0&#x27;</span>, <span class="string">&#x27;PYTHONUNBUFFERED&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;__CF_USER_TEXT_ENCODING&#x27;</span>: <span class="string">&#x27;0x1F5:0x19:0x34&#x27;</span>, <span class="string">&#x27;LESS&#x27;</span>: <span class="string">&#x27;-R&#x27;</span>, <span class="string">&#x27;LC_CTYPE&#x27;</span>: <span class="string">&#x27;zh_CN.UTF-8&#x27;</span>, <span class="string">&#x27;LS_COLORS&#x27;</span>: <span class="string">&#x27;di=1;36:ln=35:so=32:pi=33:ex=31:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43&#x27;</span>, <span class="string">&#x27;IDEA_INITIAL_DIRECTORY&#x27;</span>: <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;NVM_BIN&#x27;</span>: <span class="string">&#x27;/Users/hibiscus/.nvm/versions/node/v22.3.0/bin&#x27;</span>, <span class="string">&#x27;HOME&#x27;</span>: <span class="string">&#x27;/Users/hibiscus&#x27;</span>, <span class="string">&#x27;HOMEBREW_API_DOMAIN&#x27;</span>: <span class="string">&#x27;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&#x27;</span>, <span class="string">&#x27;SERVER_NAME&#x27;</span>: <span class="string">&#x27;apdeMacBook-Pro.local&#x27;</span>, <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span>: <span class="string">&#x27;CGI/1.1&#x27;</span>, <span class="string">&#x27;SERVER_PORT&#x27;</span>: <span class="string">&#x27;8090&#x27;</span>, <span class="string">&#x27;REMOTE_HOST&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;SCRIPT_NAME&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>: <span class="string">&#x27;HTTP/1.1&#x27;</span>, <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>: <span class="string">&#x27;WSGIServer/0.2&#x27;</span>, <span class="string">&#x27;REQUEST_METHOD&#x27;</span>: <span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;PATH_INFO&#x27;</span>: <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;QUERY_STRING&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;REMOTE_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;CONTENT_TYPE&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>, <span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>: <span class="string">&#x27;PostmanRuntime/7.32.2&#x27;</span>, <span class="string">&#x27;HTTP_ACCEPT&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>, <span class="string">&#x27;HTTP_POSTMAN_TOKEN&#x27;</span>: <span class="string">&#x27;bff5e120-95b2-41b8-8a10-14996c0fc831&#x27;</span>, <span class="string">&#x27;HTTP_HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1:8090&#x27;</span>, <span class="string">&#x27;HTTP_ACCEPT_ENCODING&#x27;</span>: <span class="string">&#x27;gzip, deflate, br&#x27;</span>, <span class="string">&#x27;HTTP_CONNECTION&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>, <span class="string">&#x27;wsgi.input&#x27;</span>: &lt;_io.BufferedReader name=4&gt;, <span class="string">&#x27;wsgi.errors&#x27;</span>: &lt;_io.TextIOWrapper name=<span class="string">&#x27;&lt;stderr&gt;&#x27;</span> mode=<span class="string">&#x27;w&#x27;</span> encoding=<span class="string">&#x27;utf-8&#x27;</span>&gt;, <span class="string">&#x27;wsgi.version&#x27;</span>: (1, 0), <span class="string">&#x27;wsgi.run_once&#x27;</span>: False, <span class="string">&#x27;wsgi.url_scheme&#x27;</span>: <span class="string">&#x27;http&#x27;</span>, <span class="string">&#x27;wsgi.multithread&#x27;</span>: False, <span class="string">&#x27;wsgi.multiprocess&#x27;</span>: False, <span class="string">&#x27;wsgi.file_wrapper&#x27;</span>: &lt;class <span class="string">&#x27;wsgiref.util.FileWrapper&#x27;</span>&gt;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>environ是一个字典，我们就可以自由的拿到想要的请求数据</li>
<li>里面字段非常多，但是我们可以重点关注PATH_INFO字段，就拿到了当前请求路径</li>
</ul>
</blockquote>
<h4 id="1-3-基于wsgiref自定义web框架"><a href="#1-3-基于wsgiref自定义web框架" class="headerlink" title="1.3 基于wsgiref自定义web框架"></a>1.3 基于wsgiref自定义web框架</h4><h5 id="1-1-1-实现路由分发"><a href="#1-1-1-实现路由分发" class="headerlink" title="1.1.1 实现路由分发"></a>1.1.1 实现路由分发</h5><blockquote>
<p>因为服务不可能只有一个路由，我们也不可能一直给用户返回同一个响应内容，用户希望通过不同路由得到不同的响应结果，那么我们就需要实现这样的逻辑</p>
<ul>
<li>核心逻辑就是获取environ.get(“PATH_INFO”)来获取当前请求的路由，然后进行if-else判断</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2024/9/11 18:57</span></span><br><span class="line"><span class="comment"># @Author  : ly zin</span></span><br><span class="line"><span class="comment"># @File    : wsgiref_demo.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    下面的start_response和return所做的事情等价于</span></span><br><span class="line"><span class="string">    conn.send(b&quot;HTTP/1.1 200 OK\r\nContent-Type: application/json\r\n\r\n\r\nHello li lei&quot;)</span></span><br><span class="line"><span class="string">    :param environ: 依据http协议解析数据</span></span><br><span class="line"><span class="string">    :param start_response: 喜剧http协议组装数据</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    request_path = environ.get(<span class="string">&quot;PATH_INFO&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造响应首行以及响应首行字段</span></span><br><span class="line">    start_response(<span class="string">&quot;200 OK&quot;</span>, [(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>)])</span><br><span class="line">    <span class="keyword">if</span> request_path == <span class="string">&quot;/login&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">b&quot;login page&quot;</span>]</span><br><span class="line">    <span class="keyword">elif</span> request_path == <span class="string">&quot;/index&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">b&quot;index page&quot;</span>]</span><br><span class="line">    <span class="comment"># 发送的真正的响应数据</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&quot;not found page&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装socket</span></span><br><span class="line">server = make_server(<span class="string">&quot;&quot;</span>, <span class="number">8090</span>, application)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待用户连接：conn, addr = sock.accept()</span></span><br><span class="line"><span class="comment"># 会自动给application添加两个参数</span></span><br><span class="line">server.serve_forever()  <span class="comment"># application(environ, start_response)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>从下图就可以看到，我们通过不同的路由得到了不同的结果</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911192501012.png" class="" title="image-20240911192501012">

<h5 id="1-1-2-路由分发优化"><a href="#1-1-2-路由分发优化" class="headerlink" title="1.1.2 路由分发优化"></a>1.1.2 路由分发优化</h5><blockquote>
<p>上面的代码都是用if-else来实现路由分发，也就是一个路由对应一个处理代码</p>
<p>那么我们是不是可以把路由和处理代码放在一个列表里进行路由分发，并发把处理代码封装成一个函数</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2024/9/11 18:57</span></span><br><span class="line"><span class="comment"># @Author  : ly zin</span></span><br><span class="line"><span class="comment"># @File    : wsgiref_demo.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login page&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index page&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    下面的start_response和return所做的事情等价于</span></span><br><span class="line"><span class="string">    conn.send(b&quot;HTTP/1.1 200 OK\r\nContent-Type: application/json\r\n\r\n\r\nHello li lei&quot;)</span></span><br><span class="line"><span class="string">    :param environ: 依据http协议解析数据</span></span><br><span class="line"><span class="string">    :param start_response: 喜剧http协议组装数据</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    request_path = environ.get(<span class="string">&quot;PATH_INFO&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造响应首行以及响应首行字段</span></span><br><span class="line">    start_response(<span class="string">&quot;200 OK&quot;</span>, [(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>)])</span><br><span class="line"></span><br><span class="line">    url_patterns = [</span><br><span class="line">        (<span class="string">&quot;/login&quot;</span>, login),</span><br><span class="line">        (<span class="string">&quot;/index&quot;</span>, index),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    func = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> url_patterns:</span><br><span class="line">        <span class="keyword">if</span> request_path == i[<span class="number">0</span>]:</span><br><span class="line">            func = i[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 匹配到了封装的函数</span></span><br><span class="line">    <span class="keyword">if</span> func:</span><br><span class="line">        <span class="keyword">return</span> [func().encode(<span class="string">&quot;utf-8&quot;</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送的真正的响应数据</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&quot;not found page&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装socket</span></span><br><span class="line">server = make_server(<span class="string">&quot;&quot;</span>, <span class="number">8090</span>, application)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待用户连接：conn, addr = sock.accept()</span></span><br><span class="line"><span class="comment"># 会自动给application添加两个参数</span></span><br><span class="line">server.serve_forever()  <span class="comment"># application(environ, start_response)</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911193416451.png" class="" title="image-20240911193416451">

<blockquote>
<p>同样实现了路由分发</p>
</blockquote>
<h5 id="1-1-3-路由分发的优点"><a href="#1-1-3-路由分发的优点" class="headerlink" title="1.1.3 路由分发的优点"></a>1.1.3 路由分发的优点</h5><blockquote>
<p>上面的url_patterns 只需要定义路由和对应的处理函数，然后再处理函数中实现业务逻辑即可，这样是不是我们的关注更低了，只需要关注路径和处理函数，不需要再关心其他内容</p>
</blockquote>
<h5 id="1-1-4-environ参数处理"><a href="#1-1-4-environ参数处理" class="headerlink" title="1.1.4 environ参数处理"></a>1.1.4 environ参数处理</h5><blockquote>
<p>从前面知道environ参数包含了所有请求处理参数，那我们的处理函数中肯定100%需要拿到请求参数再来处理业务逻辑，所以但是environ参数再application函数中，我们需要将environ参数传递给每个处理函数，那么处理函数就具备了处理请求参数的能力，这就是web框架的雏形</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2024/9/11 18:57</span></span><br><span class="line"><span class="comment"># @Author  : ly zin</span></span><br><span class="line"><span class="comment"># @File    : wsgiref_demo.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">environ</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login page&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">environ</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index page&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    下面的start_response和return所做的事情等价于</span></span><br><span class="line"><span class="string">    conn.send(b&quot;HTTP/1.1 200 OK\r\nContent-Type: application/json\r\n\r\n\r\nHello li lei&quot;)</span></span><br><span class="line"><span class="string">    :param environ: 依据http协议解析数据</span></span><br><span class="line"><span class="string">    :param start_response: 喜剧http协议组装数据</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    request_path = environ.get(<span class="string">&quot;PATH_INFO&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造响应首行以及响应首行字段</span></span><br><span class="line">    start_response(<span class="string">&quot;200 OK&quot;</span>, [(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>)])</span><br><span class="line"></span><br><span class="line">    url_patterns = [</span><br><span class="line">        (<span class="string">&quot;/login&quot;</span>, login),</span><br><span class="line">        (<span class="string">&quot;/index&quot;</span>, index),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    func = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> url_patterns:</span><br><span class="line">        <span class="keyword">if</span> request_path == i[<span class="number">0</span>]:</span><br><span class="line">            func = i[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 匹配到了封装的函数</span></span><br><span class="line">    <span class="keyword">if</span> func:</span><br><span class="line">        <span class="keyword">return</span> [func(environ).encode(<span class="string">&quot;utf-8&quot;</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送的真正的响应数据</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&quot;not found page&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装socket</span></span><br><span class="line">server = make_server(<span class="string">&quot;&quot;</span>, <span class="number">8090</span>, application)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待用户连接：conn, addr = sock.accept()</span></span><br><span class="line"><span class="comment"># 会自动给application添加两个参数</span></span><br><span class="line">server.serve_forever()  <span class="comment"># application(environ, start_response)</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911193929652.png" class="" title="image-20240911193929652">

<blockquote>
<p>所以即使处理函数用不到environ参数，那也需要传递，因为请求参数处理在开发中占比非常高</p>
</blockquote>
<h5 id="1-1-5-拆分实现web框架"><a href="#1-1-5-拆分实现web框架" class="headerlink" title="1.1.5 拆分实现web框架"></a>1.1.5 拆分实现web框架</h5><blockquote>
<p>从上面的路由分发可以看到，所有代码都是聚合在一起，那我们是不是可以进行拆分，实现不同目录负责不同功能</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进行了文件拆分</span></span><br><span class="line">my_web</span><br><span class="line">├── main.py</span><br><span class="line">├── urls.py</span><br><span class="line">└── views.py</span><br><span class="line"></span><br><span class="line">1 directory, 3 files</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911194534542.png" class="" title="image-20240911194534542">

<blockquote>
<p>那这样拆分以后就实现一个自定义的web框架</p>
</blockquote>
<blockquote>
<p>添加功能，比如需要添加一个查看时间的接口，只需要在views.py和urls.py中添加代码即可</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911195111162.png" class="" title="image-20240911195111162">

<blockquote>
<p>可以看到很快就实现一个http接口，这就是封装web框架的优势</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20240911194949756.png" class="" title="image-20240911194949756">

<h4 id="1-4-django中的wsgiref"><a href="#1-4-django中的wsgiref" class="headerlink" title="1.4 django中的wsgiref"></a>1.4 django中的wsgiref</h4><blockquote>
<p>Django底层用的是<code>wsgiref</code>模块来请求和响应数据</p>
<p><code>wsgiref</code>模块也叫web服务网关接口</p>
<ol>
<li>请求来的时候解析<code>HTTP</code>格式的数据，封装成大字典</li>
<li>响应走的时候给数据打包成符合<code>HTTP</code>格式的数据返回给浏览器</li>
</ol>
</blockquote>
<h2 id="二、Django上手"><a href="#二、Django上手" class="headerlink" title="二、Django上手"></a>二、Django上手</h2><h3 id="1、Django安装"><a href="#1、Django安装" class="headerlink" title="1、Django安装"></a>1、Django安装</h3><blockquote>
<p><code>Django</code>的版本问题</p>
<ul>
<li><code>Django1.x</code>和<code>Django2.x</code>的差距不大</li>
<li>所以先学习<code>Django1.x</code>的即可，后续有需要可以往<code>Django2.x</code>过渡</li>
<li>面试时可以说先用的1.8，慢慢过渡到了1.11版本</li>
<li>因为Django1.11.11最好适合的Python3版本是<code>3.4~3.6</code>之间的版本，3.7以及后面的版本和Django的<code>1.11.11</code>版本有兼容问题<ul>
<li>如果是python3.7，可以安装Django的1.11.17版本，这个版本创建app时不会报错</li>
<li><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">pip清华地址:https://mirrors.tuna.tsinghua.edu.cn/help/pypi/</a></li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pip install django==1.11.17</span><br><span class="line"></span><br><span class="line">// 查看django版本</span><br><span class="line">(venv) D:\&gt;django-admin version</span><br><span class="line">1.11.17</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下面基本都在命令行操作</p>
</blockquote>
<h3 id="2、创建项目"><a href="#2、创建项目" class="headerlink" title="2、创建项目"></a>2、创建项目</h3><blockquote>
<p><code>blog</code>是项目名</p>
<p>使用<code>django-admin</code>可以快速创建一个<code>Django</code>项目</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 创建Django项目的命令</span><br><span class="line">django-admin startproject blog</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建完以后可以看到项目目录的结构</p>
<ul>
<li><p>项目根目录有两个东西：</p>
<ul>
<li>一个是项目管理文件: <code>manage.py</code></li>
<li>另一个是目录:<code>blog</code></li>
</ul>
</li>
<li><p><code>blog</code>目录中：</p>
<ul>
<li><p><code>setting.py</code>：项目配置文件</p>
</li>
<li><p><code>urls.py</code> ：项目路由文件</p>
</li>
<li><p><code>wsgi.py</code> ：项目启动服务文件</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="3、创建应用"><a href="#3、创建应用" class="headerlink" title="3、创建应用"></a>3、创建应用</h3><blockquote>
<ul>
<li><p>一个<code>app</code>就是一个功能独立的模块</p>
</li>
<li><p>一个项目可以有多个<code>app</code>：比如下面的<code>home</code>是就是应用名</p>
</li>
<li><p>由于<code>django 1.11</code>版本和<code>python3.7</code>版本不兼容, 2.0版本以后的Django修复了这个问题，所以使用下面命令创建app就需要注意下python3和Django的版本</p>
</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到创建的项目根目录</span></span><br><span class="line">python manage.py startapp home</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211215235855339.png" class="" title="image-20211215235855339">

<h4 id="1-1-应用的目录结构"><a href="#1-1-应用的目录结构" class="headerlink" title="1.1 应用的目录结构"></a>1.1 应用的目录结构</h4><img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211216000052168.png" class="" title="image-20211216000052168">

<h4 id="1-2-注册应用"><a href="#1-2-注册应用" class="headerlink" title="1.2 注册应用"></a>1.2 注册应用</h4><blockquote>
<p>创建出来的应用一定要先去配置文件中注册，在<code>setting.py</code>文件中</p>
<p>在<code>INSTALLED_APPS</code>中注册app。就是把home&#x2F;apps.py文件中的HomeConfig类的申明路径添加进来</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册创建的App</span></span><br><span class="line"><span class="comment"># Application definition</span></span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;bolg.home&#x27;,  // 全写</span></span><br><span class="line">    <span class="string">&#x27;home&#x27;</span> <span class="comment"># 简写，只写应用名</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="4、项目目录结构介绍"><a href="#4、项目目录结构介绍" class="headerlink" title="4、项目目录结构介绍"></a>4、项目目录结构介绍</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- blog目录</span><br><span class="line">		- blog目录中：</span><br><span class="line">			 -- setting.py 配置文件</span><br><span class="line">			 -- urls.py  路由与视图函数对应关系（路由层）</span><br><span class="line">			 -- wsgi.py  wsgiref模块（不考虑）</span><br><span class="line">		- manage.py  项目入口文件</span><br><span class="line">		- db.sqlite3 自带数据库，很小，仅仅用来做测试</span><br><span class="line">		- home目录</span><br><span class="line">			 -- admin.py 后台管理</span><br><span class="line">			 -- apps.py 注册使用</span><br><span class="line">			 -- migrations 数据库迁移日志文件</span><br><span class="line">			 -- models.py 数据库模型类，用于ORM</span><br><span class="line">			 -- views.py 视图函数文件</span><br><span class="line">			 -- test.py 测试文件</span><br></pre></td></tr></table></figure>

<h3 id="5、启动Django项目"><a href="#5、启动Django项目" class="headerlink" title="5、启动Django项目"></a>5、启动Django项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211216000435878.png" class="" title="image-20211216000435878">

<blockquote>
<p>打开浏览器，输入上面的地址打开后可以看到下面页面，就表示启动<code>Django</code>成功</p>
<p>并且可以看到下面的英文提示：</p>
<ul>
<li>第一句(Your’re seeing…):表示能看到这个消息，是<code>Django</code>项目的<code>setting.py</code>文件中的<code>DEBUG=True</code></li>
<li>第二句(you haven’t…):表示还没有配置路由<code>URLS</code></li>
</ul>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211216000754066.png" class="" title="image-20211216000754066">

<h3 id="6、templates目录"><a href="#6、templates目录" class="headerlink" title="6、templates目录"></a>6、<code>templates</code>目录</h3><blockquote>
<p><code>templates</code>目录用来存放前段<code>HTML</code>页面的</p>
<ul>
<li><p>命令行创建<code>没有templates</code>文件目录</p>
</li>
<li><p>pycharm创建是<code>templates</code>文件目录的</p>
</li>
</ul>
</blockquote>
<h3 id="7、Django三组件"><a href="#7、Django三组件" class="headerlink" title="7、Django三组件"></a>7、Django三组件</h3><h4 id="1-1-HttpResponse"><a href="#1-1-HttpResponse" class="headerlink" title="1.1 HttpResponse"></a>1.1 HttpResponse</h4><blockquote>
<p>从<code>HttpResponse</code>源码可以看：</p>
<ul>
<li>是一个<code>Http</code>响应，并且返回的是<code>字符串内容</code></li>
<li><code>Http响应内容</code>可以被读、追加或者替换</li>
</ul>
<p>视图函数中的<code>request</code>参数是一个对象，用来获取<code>请求的所有数据</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HttpResponse部分源码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpResponse</span>(<span class="title class_ inherited__">HttpResponseBase</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    An HTTP response class with a string as content.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This content that can be read, appended to or replaced.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    streaming = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content=<span class="string">b&#x27;&#x27;</span>, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(HttpResponse, self).__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># Content is a bytestring. See the `content` property methods.</span></span><br><span class="line">        self.content = content</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写在urls.py文件</span></span><br><span class="line"><span class="keyword">from</span> home <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># url(r&#x27;^admin/&#x27;, admin.site.urls),</span></span><br><span class="line">    url(<span class="string">&quot;^home/&quot;</span>, views.home)</span><br><span class="line">]</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"><span class="comment"># 写在应用的views.py中</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    ret = HttpResponse(<span class="string">&quot;Hi, Django&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(ret) <span class="comment"># &lt;HttpResponse status_code=200, &quot;text/html; charset=utf-8&quot;&gt;</span></span><br><span class="line">    <span class="built_in">print</span>(ret.status_code) <span class="comment"># 200</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(ret)) <span class="comment"># &lt;class &#x27;django.http.response.HttpResponse&#x27;&gt;</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

<h4 id="1-2-render"><a href="#1-2-render" class="headerlink" title="1.2 render"></a>1.2 render</h4><blockquote>
<p>给浏览器返回渲染的<code>html</code>文件，将<code>html</code>文件变成字节形式返回给浏览器</p>
<p>render方法本身返回的还是<code>HttpResponse</code>对象</p>
</blockquote>
<h5 id="1-1-1-创建html文件"><a href="#1-1-1-创建html文件" class="headerlink" title="1.1.1 创建html文件"></a>1.1.1 创建<code>html</code>文件</h5><blockquote>
<ol>
<li>需要检查settings.py中有没有添加templates目录路径，没有的话，需要加上</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719232801505.png" class="" title="image-20220719232801505">

<blockquote>
<ol>
<li>在项目根目录创建<code>templates</code>目录</li>
<li>在<code>templates</code>目录创建对应的<code>html</code>文件<ul>
<li><code>&#123;&#123; ret &#125;&#125;</code>是django自带的模板语法，表示接收变量的值</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;&#123; ret &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-编写路由"><a href="#1-1-2-编写路由" class="headerlink" title="1.1.2 编写路由"></a>1.1.2 编写路由</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在settings.py文件中添加index_html的路由</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> day01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;^index/&#x27;</span>, views.index),</span><br><span class="line">    url(<span class="string">r&#x27;^index_html/&#x27;</span>, views.index_html),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h5 id="1-1-3-编写视图函数"><a href="#1-1-3-编写视图函数" class="headerlink" title="1.1.3 编写视图函数"></a>1.1.3 编写视图函数</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用中使用，写在views.py中</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index_html</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param request: 请求相关的所有的数据</span></span><br><span class="line"><span class="string">    :return: HttpResponse对象值</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ret = <span class="string">&#x27;html page data&#x27;</span></span><br><span class="line">    <span class="comment"># 直接写templates目录下的html文件名</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h5 id="1-1-4-请求页面"><a href="#1-1-4-请求页面" class="headerlink" title="1.1.4 请求页面"></a>1.1.4 请求页面</h5><blockquote>
<p>访问<code>http://127.0.0.1:8000/index_html/</code>即可看到下面的页面</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20210903143834317.png" class="" title="image-20210903143834317">

<h4 id="1-3-redirect"><a href="#1-3-redirect" class="headerlink" title="1.3 redirect"></a>1.3 redirect</h4><blockquote>
<p>表示在视图函数中跳转到别的页面，也叫重定向</p>
<p>redirect本身还是<code>HttpResponse</code>对象</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用中使用,写在views.py中</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index_redirect</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param request: 请求相关的所有的数据</span></span><br><span class="line"><span class="string">    :return: HttpResponse对象值</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    redirect_url = <span class="string">&#x27;/index/&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> redirect(redirect_url)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>访问<code>http://127.0.0.1:8000/index_html/</code>就会最终跳转至<code>/index/</code>页面</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20210903144432203.png" class="" title="image-20210903144432203">

<h3 id="8、静态文件配置"><a href="#8、静态文件配置" class="headerlink" title="8、静态文件配置"></a>8、静态文件配置</h3><blockquote>
<p><code>html</code>文件都放在<code>templates</code>文件下</p>
<p>将静态文件放在<code>static</code>文件夹里</p>
<ul>
<li>前端写好的文件都可以叫静态文件，比如<code>js</code>&#x2F;<code>css</code>&#x2F;<code>图片</code>&#x2F;<code>前端框架</code></li>
</ul>
<p><code>django</code>需要自己创建<code>static</code>文件夹</p>
<ul>
<li>在<code>static</code>中可以放<code>js</code>&#x2F;<code>css</code>&#x2F;<code>plugins</code>等文件夹，做好区分</li>
</ul>
</blockquote>
<h4 id="1-1-静态文件绝对路径"><a href="#1-1-静态文件绝对路径" class="headerlink" title="1.1 静态文件绝对路径"></a>1.1 静态文件绝对路径</h4><blockquote>
<p><code>谨记：</code></p>
<ul>
<li><code>在浏览器输入url时，能看到对应的资源，是因为服务端开启了对应资源的接口</code></li>
<li><code>如果访问不到，那就是服务端没有开启对应资源的接口</code></li>
</ul>
</blockquote>
<blockquote>
<p>未开启对应资源的接口，而是只在Django目录下创建了<code>/static/css/home.css</code>目录和文件，然后直接在<code>html</code>里直接引用，就会报错，因为服务端根本没有将这个资源的入口开启，直接访问会404找不到</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># index文件里直接写css文件</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>home<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/css/home.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是主页<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211227234555244.png" class="" title="image-20211227234555244">

<blockquote>
<p>上述在浏览器打开<code>http://127.0.0.1:8000/home/</code>就会出现home.css文件404的情况</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211227235030984.png" class="" title="image-20211227235030984">

<h4 id="1-2-服务端开启静态资源入口"><a href="#1-2-服务端开启静态资源入口" class="headerlink" title="1.2 服务端开启静态资源入口"></a>1.2 服务端开启静态资源入口</h4><blockquote>
<p>因为上面的报错，所以需要服务端开启访问静态资源的入口，才可以使得前端可以访问到资源</p>
<p><code>STATICFILES_DIRS</code>表示:</p>
<ul>
<li>开放了静态文件路径，将<code>Django</code>目录下创建的<code>static</code>文件夹加入到了<code>静态资源列表</code>,前端页面就可以访问到了</li>
<li>是一个列表，表示可以放多个静态资源目录<ul>
<li>多个时，先从第一个找，找不到继续往下找，直到找到就会返回对应的资源</li>
</ul>
</li>
</ul>
<p><code>STATIC_URL = &#39;/static/&#39;</code>:</p>
<ul>
<li>表示前端访问静态资源时，需要带的一个令牌，拿着这个令牌，再去<code>STATICFILES_DIRS</code>里的文件夹中去找对应的资源文件</li>
<li>前端写静态资源的路径时，写的<code>static</code>就是<code>STATIC_URL</code>后面的<code>/static/</code>就是令牌</li>
<li>那么这个令牌就可以自定义了，只需要改了这里，前端页面去拿静态资源时的令牌就要变成修改的了，比如将<code>/static/</code>改为<code>/abc/</code>，那么前端页面里写静态资源路径时的第一个单词就要写成<code>/abc/</code></li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在setting.py文件下添加该行代码，表示服务端开启了访问静态资源的入口</span></span><br><span class="line"><span class="comment"># Static files (CSS, JavaScript, Images)</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/1.11/howto/static-files/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个是访问的令牌</span></span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 此处为新加代码</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">&quot;static&quot;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211227234806719.png" class="" title="image-20211227234806719">

<blockquote>
<p>再次访问<code>http://127.0.0.1:8000/home/</code>就会出现正常样式</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211227235127800.png" class="" title="image-20211227235127800">



<h4 id="1-3-灵活取令牌值"><a href="#1-3-灵活取令牌值" class="headerlink" title="1.3 灵活取令牌值"></a>1.3 灵活取令牌值</h4><blockquote>
<p>​	但是当前端页面很多时，并且我们都是用相对路径去写静态资源的路径，并且路径第一个单词是<code>令牌</code>，这个时候需要修改令牌时，就会需要修改很多文件，那么怎么灵活处理呢？就用到了<code>静态文件动态解析</code></p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220106150623144.png" class="" title="image-20220106150623144">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211228000549317.png" class="" title="image-20211228000549317">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211228000832612.png" class="" title="image-20211228000832612">



<h3 id="9、request对象方法"><a href="#9、request对象方法" class="headerlink" title="9、request对象方法"></a>9、request对象方法</h3><h4 id="1-1-关闭csrf中间件"><a href="#1-1-关闭csrf中间件" class="headerlink" title="1.1 关闭csrf中间件"></a>1.1 关闭<code>csrf</code>中间件</h4><blockquote>
<p>在前阶段学习时，可以先注释<code>csrf</code>中间件，否则做一些<code>form</code>的<code>post</code>表单提交时会报错，后面再来探讨这个问题</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211228001140316.png" class="" title="image-20211228001140316">

<h4 id="1-2-request对象"><a href="#1-2-request对象" class="headerlink" title="1.2 request对象"></a>1.2 request对象</h4><blockquote>
<p>在视图函数中都会有<code>request</code>形参，需要重点来学习下这个<code>request</code>，<code>request</code>是一个对象，里面有很多可以供我们使用的方法</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 还是用之前的home函数</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="built_in">print</span>(request) <span class="comment"># &lt;WSGIRequest: GET &#x27;/home/&#x27;&gt;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(request)) <span class="comment">#&lt;class &#x27;django.core.handlers.wsgi.WSGIRequest&#x27;&gt;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">dir</span>(request)) </span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;index.html&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span>(request) <span class="comment"># 可以看到有很多的方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;COOKIES&#x27;, &#x27;FILES&#x27;, &#x27;GET&#x27;, &#x27;META&#x27;, &#x27;POST&#x27;, &#x27;__class__&#x27;, &#x27;__delattr__&#x27;, &#x27;__dict__&#x27;, &#x27;__dir__&#x27;, &#x27;__doc__&#x27;, &#x27;__eq__&#x27;, &#x27;__format__&#x27;, &#x27;__ge__&#x27;, &#x27;__getattribute__&#x27;, &#x27;__gt__&#x27;, &#x27;__hash__&#x27;, &#x27;__init__&#x27;, &#x27;__init_subclass__&#x27;, &#x27;__iter__&#x27;, &#x27;__le__&#x27;, &#x27;__lt__&#x27;, &#x27;__module__&#x27;, &#x27;__ne__&#x27;, &#x27;__new__&#x27;, &#x27;__reduce__&#x27;, &#x27;__reduce_ex__&#x27;, &#x27;__repr__&#x27;, &#x27;__setattr__&#x27;, &#x27;__sizeof__&#x27;, &#x27;__str__&#x27;, &#x27;__subclasshook__&#x27;, &#x27;__weakref__&#x27;, &#x27;_encoding&#x27;, &#x27;_get_post&#x27;, &#x27;_get_raw_host&#x27;, &#x27;_get_scheme&#x27;, &#x27;_initialize_handlers&#x27;, &#x27;_load_post_and_files&#x27;, &#x27;_mark_post_parse_error&#x27;, &#x27;_messages&#x27;, &#x27;_post_parse_error&#x27;, &#x27;_read_started&#x27;, &#x27;_set_post&#x27;, &#x27;_stream&#x27;, &#x27;_upload_handlers&#x27;, &#x27;body&#x27;, &#x27;build_absolute_uri&#x27;, &#x27;close&#x27;, &#x27;content_params&#x27;, &#x27;content_type&#x27;, &#x27;encoding&#x27;, &#x27;environ&#x27;, &#x27;get_full_path&#x27;, &#x27;get_host&#x27;, &#x27;get_port&#x27;, &#x27;get_raw_uri&#x27;, &#x27;get_signed_cookie&#x27;, &#x27;is_ajax&#x27;, &#x27;is_secure&#x27;, &#x27;method&#x27;, &#x27;parse_file_upload&#x27;, &#x27;path&#x27;, &#x27;path_info&#x27;, &#x27;read&#x27;, &#x27;readline&#x27;, &#x27;readlines&#x27;, &#x27;resolver_match&#x27;, &#x27;scheme&#x27;, &#x27;session&#x27;, &#x27;upload_handlers&#x27;, &#x27;user&#x27;, &#x27;xreadlines&#x27;]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过debug断点，也可以看到request形参里的大部分常见的方法</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220714231350440.png" class="" title="image-20220714231350440">

<h5 id="1-1-1-request-method"><a href="#1-1-1-request-method" class="headerlink" title="1.1.1 request.method"></a>1.1.1 request.method</h5><blockquote>
<p>用来获取请求这个url的请求方法</p>
<p>如果是以<code>get</code>方法请求的这个视图函数，那么<code>request.method</code>返回值就是<code>大写的GET</code>字符串</p>
<p>如果是以<code>post</code>方法请求的这个视图函数，那么<code>request.method</code>返回值就是<code>大写的POST</code>字符串</p>
<p>举例：这样就可以用来做请求方法拆分，可以使用<code>if</code>先判断请求方法是什么：</p>
<ul>
<li>如果请求方法是<code>GET</code>，可以先返回一个页面</li>
<li>如果请求方法是<code>POST</code>，返回单独的<code>POST</code>请求处理，在<code>POST</code>里就可以获取前端传入的请求数据</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;POST data&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;index.html&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-request-POST"><a href="#1-1-2-request-POST" class="headerlink" title="1.1.2 request.POST"></a>1.1.2 request.POST</h5><blockquote>
<p>用来获取用户提交的<code>post</code>请求数据</p>
<ul>
<li><p>提交的post请求里不包含文件上传的请求</p>
</li>
<li><p>post请求参数一般都是请求体里面</p>
</li>
</ul>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个form表单</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是主页<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/home/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        用户名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;uname&quot;</span>&gt;</span></span><br><span class="line">        密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span></span><br><span class="line">        爱好:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;足球&quot;</span>&gt;</span>足球</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;排球&quot;</span>&gt;</span>排球</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;桌球&quot;</span>&gt;</span>桌球</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211228003707768.png" class="" title="image-20211228003707768">

<blockquote>
<p>后端<code>views.py</code>代码，从中可以看出：</p>
<ul>
<li><code>request.POST</code>是一个查询字典，类型是<code>&lt;class &#39;django.http.request.QueryDict&#39;&gt;</code></li>
<li><code>request.POST</code>的<code>get方法</code>只会获取最后一个值，并且类型是<code>str</code></li>
<li><code>request.POST</code>的<code>getlist方法</code>会获取所有值，并且类型是<code>list</code></li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="comment"># &lt;QueryDict: &#123;&#x27;uname&#x27;: [&#x27;ko&#x27;], &#x27;pwd&#x27;: [&#x27;123&#x27;], &#x27;hobby&#x27;: [&#x27;足球&#x27;, &#x27;排球&#x27;]&#125;&gt;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;request.POST:&quot;</span>, request.POST)</span><br><span class="line">        <span class="comment"># &lt;class &#x27;django.http.request.QueryDict&#x27;&gt;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;request.POST type:&quot;</span>, <span class="built_in">type</span>(request.POST))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get方法只会获取最后一个值</span></span><br><span class="line">        uname = request.POST.get(<span class="string">&quot;uname&quot;</span>)</span><br><span class="line">        <span class="comment"># uname = &gt; ko</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;uname=&gt;&quot;</span>, uname)</span><br><span class="line">        <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;uname type:&quot;</span>, <span class="built_in">type</span>(uname))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get方法只会获取最后一个值</span></span><br><span class="line">        hob = request.POST.get(<span class="string">&quot;hobby&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 桌球</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hob=&gt;&quot;</span>, hob) <span class="comment"># 桌球</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hob type=&gt;&quot;</span>, <span class="built_in">type</span>(hob)) <span class="comment"># 桌球</span></span><br><span class="line"></span><br><span class="line">        hob_list= request.POST.getlist(<span class="string">&quot;hobby&quot;</span>)</span><br><span class="line">        <span class="comment"># [&#x27;排球&#x27;, &#x27;桌球&#x27;]</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hob_list=&gt;&quot;</span>, hob_list)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># &lt;class &#x27;list&#x27;&gt;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hob_list type=&gt;&quot;</span>, <span class="built_in">type</span>(hob_list))</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;POST data&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;index.html&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="1-1-3-request-GET"><a href="#1-1-3-request-GET" class="headerlink" title="1.1.3 request.GET"></a>1.1.3 request.GET</h5><blockquote>
<p><code>request.GET</code>和<code>request.POST</code>的所有请求方法都一样</p>
<p><code>request.GET</code>常用于获取url后面携带的参数，比如：</p>
<ul>
<li><p>url &#x3D; ”<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/query_course/?id=2%E2%80%9D">http://127.0.0.1:8000/query_course/?id=2”</a></p>
</li>
<li><p>同样<code>request.GET</code>也支持用<code>get</code>&#x2F;<code>getlist</code>获取<code>url</code>后面带的值</p>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请求的url：http://127.0.0.1:8000/home/?user=ko&amp;age=19</span></span><br><span class="line"><span class="comment"># ?user=ko&amp;age=19 是拼接的参数，在url里可以看到</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># &lt; QueryDict: &#123;&#x27;user&#x27;: [&#x27;ko&#x27;], &#x27;age&#x27;: [&#x27;19&#x27;]&#125; &gt;</span></span><br><span class="line">    <span class="built_in">print</span>(request.GET)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># &lt;class &#x27;django.http.request.QueryDict&#x27;&gt;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(request.GET))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 19</span></span><br><span class="line">    <span class="built_in">print</span>(request.GET.get(<span class="string">&quot;age&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(request.GET.get(<span class="string">&quot;age&quot;</span>)))</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;index.html&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="1-1-4-POST请求知识扩展"><a href="#1-1-4-POST请求知识扩展" class="headerlink" title="1.1.4 POST请求知识扩展"></a>1.1.4 POST请求知识扩展</h5><blockquote>
<p>Post提交数据的几种方式</p>
<p><a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/9432b55ba16925c52cc58bd63186bceb19e8ede5.html">https://wenku.baidu.com/view/9432b55ba16925c52cc58bd63186bceb19e8ede5.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cheress/article/details/113030081">https://blog.csdn.net/cheress/article/details/113030081</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liyantianmin/article/details/91492135">https://blog.csdn.net/liyantianmin/article/details/91492135</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hahaha111122222/p/14349812.html">https://www.cnblogs.com/hahaha111122222/p/14349812.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cf4f395347e8?u_atoken=7d3ef8d0-cc89-4ded-9703-93649c89937d&amp;u_asession=01N3sFT5YOp4JpqgmV-cOHQyK2hr1LDlibUwnqBMZrNTvsTUTzSww7QPNL-_rel4P7X0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K_lJj4ZGt_093nafvxQoI3-MKWrbBzYAhXhkL4v5_cjQmBkFo3NEHBv0PZUm6pbxQU&amp;u_asig=05cOLe0D_m46_MUQXrZd9nkBYhElZhMZra74wlj19FjtSKuMSK6lpdFb18QrJYyijIcE6gfYXqcWW0QNsfCpPsPUhAyZWbQGoCiTuXNuTgtePLr4p6nycrNRerqP1UoEGj3DdOLf8P37N4a5sPqwEcE2ThydPgapMoI_hft2I3hkv9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzYNlG-spcJl3Bjpy344qS7O5IN2QVE9vNUz-HW7jV6z8df9JIAkyKervFWgmMgV8j-3h9VXwMyh6PgyDIVSG1W_M8W7hYpolf9WK8gAqynFvntxszIC-jZ3XnMw67JPJQ0D1VPAyD0j6vmt0vrdGriYru-vXQCXeHMnZd9iioZRVmWspDxyAEEo4kbsryBKb9Q&amp;u_aref=5yhoGMDXSG57iRSyUfORFEMb/k8=">https://www.jianshu.com/p/cf4f395347e8?u_atoken=7d3ef8d0-cc89-4ded-9703-93649c89937d&amp;u_asession=01N3sFT5YOp4JpqgmV-cOHQyK2hr1LDlibUwnqBMZrNTvsTUTzSww7QPNL-_rel4P7X0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K_lJj4ZGt_093nafvxQoI3-MKWrbBzYAhXhkL4v5_cjQmBkFo3NEHBv0PZUm6pbxQU&amp;u_asig=05cOLe0D_m46_MUQXrZd9nkBYhElZhMZra74wlj19FjtSKuMSK6lpdFb18QrJYyijIcE6gfYXqcWW0QNsfCpPsPUhAyZWbQGoCiTuXNuTgtePLr4p6nycrNRerqP1UoEGj3DdOLf8P37N4a5sPqwEcE2ThydPgapMoI_hft2I3hkv9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzYNlG-spcJl3Bjpy344qS7O5IN2QVE9vNUz-HW7jV6z8df9JIAkyKervFWgmMgV8j-3h9VXwMyh6PgyDIVSG1W_M8W7hYpolf9WK8gAqynFvntxszIC-jZ3XnMw67JPJQ0D1VPAyD0j6vmt0vrdGriYru-vXQCXeHMnZd9iioZRVmWspDxyAEEo4kbsryBKb9Q&amp;u_aref=5yhoGMDXSG57iRSyUfORFEMb%2Fk8%3D</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/89820a36d2e0">https://www.jianshu.com/p/89820a36d2e0</a></p>
</blockquote>
<blockquote>
<p>这个可以多看看</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7987a88f3022">https://www.jianshu.com/p/7987a88f3022</a></p>
</blockquote>
<h5 id="1-1-5-编码方式知识扩展"><a href="#1-1-5-编码方式知识扩展" class="headerlink" title="1.1.5 编码方式知识扩展"></a>1.1.5 编码方式知识扩展</h5><blockquote>
<p>字符编码：ASCII 与 UTF-8编码</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/salvare/article/details/82941165">https://blog.csdn.net/salvare/article/details/82941165</a></p>
</blockquote>
<h4 id="1-3-request-path相关"><a href="#1-3-request-path相关" class="headerlink" title="1.3 request.path相关"></a>1.3 request.path相关</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    ret = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;request.path:&quot;</span>, request.path)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;request.path_info:&quot;</span>, request.path_info)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;request.get_full_path():&quot;</span>, request.get_full_path())</span><br><span class="line"></span><br><span class="line">        ret[<span class="string">&quot;method&quot;</span>] = request.method</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(json.dumps(ret))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>访问路由时不带参数</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719134245748.png" class="" title="image-20220719134245748">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719133926159.png" class="" title="image-20220719133926159">

<blockquote>
<p>访问路由时带参数</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719134228415.png" class="" title="image-20220719134228415">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719134140233.png" class="" title="image-20220719134140233">

<h5 id="1-1-1-path属性-推荐"><a href="#1-1-1-path属性-推荐" class="headerlink" title="1.1.1 path属性(推荐)"></a>1.1.1 path属性(推荐)</h5><blockquote>
<p>获取的是不带域名、不带?号后面参数的路由部分</p>
</blockquote>
<h5 id="1-1-1-path-info属性-不推荐"><a href="#1-1-1-path-info属性-不推荐" class="headerlink" title="1.1.1 path_info属性(不推荐)"></a>1.1.1 path_info属性(不推荐)</h5><blockquote>
<p>获取的是不带域名、不带?号后面参数的路由部分</p>
</blockquote>
<h5 id="1-1-1-get-full-path方法"><a href="#1-1-1-get-full-path方法" class="headerlink" title="1.1.1 get_full_path方法"></a>1.1.1 get_full_path方法</h5><blockquote>
<p>注意：</p>
<ul>
<li>当访问路由时没有参数，get_full_path方法和path、path_info属性获取到的路由都一样</li>
<li>当访问路由时带了参数，get_full_path方法会<code>将路由和?号后面的参数都一起返回</code></li>
</ul>
</blockquote>
<h4 id="1-4-request-body相关"><a href="#1-4-request-body相关" class="headerlink" title="1.4 request.body相关"></a>1.4 request.body相关</h4><blockquote>
<p>返回的是原生浏览器发过来的二进制数据</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = request.body</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719135113740.png" class="" title="image-20220719135113740">



<h3 id="10、Pycharm操作Django技巧"><a href="#10、Pycharm操作Django技巧" class="headerlink" title="10、Pycharm操作Django技巧"></a>10、Pycharm操作Django技巧</h3><h4 id="1-1-快速创建Django应用"><a href="#1-1-快速创建Django应用" class="headerlink" title="1.1 快速创建Django应用"></a>1.1 快速创建Django应用</h4><img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211216001638808.png" class="" title="image-20211216001638808">

<h4 id="1-2-修改Django端口"><a href="#1-2-修改Django端口" class="headerlink" title="1.2 修改Django端口"></a>1.2 修改Django端口</h4><img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211216001717991.png" class="" title="image-20211216001717991">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211216001748598.png" class="" title="image-20211216001748598">

<h4 id="1-3-浏览器访问页面不走缓存"><a href="#1-3-浏览器访问页面不走缓存" class="headerlink" title="1.3 浏览器访问页面不走缓存"></a>1.3 浏览器访问页面不走缓存</h4><blockquote>
<p>谷歌浏览器打开F12，找到设置，勾选下面的选项即可</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211227235948716.png" class="" title="image-20211227235948716">

<h3 id="11、路由"><a href="#11、路由" class="headerlink" title="11、路由"></a>11、路由</h3><h4 id="1-1-路由匹配"><a href="#1-1-路由匹配" class="headerlink" title="1.1 路由匹配"></a>1.1 路由匹配</h4><blockquote>
<p>Django中的路由是通过正则进行匹配的</p>
</blockquote>
<blockquote>
<p>当用浏览器访问url的时候，比如这样的路由”url(r’^add_course&#x2F;‘, views.add_course)”，在浏览器地址栏输入url时，“add_course”不带最后的“&#x2F;”，浏览器会发起两次请求，第二次浏览器会自动带上“&#x2F;”，然后匹配到”add_course“这个url，这个是Django提供的功能，提供了重定向功能，告知浏览器加上&#x2F;再试一次</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717221742390.png" class="" title="image-20220717221742390">

<blockquote>
<p>在Django中的settings.py里控制是否自动添加&#x2F;，默认是<code>Ture</code></p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717221932804.png" class="" title="image-20220717221932804">



<h4 id="1-2-无名分组"><a href="#1-2-无名分组" class="headerlink" title="1.2 无名分组"></a>1.2 无名分组</h4><h5 id="1-1-1-无名分组使用"><a href="#1-1-1-无名分组使用" class="headerlink" title="1.1.1 无名分组使用"></a>1.1.1 无名分组使用</h5><blockquote>
<p>Django支持在url中设置变量来接收传进来的值，本质就是通过正则表达式来匹配</p>
<p>分组其实就是给一段正则表达式用小括号括起来，进行匹配路由里的参数</p>
<p>注意：</p>
<ul>
<li>无名分组是将括号内的正则表达式匹配的内容当做<code>位置参数</code>传递给后面的视图函数</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无名分组</span></span><br><span class="line">url(<span class="string">r&#x27;^query_my_course/(\d+)/&#x27;</span>, views.query_my_course),</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图函数里需要有一个位置参数来接收正则表达式匹配到的内容</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_my_course</span>(<span class="params">request, num</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;传进来的参数:<span class="subst">&#123;num&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f&quot;传进来的参数:<span class="subst">&#123;num&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717223147671.png" class="" title="image-20220717223147671">

<blockquote>
<p>上面调用接口，服务端代码里就可以接收到正则表达式匹配到的内容</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717223116129.png" class="" title="image-20220717223116129">

<h5 id="1-1-2-无名分组反向解析"><a href="#1-1-2-无名分组反向解析" class="headerlink" title="1.1.2 无名分组反向解析"></a>1.1.2 无名分组反向解析</h5><h4 id="1-3-有名分组"><a href="#1-3-有名分组" class="headerlink" title="1.3 有名分组"></a>1.3 有名分组</h4><h5 id="1-1-1-有名分组使用"><a href="#1-1-1-有名分组使用" class="headerlink" title="1.1.1 有名分组使用"></a>1.1.1 有名分组使用</h5><blockquote>
<p>相当于给正则匹配起了个别名，</p>
<ul>
<li>将括号内正则表达式匹配到的内容当做<code>关键字参数</code>传递给后面的视图函数</li>
<li>那么括号内的正则表达式匹配的内容当做<code>位置参数</code>传递给后面的视图函数，<code>位置参数名</code>必须要和正则表达式起的别名一样，否则就会报错</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 有名分组</span></span><br><span class="line">url(<span class="string">r&#x27;^collect_new_course/(?P&lt;levelId&gt;\d+)/&#x27;</span>, views.collect_new_course),</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">collect_new_course</span>(<span class="params">request, levelId</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;year=<span class="subst">&#123;levelId&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f&quot;collect_new_course传进来的参数:<span class="subst">&#123;levelId&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717235248369.png" class="" title="image-20220717235248369">

<blockquote>
<p>可以看到将URL中的数字匹配了出来，并且传递给了服务端的视图函数</p>
<p>那如果过视图函数不用这个有名的<code>levelId</code>接收传进来的值，会报什么错？</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">collect_new_course</span>(<span class="params">request, level_id</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;year=<span class="subst">&#123;level_id&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f&quot;collect_new_course传进来的参数:<span class="subst">&#123;level_id&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220718001017640.png" class="" title="image-20220718001017640">

<blockquote>
<p>翻译过来就是：collect_new_course()获得了一个意外的关键字参数“levelId”</p>
<p>原因是传入视图函数的<code>形参名level_id</code>和urls.py里定义的有名分组名称<code>levelId</code>不一样，应该是levelId，但是视图函数里传入的是level_id，所以视图提示报错得到了一个非预期的关键字参数<code>levelId</code></p>
</blockquote>
<h5 id="1-1-2-有名分组反向解析"><a href="#1-1-2-有名分组反向解析" class="headerlink" title="1.1.2 有名分组反向解析"></a>1.1.2 有名分组反向解析</h5><h4 id="1-4-有名分组和无名分组注意"><a href="#1-4-有名分组和无名分组注意" class="headerlink" title="1.4 有名分组和无名分组注意"></a>1.4 有名分组和无名分组注意</h4><blockquote>
<ul>
<li>有名分组和无名分组注意不能混合使用</li>
<li>但是<code>单独</code>的有名分组、无名分组可以使用多个</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 有名分组，urls.py文件中</span></span><br><span class="line">url(<span class="string">r&#x27;^collect_new_course/(?P&lt;levelId&gt;\d+)/(?P&lt;level_num&gt;\d+)&#x27;</span>, views.collect_new_course)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">collect_new_course</span>(<span class="params">request, levelId, level_num</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;level_id=<span class="subst">&#123;levelId&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;level_num=<span class="subst">&#123;level_num&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f&quot;collect_new_course传进来的参数:<span class="subst">&#123;levelId, level_num&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220718010544283.png" class="" title="image-20220718010544283">

<h4 id="1-5-路由分发"><a href="#1-5-路由分发" class="headerlink" title="1.5 路由分发"></a>1.5 路由分发</h4><blockquote>
<p>Django的每一个应用都可以有自己的<code>templates文件夹</code>、<code>urls.py</code>、<code>static文件夹</code></p>
<ul>
<li>基于上面的特性，Django可以非常好的做到分组开发，每个人只写自己的app</li>
<li>可以将所有写好的app汇总过来，在配置文件中注册所有的app，再利用路由分发的特点将所有的app整合起来</li>
</ul>
</blockquote>
<blockquote>
<p>路由分发的优点：</p>
<ul>
<li>利用路由分发以后，总路由不再处理路由和视图函数的直接对应关系，而只是进行分发处理(url指向需要找到的app)，然后根据识别到当前url是属于哪个应用下，然后分发给对应的应用去处理</li>
</ul>
</blockquote>
<h5 id="1-1-1-路由分发第一步"><a href="#1-1-1-路由分发第一步" class="headerlink" title="1.1.1 路由分发第一步"></a>1.1.1 路由分发第一步</h5><blockquote>
<p>app用来代表不同的应用简写，没有别的含义，比如<code>订单应用</code>、<code>用户应用</code>等等</p>
<p>在app目录中添加一个url.py文件</p>
<ul>
<li><p>在项目的settings.py中提前注册app</p>
</li>
<li><p>app&#x2F;urls.py的内容可以拷贝项目目录中的urls.py文件内容，将app的路由都写在app&#x2F;urls.py文件中</p>
<ul>
<li>需要再app&#x2F;urls.py中导入app的views，然后views再指向具体的视图函数</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在app目录中添加urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> home <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;index/&#x27;</span>, views.index)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719000055842.png" class="" title="image-20220719000055842">

<blockquote>
<p>可以看到将home应用所有的url都放在了home&#x2F;urls.py文件中</p>
</blockquote>
<h5 id="1-1-2-路由分发第二步"><a href="#1-1-2-路由分发第二步" class="headerlink" title="1.1.2 路由分发第二步"></a>1.1.2 路由分发第二步</h5><blockquote>
<p>在项目总路由中添加应用的路由分发，需要提前导入<code>include</code>方法</p>
<p>有两种写法</p>
<ul>
<li>方法一（不推荐）<ul>
<li>先从应用导入urls：<code>from home import urls as home_url</code></li>
<li>然后urlpatterns中添加：<code>url(r&#39;^home/&#39;, include(home_url))</code>，include中包含了导入的路由</li>
</ul>
</li>
<li>方法二（推荐）<ul>
<li>不用写需要导入urls</li>
<li>然后urlpatterns中添加：<code>url(r&#39;^home/&#39;, include(&quot;home.urls&quot;)</code><ul>
<li>include中是一个字符串，应用名.urls组成，这样Django会自动识别应用下的urls文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>注意：</p>
<ul>
<li>总路由的url中不能添加<code>$</code>符号，加了就不能往对应的app中进行分发了</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目的urls.py文件</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> home <span class="keyword">import</span> urls <span class="keyword">as</span> home_url</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 路由分发</span></span><br><span class="line">    <span class="comment"># 不推荐：只要路由前缀是home开头的，全部交给home去处理</span></span><br><span class="line">    <span class="comment"># url(r&#x27;^home/&#x27;, include(home_url))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 推荐写法：</span></span><br><span class="line">    url(<span class="string">r&#x27;^home/&#x27;</span>, include(<span class="string">&quot;home.urls&quot;</span>))</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719001034991.png" class="" title="image-20220719001034991">

<h5 id="1-1-3-访问路由分发的应用"><a href="#1-1-3-访问路由分发的应用" class="headerlink" title="1.1.3 访问路由分发的应用"></a>1.1.3 访问路由分发的应用</h5><blockquote>
<p>有了路由分发以后，访问路由就需要前带上应用名，再去访问应用里具体的路由</p>
<p>比如：访问home应用的<code>user_info</code>路由，应该写成<code>http://127.0.0.1:8000/home/user_info/</code></p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719001235306.png" class="" title="image-20220719001235306">

<blockquote>
<p>可以看到django的路由指向就是指向了<code>home/user_info/</code>路由中</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719001325890.png" class="" title="image-20220719001325890">

<blockquote>
<p>路由分发后面就可以根据应用(也可以叫模块)区分路由，比如用户应用(管理用户内容的，比如注册、查询、修改、注销等)、订单应用(管理订单相关内容，比如创建订单、支付订单、查询订单、关闭订单等等)</p>
</blockquote>
<h4 id="1-6-名称空间（了解）"><a href="#1-6-名称空间（了解）" class="headerlink" title="1.6 名称空间（了解）"></a>1.6 名称空间（了解）</h4><blockquote>
<p>当多个应用出现了相同的别名，反向解析是没法自动识别相同的别名的前缀的，用的很少</p>
</blockquote>
<h4 id="1-7-伪静态（了解）"><a href="#1-7-伪静态（了解）" class="headerlink" title="1.7 伪静态（了解）"></a>1.7 伪静态（了解）</h4><blockquote>
<p>其实就是把一个动态网页伪装成静态网页，乐嘉增大网站的seo查询热度，增加搜索引擎的查询概率，用的很少</p>
<p>用法就是在具体的路由后面加<code>.html</code>，伪装成一个静态网页，比如：<code>http://127.0.0.1:8000/home/user_info.html</code></p>
</blockquote>
<h3 id="12、JsonResponse对象"><a href="#12、JsonResponse对象" class="headerlink" title="12、JsonResponse对象"></a>12、JsonResponse对象</h3><blockquote>
<p>Django中返回的响应对象常见的有两个</p>
<ul>
<li><p>HttpResponse</p>
<ul>
<li>返回的是字符串类型</li>
</ul>
</li>
<li><p>JsonResponse</p>
<ul>
<li>是一个HTTP响应类，传进来的数据将被序列化为JSON格式</li>
<li><code>JsonResponse</code>中传入的数据。默认情况下，只支持<code>dict</code>对象<ul>
<li>由于EcmaScript 5之前的安全漏洞，只允许传递<code>dict</code>对象，参见更多信息请参见<code>safe</code>参数</li>
<li><code>safe</code>参数控制是否只有<code>dict</code>对象可以被序列化，默认为”True”，这样就只支持<code>dict</code>对象被序列化</li>
<li>如果需要支持非<code>dict</code>对象被序列化，那<code>safe</code>参数需要设置为<code>False</code></li>
</ul>
</li>
<li><code>JsonResponse</code>本身内部就是调用的<code>json</code>库进行序列化的，如果序列化时有中文，用postman等接口工具调用接口时，返回的响应内容中文会变乱码，那么就需要添加参数控制中文被原样输出，而不是被转换<ul>
<li>参数<code>json_dumps_params</code>可以以字典形式接收json库里支持的其他参数</li>
<li>传递给json.dumps()的一个kwargs字典，把json库里的参数传进去，<code>ensure_ascii=False</code>表示不用ASCII编码方式，因为ASCII编码不支持中文，遇到中文就会乱码</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部分代码</span></span><br><span class="line">ret = &#123;<span class="string">&quot;msg&quot;</span>: <span class="string">f&quot;不支持的请求方法:<span class="subst">&#123;request.method&#125;</span>&quot;</span>&#125;</span><br><span class="line"><span class="keyword">return</span> JsonResponse(ret, json_dumps_params=&#123;<span class="string">&quot;ensure_ascii&quot;</span>: <span class="literal">False</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化非字典结果，需要设置safe参数</span></span><br><span class="line">ret = &#123;<span class="string">&quot;msg&quot;</span>: <span class="string">f&quot;不支持的请求方法:<span class="subst">&#123;request.method&#125;</span>&quot;</span>&#125;</span><br><span class="line"><span class="keyword">return</span> JsonResponse(ret, json_dumps_params=&#123;<span class="string">&quot;ensure_ascii&quot;</span>: <span class="literal">False</span>&#125;, safe=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>不加safe&#x3D;False参数，输出非dict对象时，就会报错</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220716000407609.png" class="" title="image-20220716000407609">

<h3 id="13、文件上传操作"><a href="#13、文件上传操作" class="headerlink" title="13、文件上传操作"></a>13、文件上传操作</h3><blockquote>
<p>文件上传是属于form表单里的功能</p>
<p>form表单上传文件类型的数据要求</p>
<ul>
<li><code>method</code>必须是<code>post</code></li>
<li><code>enctype</code>必须是<code>formdata</code></li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传文件使用的是FILES方法，和GET、POST获取参数值的方法一样</span></span><br><span class="line">file_obj = request.FILES.get(<span class="string">&quot;user_img&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">upload_avatar</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        file_obj = request.FILES.get(<span class="string">&quot;user_img&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;file name:<span class="subst">&#123;file_obj, <span class="built_in">type</span>(file_obj)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;file name:<span class="subst">&#123;file_obj.name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_obj.name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> file_obj.chunks():</span><br><span class="line">                f.write(line)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;上传用户头像成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f&quot;不支持的请求方法:<span class="subst">&#123;request.method&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719011457599.png" class="" title="image-20220719011457599">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220719011511729.png" class="" title="image-20220719011511729">

<blockquote>
<p>request.FILES.get(“上传文件的key”)，这种获取文件对象的想法和<code>GET</code>&#x2F;<code>POST</code>获取请求参数的值一样</p>
<p>FILES方法获取到的file_obj：</p>
<ul>
<li>file_obj的值是：<code>InMemoryUploadedFile: p1.jpeg (image/jpeg)</code></li>
<li>file_obj的类型：<code>class &#39;django.core.files.uploadedfile.InMemoryUploadedFile&#39;</code></li>
<li>file_obj.name：可以通过获取到的文件对象<code>.name</code>属性来获取上传的文件名，然后保存到本地或其他地方</li>
</ul>
</blockquote>
<h3 id="14、FBV和CBV"><a href="#14、FBV和CBV" class="headerlink" title="14、FBV和CBV"></a>14、FBV和CBV</h3><h4 id="1-1-FBV"><a href="#1-1-FBV" class="headerlink" title="1.1 FBV"></a>1.1 FBV</h4><h4 id="1-2-CBV"><a href="#1-2-CBV" class="headerlink" title="1.2 CBV"></a>1.2 CBV</h4><h2 id="三、ORM数据库"><a href="#三、ORM数据库" class="headerlink" title="三、ORM数据库"></a>三、ORM数据库</h2><h3 id="1、Pycharm连接数据库"><a href="#1、Pycharm连接数据库" class="headerlink" title="1、Pycharm连接数据库"></a>1、Pycharm连接数据库</h3><blockquote>
<p>使用<code>docker</code>可以快速创建<code>mysql</code>等数据库，用来快速搭建想要的环境</p>
</blockquote>
<h4 id="1-1-mac下连接docker的mysql"><a href="#1-1-mac下连接docker的mysql" class="headerlink" title="1.1 mac下连接docker的mysql"></a>1.1 mac下连接docker的mysql</h4><blockquote>
<p>步骤：</p>
<ul>
<li>创建一个<code>mysql</code>容器，拉取<code>mysql:5.7</code>镜像，再去创建容器，此处可以查看mysql笔记中记录了如何创建容器</li>
<li>注意<ul>
<li>创建完的数据库默认用户是root，密码使用<code>-e MYSQL_ROOT_PASSWORD=123456</code>设置为123456</li>
<li>创建完以后需要登录容器内部，给root用户开启远程访问权限，否则在容器外部会出现访问数据库失败的情况</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取mysql容器，选择5.7版本的tag，不写5.7则会拉取8版本，8版本对我们来说太新了</span></span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line">docker run -dit --name mysql -p 3306:3306  -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7</span><br><span class="line"><span class="comment">#  表示设置数据库用户root的密码为123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录容器，赋予root远程登录权限</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录mysql容器后，配置远程访问权限</span></span><br><span class="line">&gt;&gt; grant all privileges on *.* to root@<span class="string">&quot;%&quot;</span> identified by <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">&gt;&gt; flush privileges ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面配置完成退出数据库，就可以在容器外部连接mysql了</span></span><br><span class="line">mysql -uroot -h127.0.0.1 -p123456</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在上述配置好以后，就可以在<code>pycharm</code>中打开<code>mysql</code>连接界面，进行连接数据库了，下面用截图表示</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220104075847993.png" class="" title="image-20220104075847993">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220104075948885.png" class="" title="image-20220104075948885">

<blockquote>
<p>需要先下载对应数据库的驱动，上图配置界面会提示下载，点击下载即可</p>
<p>主机：数据库的地址，因为是本地连接，所以是127.0.0.1</p>
<p>端口：3306不变</p>
<p>用户、密码：数据库的用户和密码</p>
<p>数据库：提前创建好的数据名，需要提前在数据库中创建才可以进行连接</p>
<p>上面连接信息填写完以后，点击<code>测试连接</code>即可快速验证数据库是否连接成功，若未成功，需要检查下配置是否正确</p>
</blockquote>
<h4 id="1-2-windows下连接docker的mysql"><a href="#1-2-windows下连接docker的mysql" class="headerlink" title="1.2 windows下连接docker的mysql"></a>1.2 windows下连接docker的mysql</h4><blockquote>
<p><code>windows</code>下也可以用<code>docker</code>的<code>mysql</code>，一般可以在<code>linux</code>虚拟机里安装docker，在启动mysql容器</p>
<p>所以拉取<code>mysql</code>镜像,修改<code>mysql</code>的<code>root</code>权限、在<code>pycharm</code>中配置等步骤都和上面的<code>mac</code>配置一样</p>
<p>唯一区别在于：</p>
<ul>
<li>windows下的<code>pycharm</code>想连接虚拟机里的docker的<code>mysql</code>容器，需要使用<code>pycharm</code>的<code>ssh隧道</code>功能先连接上虚拟机，再去连接虚拟机里的数据库</li>
<li>下图展示了如何配置</li>
</ul>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220104080802817.png" class="" title="image-20220104080802817">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220104080909084.png" class="" title="image-20220104080909084">

<blockquote>
<p>虚拟机连接上后，再配置数据库连接</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220104081033712.png" class="" title="image-20220104081033712">

<blockquote>
<p>到这里数据库连接配置完成，可以在<code>pycharm</code>进行<code>django</code>的数据库连接了</p>
</blockquote>
<h3 id="2、Django连接Mysql"><a href="#2、Django连接Mysql" class="headerlink" title="2、Django连接Mysql"></a>2、Django连接Mysql</h3><h4 id="2-1-配置mysql连接"><a href="#2-1-配置mysql连接" class="headerlink" title="2.1 配置mysql连接"></a>2.1 配置mysql连接</h4><blockquote>
<p><code>Django</code>连接数据库时，需要先创建好数据库</p>
<p><code>Django</code>自带了一个小型数据库<code>sqlite3</code>，这个数据库比较小，我们可以不用他，换成<code>mysql</code></p>
<p><code>Django</code>如何连接<code>mysql</code></p>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.11/ref/settings/#databases">官方地址: https://docs.djangoproject.com/en/1.11/ref/settings/#databases</a></p>
<p>注意一定要在<code>settings.py</code>文件中注册<code>APP</code>，否则会出现数据库迁移失败的情况</p>
</blockquote>
<blockquote>
<p><code>Django</code>连接mysql需要在<code>settings.py</code>中指定连接数据的名字、用户名、密码、端口</p>
<p><code>Django</code>连接数据库一定要先创建数据库，再去<code>settings.py</code>里去连接</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py文件，大概78行</span></span><br><span class="line"><span class="comment"># Database</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/1.11/ref/settings/#databases</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是默认的sqlite3连接，可以注释掉，连接mysql</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: os.path.join(BASE_DIR, <span class="string">&#x27;db.sqlite3&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接mysql</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;mydatabase&#x27;</span>,   </span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;mydatabaseuser&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;mypassword&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;5432&#x27;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20211228010019204.png" class="" title="image-20211228010019204">

<h4 id="2-2-配置mysql启动Django错误修复"><a href="#2-2-配置mysql启动Django错误修复" class="headerlink" title="2.2 配置mysql启动Django错误修复"></a>2.2 配置mysql启动Django错误修复</h4><blockquote>
<p>在settings里配置了mysql以后，启动django就会报如下错误</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220714233845467.png" class="" title="image-20220714233845467">

<blockquote>
<p>错误信息：这个提示是没有<code>MySQLdb</code>模块，</p>
<p>Django默认用的是<code>MySQLdb</code>模块来连接数据库，但是<code>MySQLdb</code>模块兼容性不好，而且容易出错，所以需要我们去手动指定连接mysql数据库的第三库<code>pymysql</code></p>
</blockquote>
<blockquote>
<p>手动配置pymysql方法：</p>
<ul>
<li>先安装pymysql：<code>pip install pymysql</code></li>
<li>下面方法任选一个<ul>
<li>在Django的项目目录(包含urls.py、settings.py的目录)里有一个<code>__init__.py</code>的文件，在里面添加如下代码<ul>
<li>这样相当于做到了全局配置，每个app目录里就不用配置了</li>
</ul>
</li>
<li>在Django每个app目录下，都有一个<code>__init__.py</code>的文件，在里面添加如下代码</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在Django的项目目录的__init__.py的文件</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220714234643171.png" class="" title="image-20220714234643171">

<blockquote>
<p>配置完成后再次启动就可以了</p>
</blockquote>
<h4 id="2-3-设置Django的时区"><a href="#2-3-设置Django的时区" class="headerlink" title="2.3 设置Django的时区"></a>2.3 设置Django的时区</h4><blockquote>
<p>使用mysql数据时，需要考虑设置时区为国内，否则数据库中存储的时间和国内时间差8个小时</p>
<p>下面是解决办法：</p>
<ul>
<li>在Django的配置文件settings.py中，有两个配置参数是跟时间与时区有关的，分别是TIME_ZONE和USE_TZ<ul>
<li>如果USE_TZ设置为True时，Django会使用系统默认设置的时区，即America&#x2F;Chicago，此时的TIME_ZONE不管有没有设置都不起作用。</li>
<li>如果USE_TZ 设置为False，而TIME_ZONE设置为None，则Django还是会使用默认的America&#x2F;Chicago时间。若TIME_ZONE设置为其它时区(比如国内)的话，则还要分情况<ul>
<li>如果是Windows系统，则TIME_ZONE设置是没用的，Django会使用本机的时间。</li>
<li>如果为其他系统，则使用该时区的时间，入设置USE_TZ &#x3D; False, TIME_ZONE &#x3D; ‘Asia&#x2F;Shanghai’, 则使用上海的UTC时间</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="3、ORM的使用"><a href="#3、ORM的使用" class="headerlink" title="3、ORM的使用"></a>3、ORM的使用</h3><h4 id="3-1-ORM简介"><a href="#3-1-ORM简介" class="headerlink" title="3.1 ORM简介"></a>3.1 ORM简介</h4><blockquote>
<p><code>ORM</code>：对象关系映射</p>
<p>主要是用来将mysql语句通过面向对象去执行</p>
<p>主要是在<code>Django</code>的<code>app</code>的<code>models.py</code>文件中写创建表语句，以面向对象的形式</p>
</blockquote>
<h4 id="3-2-ORM编写建表语句"><a href="#3-2-ORM编写建表语句" class="headerlink" title="3.2 ORM编写建表语句"></a>3.2 ORM编写建表语句</h4><blockquote>
<p>需要在对应<code>app</code>的models.py&#96;文件中写数据库的面向对象代码</p>
<p>models官方教程：<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.0/intro/tutorial02/">https://docs.djangoproject.com/zh-hans/4.0/intro/tutorial02/</a></p>
</blockquote>
<h5 id="3-2-1-AutoField字段"><a href="#3-2-1-AutoField字段" class="headerlink" title="3.2.1 AutoField字段"></a>3.2.1 AutoField字段</h5><blockquote>
<p>表示一个自增列，等同于int，必须将给列设置为主键（primary_key&#x3D;True）</p>
</blockquote>
<h5 id="3-2-2-CharField字段"><a href="#3-2-2-CharField字段" class="headerlink" title="3.2.2 CharField字段"></a>3.2.2 CharField字段</h5><blockquote>
<p>当定义字段为CharField时，一定要指定<code>max_length</code>参数，不指定就会直接报错</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">32</span>)</span><br></pre></td></tr></table></figure>

<h5 id="3-2-3-DateTimeField字段"><a href="#3-2-3-DateTimeField字段" class="headerlink" title="3.2.3 DateTimeField字段"></a>3.2.3 DateTimeField字段</h5><blockquote>
<p>日期时间类型（datetime），官网对于<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.0/ref/models/fields/#django.db.models.DateTimeField">DateTimeField</a>字段解释</p>
<p>支持两个参数：</p>
<ul>
<li><p><code>auto_now_add=True</code>：则只是第一次创建添加，之后的更新不再改变该值，比较适合作为<code>创建时间</code></p>
</li>
<li><p><code>auto_now=True</code>：则每次更新都会更新这个时间，比较适合作为<code>更新时间</code></p>
</li>
</ul>
</blockquote>
<h5 id="3-2-4-DateField字段"><a href="#3-2-4-DateField字段" class="headerlink" title="3.2.4 DateField字段"></a>3.2.4 DateField字段</h5><blockquote>
<p>日期类型 date，对于参数和DateTimeField字段一样</p>
</blockquote>
<h5 id="3-2-5-verbose-name参数"><a href="#3-2-5-verbose-name参数" class="headerlink" title="3.2.5 verbose_name参数"></a>3.2.5 verbose_name参数</h5><blockquote>
<p>可以给每个字段都加一个verbose_name字段，这样启用django的admin平台查看数据库字段时，就是中文的</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比如</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">&quot;用户名&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="3-2-6-编写示例"><a href="#3-2-6-编写示例" class="headerlink" title="3.2.6 编写示例"></a>3.2.6 编写示例</h5><blockquote>
<p>下面是创建了一个User表语句代码</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CourseLevel</span>(models.Model):</span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>, name=<span class="string">&quot;主键ID&quot;</span>, verbose_name=<span class="string">&quot;主键ID&quot;</span>)</span><br><span class="line">    level_name = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">&quot;级别名称&quot;</span>)</span><br><span class="line">    level_desc = models.CharField(max_length=<span class="number">64</span>, verbose_name=<span class="string">&quot;级别描述&quot;</span>)</span><br><span class="line">    db_ctime = models.DateTimeField(auto_now_add=<span class="literal">True</span>, verbose_name=<span class="string">&quot;创建时间&quot;</span>)</span><br><span class="line">    db_utime = models.DateTimeField(auto_now=<span class="literal">True</span>, verbose_name=<span class="string">&quot;更新时间&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="3-2-7-表字段注释"><a href="#3-2-7-表字段注释" class="headerlink" title="3.2.7 表字段注释"></a>3.2.7 表字段注释</h5><blockquote>
<p>django的model默认不支持数据库建表语句字段添加注释的，<a target="_blank" rel="noopener" href="https://blog.csdn.net/Tomonkey/article/details/116663370?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-116663370-blog-120064590.pc_relevant_multi_platform_whitelistv2&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-116663370-blog-120064590.pc_relevant_multi_platform_whitelistv2&utm_relevant_index=1">可参考这个教程</a></p>
</blockquote>
<h4 id="3-3-Django数据库迁移命令"><a href="#3-3-Django数据库迁移命令" class="headerlink" title="3.3 Django数据库迁移命令"></a>3.3 Django数据库迁移命令</h4><h5 id="3-3-1-生成迁移记录"><a href="#3-3-1-生成迁移记录" class="headerlink" title="3.3.1 生成迁移记录"></a>3.3.1 生成迁移记录</h5><blockquote>
<p>下面的命令，主要用来生成数据库建表语句记录，下面的命令只是生成记录，还没有真正在数据库中执行创建表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行后会在对应<code>app</code>的<code>migrations</code>文件夹下生成一个类似<code>0001_initial.py</code>的文件，主要记录了建表语句</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220105234018673.png" class="" title="image-20220105234018673">

<h5 id="3-3-2-查看真正的建表语句"><a href="#3-3-2-查看真正的建表语句" class="headerlink" title="3.3.2 查看真正的建表语句"></a>3.3.2 查看真正的建表语句</h5><blockquote>
<p>生成数据库迁移文件以后，有个命令可查看真正的建表语句，在项目根目录下执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python manage.py sqlmigrate home 0001_initial</span><br><span class="line"><span class="comment"># sqlmigrate 用来打印真正的建表语句命令</span></span><br><span class="line"><span class="comment"># home 对应是home这个app</span></span><br><span class="line"><span class="comment"># 0001_initial 这个是数据库迁移文件，目录是在app/migrations里面，要查看哪次的迁移建表语句就直接写那个文件</span></span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220715004826972.png" class="" title="image-20220715004826972">

<h5 id="3-3-3-真正同步数据到数据库"><a href="#3-3-3-真正同步数据到数据库" class="headerlink" title="3.3.3 真正同步数据到数据库"></a>3.3.3 真正同步数据到数据库</h5><blockquote>
<p>下面命令，将操作真正同步到数据库中</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在数据库中就能看到迁移过来的表，同时我们创建表命名规则是： app名 + 下划线 + models中的类名小写</p>
<p>这样以后有多个app时，就可以用app名区分开表了</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220715005007418.png" class="" title="image-20220715005007418">

<blockquote>
<p>查看数据库中的真正建表语句</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220715005247735.png" class="" title="image-20220715005247735">

<h5 id="3-3-4-migrate不成功原因"><a href="#3-3-4-migrate不成功原因" class="headerlink" title="3.3.4 migrate不成功原因"></a>3.3.4 migrate不成功原因</h5><blockquote>
<p>执行migrate不成功原因，是django在app&#x2F;migrations目录下生成的迁移文件名不是<code>initial</code>结尾的</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220731012701596.png" class="" title="image-20220731012701596">





<h4 id="3-4-ORM的优化点"><a href="#3-4-ORM的优化点" class="headerlink" title="3.4 ORM的优化点"></a>3.4 ORM的优化点</h4><blockquote>
<p>在表里面一般都有<code>id</code>字段，表示主键字段</p>
<ul>
<li>在models.py中部定义id字段时，那么Django的ORM会自动创建一个叫<code>id</code>的字段，并且是自增的</li>
</ul>
</blockquote>
<h4 id="3-5-ORM字段的增删改查"><a href="#3-5-ORM字段的增删改查" class="headerlink" title="3.5 ORM字段的增删改查"></a>3.5 ORM字段的增删改查</h4><blockquote>
<p>需要对ORM字段进行增删改查时，注意是字段，不是数据</p>
</blockquote>
<h4 id="3-6-ORM表数据的增加"><a href="#3-6-ORM表数据的增加" class="headerlink" title="3.6 ORM表数据的增加"></a>3.6 ORM表数据的增加</h4><h5 id="3-6-1-增加数据"><a href="#3-6-1-增加数据" class="headerlink" title="3.6.1 增加数据"></a>3.6.1 增加数据</h5><blockquote>
<p>增加数据，相当于<code>mysql数据库</code>中的操作就是<code>insert into</code>操作</p>
</blockquote>
<blockquote>
<p>第一种增加数据方式</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.表名类.<span class="built_in">object</span>.create(字段名=字段值,字段名=字段值,...)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ORM操作数据库添加数据语法</span></span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">    level_name = request.POST.get(<span class="string">&quot;level_name&quot;</span>)</span><br><span class="line">    level_desc = request.POST.get(<span class="string">&quot;level_desc&quot;</span>)</span><br><span class="line">res = CourseLevel.objects.create(level_name=level_name, level_desc=level_desc)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;res:<span class="subst">&#123;res&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面代码表示从post请求里获取<code>level_name</code>和<code>level_desc</code>这两个参数值，然后保存到数据库中，并且返回了保存对象本身，然后就可以对返回的保存对象获取的的id以及其他信息，返回给调用者</p>
</blockquote>
<blockquote>
<p>第二种增加数据方式</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先实例化一个数据对象</span></span><br><span class="line">course_level_obj = models.CourseLevel(level_name=level_name, level_desc=level_desc)</span><br><span class="line">course_level_obj.save()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这种方式的保存数据是利用对象点属性方法的形式保存数据</p>
</blockquote>
<h4 id="3-7-ORM表数据的删除"><a href="#3-7-ORM表数据的删除" class="headerlink" title="3.7 ORM表数据的删除"></a>3.7 ORM表数据的删除</h4><blockquote>
<p>直接找到符合条件的数据对象(querySet集合)，然后全部删除，是批量删除操作</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">delete_course</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 先获取用户想要删除的数据对象id</span></span><br><span class="line">    level_id = request.GET.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="comment"># 直接找到符合条件的数据，全部删除，是一个批量删除操作</span></span><br><span class="line">    delete_obj = CourseLevel.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=level_id).delete()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;delete_obj=<span class="subst">&#123;delete_obj&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;删除成功&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="3-8-ORM表数据的更改"><a href="#3-8-ORM表数据的更改" class="headerlink" title="3.8 ORM表数据的更改"></a>3.8 ORM表数据的更改</h4><blockquote>
<p>表数据的修改其实就是在执行sql里的<code>update</code>操作</p>
<p>如何告诉后端用户想要编辑的数据：</p>
<ul>
<li>将编辑按钮所在的那一行数据的ID主键值给后端</li>
<li>利用url后面带参数的方式</li>
<li>注意：后端需要查出来用户想要编辑的数据对象，这样才能展示到前端页面让用户查看和编辑</li>
</ul>
<p>更新数据有两种方式</p>
</blockquote>
<h5 id="3-8-1-更新数据-推荐"><a href="#3-8-1-更新数据-推荐" class="headerlink" title="3.8.1 更新数据(推荐)"></a>3.8.1 更新数据(推荐)</h5><blockquote>
<p>更新的时候，需要先用filter方法根据条件查出来需要更新的数据，然后再更新数据，这个操作是<code>批量更新</code></p>
<p>该操作只修改需要修改的数据</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新数据，update里放的是需要更新的字段，更新成功以后，res返回1，更新失败返回0</span></span><br><span class="line">res = CourseLevel.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=level_id).update(level_name=level_name, level_desc=level_desc)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更新之前先查询数据</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717214852802.png" class="" title="image-20220717214852802">

<blockquote>
<p>更新数据，调用更新接口</p>
<p>更新成功以后，update_obj会返回1，更新失败会返回0</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_course</span>(<span class="params">request</span>):</span><br><span class="line">    msg = &#123;</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;更新成功&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="comment"># 拿到需要编辑的数据的id</span></span><br><span class="line">        level_id = request.POST.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        level_name = request.POST.get(<span class="string">&quot;level_name&quot;</span>)</span><br><span class="line">        level_desc = request.POST.get(<span class="string">&quot;level_desc&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 修改数据的方式</span></span><br><span class="line">        <span class="comment"># 将filter查询出来的列表中所有的对象全部更新，批量更新操作</span></span><br><span class="line">        update_obj = CourseLevel.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=level_id).update(level_name=level_name, level_desc=level_desc)</span><br><span class="line">        <span class="comment"># msg[&quot;data&quot;] = update_obj</span></span><br><span class="line">        <span class="built_in">print</span>(update_obj)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(msg)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717215153519.png" class="" title="image-20220717215153519">

<blockquote>
<p>上面更新执行完成后，再次查询数据，可以看到数据已经变为更新后的数据了</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717215209810.png" class="" title="image-20220717215209810">

<h5 id="3-8-2-更新数据-不推荐"><a href="#3-8-2-更新数据-不推荐" class="headerlink" title="3.8.2 更新数据(不推荐)"></a>3.8.2 更新数据(不推荐)</h5><blockquote>
<p>这个方法里是用save进行局部数据更新</p>
<ul>
<li><p>相当于是重新保存了一个新的数据对象</p>
</li>
<li><p>尤其是字段很多的时候，更新效率会很低</p>
</li>
<li><p>缺点</p>
<ul>
<li>会从头到尾将数据的所哟欧字段全部再更新一次，无论该字段是否需要需要</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先拿到需要修改的数据对象，然后通过对象.属性的方式编辑数据，最后save保存数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_course</span>(<span class="params">request</span>):</span><br><span class="line">    msg = &#123;</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;更新成功&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="comment"># 拿到需要编辑的数据的id</span></span><br><span class="line">        level_id = request.POST.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        level_name = request.POST.get(<span class="string">&quot;level_name&quot;</span>)</span><br><span class="line">        level_desc = request.POST.get(<span class="string">&quot;level_desc&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 修改数据的方式</span></span><br><span class="line">        <span class="comment"># 法二: filter查询出来的数据对象，挨个修改字段</span></span><br><span class="line">        update_obj = CourseLevel.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=level_id).first()</span><br><span class="line">        update_obj.<span class="built_in">id</span> = level_id</span><br><span class="line">        update_obj.level_name = level_name</span><br><span class="line">        update_obj.level_desc = level_desc</span><br><span class="line">        update_obj.save()</span><br><span class="line">        <span class="built_in">print</span>(update_obj)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(msg)</span><br></pre></td></tr></table></figure>

<h4 id="3-9-ORM表数据的查询"><a href="#3-9-ORM表数据的查询" class="headerlink" title="3.9 ORM表数据的查询"></a>3.9 ORM表数据的查询</h4><blockquote>
<p>数据的查询，对比到数据库中就是<code>select</code>操作</p>
<p>注意：</p>
<ul>
<li>如果可以查询到数据，就返回查询到的数据</li>
<li>如果查询不到，那么结果就返回<code>None</code></li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.表名类.<span class="built_in">object</span>.<span class="built_in">filter</span>(字段名=字段值,字段名=字段值,...)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面的查询后面可以添加一个<code>first</code>方法，这样表示取出查询结果的第一个</p>
</blockquote>
<h5 id="3-9-1-查询数据不调用first方法"><a href="#3-9-1-查询数据不调用first方法" class="headerlink" title="3.9.1 查询数据不调用first方法"></a>3.9.1 查询数据不调用first方法</h5><blockquote>
<p>在查询数据时不调用<code>first()</code>方法</p>
<ul>
<li>那么会根据filter()函数里传入的参数查询出所有符合条件的数据，有时候查询结果条数可能会大于一条，所以返回的查询结果是一个<code>QuerySet集合</code>，这个集合里的每个元素都是数据对象</li>
<li>QuerySet集合的类型是<code>&lt;class &#39;django.db.models.query.QuerySet&#39;&gt;</code></li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">query_course</span>(<span class="params">request</span>):</span><br><span class="line">    level_id = request.GET.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;level_id: <span class="subst">&#123;level_id&#125;</span>&quot;</span>) <span class="comment"># level_id: 2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 依据条件查询数据，不调用first功能</span></span><br><span class="line">    query_data_all = CourseLevel.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=level_id)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;query_data_all: <span class="subst">&#123;query_data_all&#125;</span>&quot;</span>)  <span class="comment"># query_data_all: &lt;QuerySet [&lt;CourseLevel: CourseLevel object&gt;]&gt;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;query_data_all type: <span class="subst">&#123;<span class="built_in">type</span>(query_data_all)&#125;</span>&quot;</span>) <span class="comment"># query_data_all type: &lt;class &#x27;django.db.models.query.QuerySet&#x27;&gt;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;请求了query_course&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220716004435541.png" class="" title="image-20220716004435541">

<h5 id="3-9-2-查询数据调用first方法"><a href="#3-9-2-查询数据调用first方法" class="headerlink" title="3.9.2 查询数据调用first方法"></a>3.9.2 查询数据调用first方法</h5><blockquote>
<p>在查询时调用<code>first()</code>方法，顾名思义，那就返回的是<code>QuertSet集合</code>的第一个数据对象，如果<code>QuerySet</code>集合为空，那么first方法会返回None</p>
<ul>
<li>从下面查询数据调用了<code>first</code>方法<ul>
<li>返回结果是一个数据对象</li>
<li>并且类型就是这个数据类型指向的类，其实就是models.py里定义的类</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># first方法源码，可以很清楚的看出来，是返回了第一个对象</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">first</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Returns the first object of a query, returns None if no match is found.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    objects = <span class="built_in">list</span>((self <span class="keyword">if</span> self.ordered <span class="keyword">else</span> self.order_by(<span class="string">&#x27;pk&#x27;</span>))[:<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> objects:</span><br><span class="line">        <span class="keyword">return</span> objects[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">query_course</span>(<span class="params">request</span>):</span><br><span class="line">    level_id = request.GET.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;level_id: <span class="subst">&#123;level_id&#125;</span>&quot;</span>) <span class="comment"># level_id: 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 依据条件查询数据，调用first功能</span></span><br><span class="line">    query_data_first = CourseLevel.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=level_id).first()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;query_data_first: <span class="subst">&#123;query_data_first&#125;</span>&quot;</span>)  <span class="comment"># query_data_first: CourseLevel object</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;query_data_first type: <span class="subst">&#123;<span class="built_in">type</span>(query_data_first)&#125;</span>&quot;</span>)  <span class="comment"># query_data_first type: &lt;class &#x27;home.models.CourseLevel&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;请求了query_course&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220716005858006.png" class="" title="image-20220716005858006">

<h5 id="3-9-3-查询所有数据-不推荐"><a href="#3-9-3-查询所有数据-不推荐" class="headerlink" title="3.9.3 查询所有数据(不推荐)"></a>3.9.3 查询所有数据(不推荐)</h5><blockquote>
<p>查询所有数据用到了<code>filter</code>方法，返回了所有的数据对象集合，是一个<code>QuerySet</code>集合</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询所有数据</span></span><br><span class="line">query_data = CourseLevel.objects.<span class="built_in">filter</span>()</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717211917194.png" class="" title="image-20220717211917194">

<h5 id="3-9-4-查询所有数据-推荐"><a href="#3-9-4-查询所有数据-推荐" class="headerlink" title="3.9.4 查询所有数据(推荐)"></a>3.9.4 查询所有数据(推荐)</h5><blockquote>
<p>查询所有数据用到了<code>all</code>方法，返回了所有的数据对象集合，是一个<code>QuerySet</code>集合</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询所有数据</span></span><br><span class="line">query_data = CourseLevel.objects.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717211917194.png" class="" title="image-20220717211917194">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">query_course</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 查询所有数据</span></span><br><span class="line">    query_data = CourseLevel.objects.<span class="built_in">all</span>()</span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> query_data:</span><br><span class="line">        course_level_info = &#123;&#125;</span><br><span class="line">        course_level_info[<span class="string">&quot;id&quot;</span>] = i.<span class="built_in">id</span></span><br><span class="line">        course_level_info[<span class="string">&quot;level_name&quot;</span>] = i.level_name</span><br><span class="line">        course_level_info[<span class="string">&quot;level_desc&quot;</span>] = i.level_desc</span><br><span class="line">        course_level_info[<span class="string">&quot;db_ctime&quot;</span>] = i.db_ctime</span><br><span class="line">        course_level_info[<span class="string">&quot;db_utime&quot;</span>] = i.db_utime</span><br><span class="line">        ret.append(course_level_info)</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(ret, json_dumps_params=&#123;<span class="string">&quot;ensure_ascii&quot;</span>: <span class="literal">False</span>&#125;, safe=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220717212648622.png" class="" title="image-20220717212648622">

<h5 id="3-9-5-查询数据注意事项"><a href="#3-9-5-查询数据注意事项" class="headerlink" title="3.9.5 查询数据注意事项"></a>3.9.5 查询数据注意事项</h5><blockquote>
<ul>
<li>查询使用request.GET.get()查询请求里的字段时，一定要注意字段名是正确的，否则查询结果是None</li>
</ul>
</blockquote>
<h4 id="3-10-必知必会13条"><a href="#3-10-必知必会13条" class="headerlink" title="3.10 必知必会13条"></a>3.10 必知必会13条</h4><blockquote>
</blockquote>
<h4 id="3-11-双下划线查询"><a href="#3-11-双下划线查询" class="headerlink" title="3.11 双下划线查询"></a>3.11 双下划线查询</h4><blockquote>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4></blockquote>
<h4 id="3-12-多表操作"><a href="#3-12-多表操作" class="headerlink" title="3.12 多表操作"></a>3.12 多表操作</h4><blockquote>
<p>多表操作涉及到了mysql的多表知识，详细可见mysql笔记中的多表关系</p>
</blockquote>
<h4 id="3-13-批量操作"><a href="#3-13-批量操作" class="headerlink" title="3.13 批量操作"></a>3.13 批量操作</h4><blockquote>
<p>当有成千上万条数据需要操作时，使用<code>for循环</code>等方式操作数据，效率会很低，Django提供了批量操作的方式来快速实现数据的批量操作</p>
</blockquote>
<h3 id="4、数据序列化"><a href="#4、数据序列化" class="headerlink" title="4、数据序列化"></a>4、数据序列化</h3><blockquote>
<p>Django自带序列化模块，可对输出的结果进行序列化后再返回</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/garyhtml/p/15981110.html">https://www.cnblogs.com/garyhtml/p/15981110.html</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式：serializers.serialize(&#x27;序列化成什么格式&#x27;,数据)</span></span><br><span class="line"><span class="comment"># 示例：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers   <span class="comment"># 导入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ab_ser</span>(<span class="params">request</span>):</span><br><span class="line">    user_queryset = models.User.objects.<span class="built_in">all</span>()</span><br><span class="line">    res = serializers.serialize(<span class="string">&#x27;json&#x27;</span>,user_queryset)  <span class="comment"># 序列化成json格式数据</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;会自动帮你将数据变成json格式的字符串 并且内部非常的全面&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(res)  <span class="comment"># 返回给前端页面</span></span><br></pre></td></tr></table></figure>

<h3 id="5、pymysql出现超时"><a href="#5、pymysql出现超时" class="headerlink" title="5、pymysql出现超时"></a>5、pymysql出现超时</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/moxiao1995071310/article/details/89360406">https://blog.csdn.net/moxiao1995071310/article/details/89360406</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cc8561dac9ee">https://www.jianshu.com/p/cc8561dac9ee</a></p>
</blockquote>
<h2 id="四、forms组件"><a href="#四、forms组件" class="headerlink" title="四、forms组件"></a>四、forms组件</h2><h3 id="1、forms"><a href="#1、forms" class="headerlink" title="1、forms"></a>1、forms</h3><h3 id="2、forms校验参数"><a href="#2、forms校验参数" class="headerlink" title="2、forms校验参数"></a>2、forms校验参数</h3><blockquote>
<p>可以用来校验请求参数，不需要每次单独对参数进行各种判断了</p>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.0/ref/forms/validation/">https://docs.djangoproject.com/zh-hans/4.0/ref/forms/validation/</a></p>
</blockquote>
<h2 id="五、cookie和session"><a href="#五、cookie和session" class="headerlink" title="五、cookie和session"></a>五、cookie和session</h2><h3 id="1、cookie和session"><a href="#1、cookie和session" class="headerlink" title="1、cookie和session"></a>1、cookie和session</h3><h3 id="2、Django操作cookie"><a href="#2、Django操作cookie" class="headerlink" title="2、Django操作cookie"></a>2、Django操作cookie</h3><blockquote>
<p>django可以对请求主动设置cookies</p>
<ul>
<li>django中的三个request方法对象都可以来设置cookie<ul>
<li>HttpResponse()</li>
<li>render()<ul>
<li>该方法本质返回的还是HttpResponse对象</li>
</ul>
</li>
<li>redirect()<ul>
<li>该方法本质返回的还是HttpResponse对象</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>django在请求来的时候获取cookies</p>
<ul>
<li>可以获取请求时候来的cookies，通过cookie中携带的关键key和value来识别是哪个身份</li>
</ul>
</blockquote>
<h4 id="2-1-设置cookie"><a href="#2-1-设置cookie" class="headerlink" title="2.1 设置cookie"></a>2.1 设置cookie</h4><blockquote>
<p>只要是HttpResponse对象，就可以调用set_cookie来设置cookie，最后将对象返回，其实也就是将HttpResponse对象返回，符合视图函数的规范</p>
<p>设置cookie的特点</p>
<ul>
<li>设置cookie以后，浏览器会将cookie的键值对存储起来</li>
<li>后面每次去访问的时候，就会带着cookie的键值对访问</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置cookie</span></span><br><span class="line">obj = HttpResponse()</span><br><span class="line">obj.set_cookie(key, value)</span><br><span class="line"><span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure>

<h5 id="2-1-1-设置cookie示例"><a href="#2-1-1-设置cookie示例" class="headerlink" title="2.1.1 设置cookie示例"></a>2.1.1 设置cookie示例</h5><blockquote>
<p>准备页面和接口</p>
<ul>
<li>前端有登录的html页面 </li>
<li>服务端有路由、登录的视图函数</li>
</ul>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">            密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># url.py代码</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> user <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^index/&#x27;</span>, views.index)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图函数代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户登录</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        uname = request.POST.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(uname, pwd)</span><br><span class="line">        <span class="keyword">if</span> uname == <span class="string">&quot;lx&quot;</span> <span class="keyword">and</span> pwd == <span class="string">&quot;123&quot;</span>:</span><br><span class="line">            <span class="comment"># 保存用户登录状态，登录成功有以后跳转至用户首页，前面有个/user/是因为用到了路由分发</span></span><br><span class="line">            obj = redirect(<span class="string">&quot;/user/index/&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 设置cookie让浏览器记录cookie数据</span></span><br><span class="line">            obj.set_cookie(<span class="string">&quot;login_ck&quot;</span>, <span class="string">&quot;lx_123&quot;</span>)</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f&quot;set_cookie后的obj:<span class="subst">&#123;obj&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;set_cookie后的obj:<span class="subst">&#123;<span class="built_in">type</span>(obj)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;set_cookie后的obj:<span class="subst">&#123;obj.__dict__&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># 将最终的httpResponse对象返回</span></span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时在浏览器上请求<code>/user/login/</code>路由，可以看到login的登录页面，此时打开浏览器的开发者工具，切换到<code>Application</code>选项，查看<code>Cookie</code>下的域名</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220720000943027.png" class="" title="image-20220720000943027">

<blockquote>
<p>然后进行登录，输入<code>lx</code>和<code>123</code>,登录成功跳转到index页面后，发生了下面几件事</p>
<ul>
<li><p>浏览器开发者工具的<code>Application</code>下的<code>Cookie</code>下的<code>http://127.0.0.1:8000</code>域名下有cookie值了了，并且键值对就是视图函数中设置cookie的键值对(“login_ck”, “lx_123”)</p>
</li>
<li><p>登陆成功后&#x2F;login&#x2F;路由又请求了一次，并且在<code>Response Header</code>中可以看到进行了<code>Set-Cookies</code>，表示在设置cookie</p>
</li>
<li><p>浏览器开发者工具的<code>Network</code>下查看登陆成功后跳转到index页面的请求，发现请求头中浏览器自动携带了设置的cookie键值对(“login_ck”, “lx_123”)</p>
<ul>
<li>验证了只要cookie有值，浏览器在请求相同域名下的路由，都会自动带上cookie去请求</li>
</ul>
</li>
</ul>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220720001313847.png" class="" title="image-20220720001313847">

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220720002815184.png" class="" title="image-20220720002815184">



<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220720001654210.png" class="" title="image-20220720001654210">



<blockquote>
<p>那么在设置cookie的时候，服务端的响应obj到底是什么？类型是什么？属性字典中有哪些值？</p>
<p>从代码执行结果来解答：</p>
<ul>
<li>obj是HttpResponseRedirect对象，类型也是HttpResponseRedirect，并且底层仍是HttpResponse对象，所以最后可以返回</li>
<li>在对<code>obj.set_cookie(&quot;login_ck&quot;, &quot;lx_123&quot;)</code>操作以后<ul>
<li>obj的属性字典中就多了下图中的cookies键值对</li>
<li>并且cookies的值是<code>Set-Cookie: login_ck=lx_123; Path=/</code></li>
<li>看来就是这样告知浏览器设置cookie的</li>
</ul>
</li>
</ul>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220720002120916.png" class="" title="image-20220720002120916">

<h4 id="2-2-获取cookie"><a href="#2-2-获取cookie" class="headerlink" title="2.2 获取cookie"></a>2.2 获取cookie</h4><blockquote>
<p>通过request.COOKIES传入cookie的key，获取对应的cookie值</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取cookie</span></span><br><span class="line">cookie_val = request.COOKIES.get(cookie_key)</span><br></pre></td></tr></table></figure>

<h5 id="2-2-1-cookie维持登录状态"><a href="#2-2-1-cookie维持登录状态" class="headerlink" title="2.2.1 cookie维持登录状态"></a>2.2.1 cookie维持登录状态</h5><blockquote>
<p>登录成功以后，就有了cookie，然后浏览器访问其他页面时，只要带上了cookie，那么其他页面就会识别到cookie的键值对，只要符合服务端校验，就可以继续访问其他页面，达到了利用cookie维持登录状态</p>
</blockquote>
<blockquote>
<p>每个页面都需要校验cookie，如果在每个页面的视图函数中都重复写校验cookie的代码，显的很荣誉，那么就想到利用装饰器来验证cookie</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 校验用户是否登录的装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_wrapper</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 获取cookie，如果可以能拿到cookie的值，那么就可以继续支持下面的内容，这样做到了登录状态的维持</span></span><br><span class="line">        <span class="keyword">if</span> request.COOKIES.get(<span class="string">&#x27;login_ck&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> func(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果不能拿到cookie的值，那么就跳转路由到登录视图</span></span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&quot;/user/login/&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为装饰器中需要获取cookie值，所以主动将<code>request</code>参数传入到装饰器中</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录视图</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户登录</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        uname = request.POST.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> uname == <span class="string">&quot;lx&quot;</span> <span class="keyword">and</span> pwd == <span class="string">&quot;123&quot;</span>:</span><br><span class="line">            <span class="comment"># 保存用户登录状态，登录成功有以后跳转至用户首页</span></span><br><span class="line">            obj = redirect(<span class="string">&quot;/user/index/&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 让浏览器记录cookie数据</span></span><br><span class="line">            obj.set_cookie(<span class="string">&quot;login_ck&quot;</span>, <span class="string">&quot;lx_123&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;set_cookie后的obj:<span class="subst">&#123;obj&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;set_cookie后的obj:<span class="subst">&#123;<span class="built_in">type</span>(obj)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> k,v <span class="keyword">in</span> obj.__dict__.items():</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;k&#125;</span>:<span class="subst">&#123;v&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 想httpResponse对象返回</span></span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器是上面定义的</span></span><br><span class="line"><span class="meta">@login_wrapper</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户个人首页</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;用户index页面&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_wrapper</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cart</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户购物车</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;用户cart页面&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>先将cookie清理掉，重新访问登录页面，登陆成功以后跳转至了<code>index</code>页面，再去访问<code>cart</code>页面，发现不需要登录了，直接就能访问</p>
<p>此时还有个不完美的地方</p>
<ul>
<li>浏览器中之前没有访问过登录页面，那么cookie值应该是空的</li>
<li>此时直接访问<code>cart</code>页面，会自动重定向到<code>login</code>页面，登陆成功以后，跳转至了<code>index</code>页面<ul>
<li>正常逻辑是登录前是哪个页面，登录成功后也应该跳转到登录前的那个页面</li>
<li>原因就是在login视图函数中将登陆成功跳转的路由写死成了index页面，所以需要写活了</li>
<li>这里就需要在非index页面跳转到登录页面的时候，将它的路由拼接在login页面url后面，然后登陆成功以后，login视图函数再去获取login页面url上拼接的跳转路由，这样就解决了这个问题</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 装饰器修改逻辑</span></span><br><span class="line"><span class="comment"># 登录cookie校验的装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_wrapper</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 获取cookie，如果可以能拿到cookie的值，那么就可以继续支持下面的内容，这样做到了登录状态的维持</span></span><br><span class="line">        <span class="keyword">if</span> request.COOKIES.get(<span class="string">&#x27;login_ck&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> func(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            target_url = request.get_full_path()</span><br><span class="line">            <span class="comment"># 如果不能拿到cookie的值，那么就跳转路由到登录视图</span></span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">f&quot;/user/login/?redirect_url=<span class="subst">&#123;target_url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下面的login视图函数，登陆成功以后，就可以用<code>request.GET.get</code>获取拼接在login路由后面的<code>redirect_url的target_url</code>，这样只要能获取到需要跳转的路由，就进行跳转，获取不到就默认重定向到index页面</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户登录</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        uname = request.POST.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> uname == <span class="string">&quot;lx&quot;</span> <span class="keyword">and</span> pwd == <span class="string">&quot;123&quot;</span>:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 保存用户登录状态，登录成功后获取login视图函数的参数</span></span><br><span class="line">            <span class="comment"># 获取用户上一次访问的路由</span></span><br><span class="line">            redirect_url = request.GET.get(<span class="string">&quot;redirect_url&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;redirect_url:<span class="subst">&#123;redirect_url&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> redirect_url:</span><br><span class="line">                obj = redirect(redirect_url)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 如果获取不到重定向路由，就跳转至index页面</span></span><br><span class="line">                obj = redirect(<span class="string">&quot;/user/index&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 让浏览器记录cookie数据</span></span><br><span class="line">            obj.set_cookie(<span class="string">&quot;login_ck&quot;</span>, <span class="string">&quot;lx_123&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 想httpResponse对象返回</span></span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_wrapper</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户个人首页</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;用户index页面&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-3-cookie设置有效期"><a href="#2-3-cookie设置有效期" class="headerlink" title="2.3 cookie设置有效期"></a>2.3 cookie设置有效期</h4><blockquote>
<p>有两种方式设置cookie有效期，下面这两种都是以<code>秒</code>为单位</p>
<ul>
<li>max_age</li>
<li>expires<ul>
<li>是针对IE浏览器进行设置有效期</li>
</ul>
</li>
</ul>
<p>Django设置了Cookie有效期，默认是<code>14天</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 让浏览器记录cookie数据</span></span><br><span class="line">obj.set_cookie(<span class="string">&quot;login_ck&quot;</span>, <span class="string">&quot;lx_123&quot;</span>, max_age=<span class="number">500</span>, expires=<span class="number">500</span>)</span><br></pre></td></tr></table></figure>

<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20220720010240998.png" class="" title="image-20220720010240998">



<h4 id="2-4-删除cookie"><a href="#2-4-删除cookie" class="headerlink" title="2.4 删除cookie"></a>2.4 删除cookie</h4><blockquote>
<p>网站的注销功能其实就是删除登录的cookie，并跳转至登录页面，注销的前提是需要登录状态，所以需要添加登录装饰器</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_wrapper</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户登出</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    obj = redirect(<span class="string">&quot;/user/login/&quot;</span>)</span><br><span class="line">    obj.delete_cookie(<span class="string">&quot;login_ck&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;用户logout页面&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3、Django操作session"><a href="#3、Django操作session" class="headerlink" title="3、Django操作session"></a>3、Django操作session</h3><h3 id="4、Django解决前端跨域问题"><a href="#4、Django解决前端跨域问题" class="headerlink" title="4、Django解决前端跨域问题"></a>4、Django解决前端跨域问题</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/open-yang/p/11301323.html">https://www.cnblogs.com/open-yang/p/11301323.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4bfa20fddced">https://www.jianshu.com/p/4bfa20fddced</a></p>
<p>django框架实现前后端分离，首要的问题是解决跨域请求的问题</p>
<p>什么是跨域请求？</p>
<ul>
<li>简单来说就是当前发起的请求的域与该请求指向的资源所在的域不一致。<ul>
<li>什么是CORS呢？（Corss-Origin Resource Sharing 跨资源共享），也就是说当请求与当前的页面的地址不同即为跨域。（包括协议，域名，端口等）。</li>
</ul>
</li>
<li>当协议+域名+端口号均相同，那么就是同一个域. </li>
<li>整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉，因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信</li>
</ul>
</blockquote>
<blockquote>
<p>在django框架中就是利用CORS来解决跨域请求的问题.</p>
</blockquote>
<h4 id="4-1-安装跨域组件"><a href="#4-1-安装跨域组件" class="headerlink" title="4.1 安装跨域组件"></a>4.1 安装跨域组件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-cors-headers </span><br></pre></td></tr></table></figure>

<h4 id="4-2-修改settings-py"><a href="#4-2-修改settings-py" class="headerlink" title="4.2 修改settings.py"></a>4.2 修改settings.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册跨域app</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders&#x27;</span>, <span class="comment"># 注册跨域app，建议写在所有app前面</span></span><br><span class="line">    <span class="string">&#x27;home&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加中间件</span></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>, <span class="comment"># 添加cros中间件，建议放到所有中间件前面</span></span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许所有请求支持跨域</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>上述配置完成后，再去前端使用axios访问接口，就不会出现跨域问题了</p>
</blockquote>
<h2 id="六、Django中间件"><a href="#六、Django中间件" class="headerlink" title="六、Django中间件"></a>六、Django中间件</h2><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/django/django-middleware.html">https://www.runoob.com/django/django-middleware.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/3.2/topics/http/middleware/[](https://docs.djangoproject.com/zh-hans/3.2/topics/http/middleware/)">https://docs.djangoproject.com/zh-hans/3.2/topics/http/middleware/[](https://docs.djangoproject.com/zh-hans/3.2/topics/http/middleware/)</a></p>
</blockquote>
<blockquote>
<p>Django中间件</p>
<ul>
<li>是Django针对请求和响应提供的钩子功能<ul>
<li>可以将请求对象到达视图函数之前进行一些修改后再传递给视图函数，比如在请求对象中添加traceId，再将请求对象传递给后面的视图函数</li>
<li>当视图函数返回响应对象时，中间件可以对返回的响应对象进行修改后再返回</li>
</ul>
</li>
</ul>
<p>中间件的作用：</p>
<ul>
<li>接口调用方请求接口，将接口的请求修改后传递给后面<code>view</code>中的<code>HttpRequest</code>对象</li>
<li>将<code>view</code>返回的<code>HttpResponse</code>对象进行修改后返回给接口调用方</li>
</ul>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20230314132832091.png" class="" title="image-20230314132832091">

<blockquote>
<p>中间件组件配置在settings.py文件的MIDDLEWARE选项列表中，配置中的每个字符串选项都是一个类，也表示是一个中间件</p>
<p>当然自定义的中间件也声明在MIDDLEWARE列表中，那么自定义中间件就会生效</p>
</blockquote>
<h3 id="1、接口限流"><a href="#1、接口限流" class="headerlink" title="1、接口限流"></a>1、接口限流</h3><blockquote>
<p>当我们想要给接口限流，限制用户访问的频率，在django的restframework中框架中可以使用如下对接口进行限流</p>
<ul>
<li>接口限流参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42134789/article/details/112793235">https://blog.csdn.net/weixin_42134789&#x2F;article&#x2F;details&#x2F;112793235</a></li>
</ul>
</blockquote>
<h4 id="1-1-全局限流"><a href="#1-1-全局限流" class="headerlink" title="1.1 全局限流"></a>1.1 全局限流</h4><blockquote>
<p>表示对所有接口都进行限流，</p>
<ul>
<li>一是要设置需要使用的限流类，</li>
<li>二是要设置限流范围(scope)及其限流频率。</li>
<li>AnonRateThrottle和UserRateThrottle默认的scope分别为”anon”和”user”。该配置会对所有API接口生效。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目的settings.py文件</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.AnonRateThrottle&#x27;</span>, <span class="comment"># 匿名用户限流</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.UserRateThrottle&#x27;</span>, <span class="comment"># 用户访问限流</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;2/min&#x27;</span>, <span class="comment"># 表示匿名用户每分钟只允许访问2次</span></span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;10/min&#x27;</span> <span class="comment"># 表示用户每分钟只允许访问10次</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时访问接口，每分钟超过2次，就会看到如下的提示，并且接口响应状态码为500</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20230217223807002.png" class="" title="image-20230217223807002">

<h4 id="1-2-局部限流"><a href="#1-2-局部限流" class="headerlink" title="1.2 局部限流"></a>1.2 局部限流</h4><blockquote>
<p>局部限流也称为单接口限流，针对单个接口进行限流，只要在视图层进行配置，推荐做法：</p>
<ul>
<li>在对应app的文件夹的目录下新建throttles.py</li>
<li>并且添加如下代码</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在对应app下新建的throttles.py内容</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> AnonRateThrottle, UserRateThrottle</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserListAnonRateThrottle</span>(<span class="title class_ inherited__">AnonRateThrottle</span>):</span><br><span class="line">    THROTTLE_RATES = &#123;<span class="string">&quot;anon&quot;</span>: <span class="string">&quot;5/min&quot;</span>&#125; <span class="comment"># 表示匿名用户每分钟只允许访问2次</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserListUserRateThrottle</span>(<span class="title class_ inherited__">UserRateThrottle</span>):</span><br><span class="line">    THROTTLE_RATES = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;30/min&quot;</span>&#125; <span class="comment"># # 表示用户每分钟只允许访问30次</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在需要被限流的view下添加如下代码，前提是需要先在view中导入上面自定义的限流类</span></span><br><span class="line"><span class="keyword">from</span> .throttles <span class="keyword">import</span> UserListAnonRateThrottle，UserListUserRateThrottle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfoView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">  	<span class="comment"># 使用throttle_classes这个列表来装载限流类</span></span><br><span class="line">    throttle_classes = [UserListAnonRateThrottle，UserListUserRateThrottle] </span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时再访问UserInfoView这个视图关联的接口，就会被自定义的限流策略限流住</p>
</blockquote>
<h4 id="1-3-IP限流"><a href="#1-3-IP限流" class="headerlink" title="1.3 IP限流"></a>1.3 IP限流</h4><blockquote>
<p>Django的restframework的限流可能有时候不能满足我们的需求，我们就可以自行编写限流类</p>
<p>自己编写限流类：</p>
<ul>
<li>只要自己写的类实现了allow_request()和wait()方法就能被用作限流类<ul>
<li>allow_request()：定义允许访问和不允许访问的策略，结果返回bool值</li>
<li>wait()：定义被限流后剩余多久才可以访问</li>
</ul>
</li>
<li>自带的AnonRateThrottle和UserRateThrottle限流类都是继承的SimpleRateThrottle，这里的原理可以去看的SimpleRateThrottle类，里面都有allow_request()和wait()</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同样的在对应app下新建的throttles.py新增IPThrottles限流类</span></span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IPThrottleRate</span>:</span><br><span class="line">    <span class="comment"># 定义访问频率的时间(毫秒单位)和次数</span></span><br><span class="line">    rate_time = <span class="number">60</span>  <span class="comment"># 表示1min</span></span><br><span class="line">    request_num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IPThrottle</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;IP限流&quot;&quot;&quot;</span></span><br><span class="line">    redis_client = RedisClusterClient().redis_client</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.now_time_stamp = <span class="built_in">int</span>(time.time())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ip_redis_key</span>(<span class="params">self, remote_ip</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;HOST:<span class="subst">&#123;remote_ip&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_remote_ip_data_by_redis</span>(<span class="params">self, remote_ip</span>):</span><br><span class="line">        history_time_list = self.redis_client.get(self.ip_redis_key(remote_ip))</span><br><span class="line">        <span class="keyword">if</span> history_time_list <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="keyword">return</span> json.loads(history_time_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_remote_ip_data_to_redis</span>(<span class="params">self, remote_ip, history_time_list</span>):</span><br><span class="line">        self.redis_client.<span class="built_in">set</span>(self.ip_redis_key(remote_ip), <span class="built_in">str</span>(history_time_list))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">allow_request</span>(<span class="params">self, request, view</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        步骤：</span></span><br><span class="line"><span class="string">        1、取出访问者的IP</span></span><br><span class="line"><span class="string">        2、判断当前IP是不是在访问字典里，添加进去，并且直接放回True，表示第一次访问，继续往下走</span></span><br><span class="line"><span class="string">        3、循环判断当前IP的列表，有值，并且当前时间减去列表最后一个时间大于60s，把这种数据pop掉，这样列表中有60s以内的时间</span></span><br><span class="line"><span class="string">        4、判断当列表小于3，说明一分钟之内访问不足三次，把当前时间插入到列表第一个位置，返回True，继续往下走</span></span><br><span class="line"><span class="string">        5、当大于等于3，说明一分钟内访问超过3次，返回False验证失败</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        remote_ip = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取用户真实访问IP</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;HTTP_X_REAL_IP&quot;</span> <span class="keyword">in</span> request.META:</span><br><span class="line">            <span class="comment"># 例如：&#x27;HTTP_X_REAL_IP&#x27;: &#x27;10.1.107.47&#x27;</span></span><br><span class="line">            HTTP_X_REAL_IP = request.META.get(<span class="string">&quot;HTTP_X_REAL_IP&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(HTTP_X_REAL_IP) &gt; <span class="number">0</span>:</span><br><span class="line">                remote_ip = HTTP_X_REAL_IP</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pumpkin_app_access.error(<span class="string">f&quot;未获取到HTTP_X_REAL_IP：<span class="subst">&#123;HTTP_X_REAL_IP&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;HTTP_X_FORWARDED_FOR&quot;</span> <span class="keyword">in</span> request.META:</span><br><span class="line">            <span class="comment"># &#x27;HTTP_X_FORWARDED_FOR&#x27;: &#x27;10.1.107.47, 10.13.134.45&#x27;</span></span><br><span class="line">            HTTP_X_FORWARDED_FOR = request.META.get(<span class="string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>)</span><br><span class="line">            HTTP_X_FORWARDED_FOR_LIST = [i.strip() <span class="keyword">for</span> i <span class="keyword">in</span> HTTP_X_FORWARDED_FOR.split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(HTTP_X_FORWARDED_FOR_LIST) &gt; <span class="number">1</span>:</span><br><span class="line">                remote_ip = HTTP_X_FORWARDED_FOR_LIST[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pumpkin_app_access.error(<span class="string">f&quot;HTTP_X_FORWARDED_FOR_LIST的数据为：<span class="subst">&#123;HTTP_X_FORWARDED_FOR_LIST&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;HTTP_X_ORIGINAL_FORWARDED_FOR&quot;</span> <span class="keyword">in</span> request.META:</span><br><span class="line">            <span class="comment"># 例如：&#x27;HTTP_X_ORIGINAL_FORWARDED_FOR&#x27;: &#x27;10.1.107.47&#x27;</span></span><br><span class="line">            HTTP_X_ORIGINAL_FORWARDED_FOR = request.META.get(<span class="string">&quot;HTTP_X_ORIGINAL_FORWARDED_FOR&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(HTTP_X_ORIGINAL_FORWARDED_FOR) &gt; <span class="number">0</span>:</span><br><span class="line">                remote_ip = HTTP_X_ORIGINAL_FORWARDED_FOR</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pumpkin_app_access.error(<span class="string">f&quot;未获取到HTTP_X_ORIGINAL_FORWARDED_FOR：<span class="subst">&#123;HTTP_X_ORIGINAL_FORWARDED_FOR&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            remote_ip = request.META.get(<span class="string">&quot;REMOTE_ADDR&quot;</span>)</span><br><span class="line"></span><br><span class="line">        pumpkin_app_access.info(<span class="string">f&quot;获取到的remote_ip:<span class="subst">&#123;remote_ip&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 从redis获取访问IP的值</span></span><br><span class="line">        self.history_time_list = self.get_remote_ip_data_by_redis(remote_ip)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.history_time_list) == <span class="number">0</span>:</span><br><span class="line">            <span class="string">&quot;&quot;&quot;表示第一次访问&quot;&quot;&quot;</span></span><br><span class="line">            <span class="comment"># 设置到redis中</span></span><br><span class="line">            self.set_remote_ip_data_to_redis(remote_ip, <span class="built_in">str</span>([self.now_time_stamp]))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(self.history_time_list) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> self.now_time_stamp - self.history_time_list[-<span class="number">1</span>] &gt;= IPThrottleRate.rate_time:</span><br><span class="line">                self.history_time_list.pop()</span><br><span class="line">                self.set_remote_ip_data_to_redis(remote_ip, self.history_time_list)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 下面只剩余一分钟之内的时间</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.history_time_list) &lt; IPThrottleRate.request_num:</span><br><span class="line">            self.history_time_list.insert(<span class="number">0</span>, self.now_time_stamp)</span><br><span class="line">            self.set_remote_ip_data_to_redis(remote_ip, self.history_time_list)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wait</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> IPThrottleRate.rate_time - (self.now_time_stamp - self.history_time_list[-<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在需要被限流的view下添加如下代码，前提是需要先在view中导入上面自定义的限流类</span></span><br><span class="line"><span class="keyword">from</span> .throttles <span class="keyword">import</span> IPThrottle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfoView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">  	<span class="comment"># 使用throttle_classes这个列表来装载限流类</span></span><br><span class="line">    throttle_classes = [IPThrottle] </span><br></pre></td></tr></table></figure>

<blockquote>
<p>该限流中使用了redis对用户的访问进行了存储，保证了负载均衡获取到的用户访问IP都从同一个缓存获取，永远都是唯一，此时再次访问单接口就可以根据用户访问的IP进行限流了</p>
<p>需要注意：</p>
<ul>
<li>如果部署使用Nginx代理，那么获取用户IP，就尽量不要用<code>Remote_ADDR</code>，容易获取的是nginx代理后的IP,而不是真正用户访问到的IP</li>
<li>如下解释：<ul>
<li>一般情况下request.META[‘REMOTE_ADDR’]足以获取用户真实IP地址。对于部署在负载平衡proxy(如nginx)上Django应用而言，这种方法将不适用。因为每个request中的远程IP地址(request.META[“REMOTE_IP”])将指向该负载平衡proxy的地址，而不是发起这个request的用户的实际IP。负载平衡proxy处理这个问题的方法在特殊的 X-Forwarded-For 中设置实际发起请求的IP</li>
</ul>
</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/inthat/article/details/119578239?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167664102116782428636802%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=167664102116782428636802&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-119578239-null-null.142%5Ev73%5Einsert_down2,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&utm_term=django%20%E8%8E%B7%E5%8F%96ip&spm=1018.2226.3001.4187">Django获取用户访问真实IP</a></p>
</blockquote>
<h3 id="2、trace跟踪"><a href="#2、trace跟踪" class="headerlink" title="2、trace跟踪"></a>2、trace跟踪</h3><blockquote>
<p>trace跟踪是指在请求接口时，针对每一次请求生成一个唯一的ID，那么当某一次请求出现问题时，就会根据出现问题请求返回响应中的ID进行问题跟踪，尤其是当接口逻辑中打日志时也有传递进来的ID，通过ID就是知道问题出在什么位置</p>
</blockquote>
<h4 id="2-1-生成traceId"><a href="#2-1-生成traceId" class="headerlink" title="2.1 生成traceId"></a>2.1 生成traceId</h4><blockquote>
<p>生成traceId的方式：</p>
<ul>
<li><p>目前单机使用可以采用<code>UUID</code>的方式生成</p>
<ul>
<li><p>UUID： 通用唯一标识符 ( Universally Unique Identifier )，对于所有的UUID它可以保证在空间和时间上的唯一性，也称为GUID，全称为：</p>
<p>  UUID —— Universally Unique IDentifier Python中称为 UUID<br>  GUID —— Globally Unique IDentifier C#中称为 GUID</p>
<p>  它是通过MAC地址、 时间戳、 命名空间、 随机数、 伪随机数来保证生成ID的唯一性,有着固定的大小( 128 bit位 )，通常由 32 字节的字符串（十六进制）表示。</p>
<p>  它的唯一性和一致性特点，使得可以无需注册过程就能够产生一个新的UUID；UUID可以被用作多种用途, 既可以用来短时间内标记一个对象，也可以可靠的辨别网络中的持久性对象。</p>
</li>
<li><p>python标准库<code>uuid</code>可以来生成uuid，来作为traceId</p>
</li>
</ul>
</li>
<li><p>分布式traceId可以参考opentracing，这里先不做介绍</p>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下述代码会生成六位唯一的字符串，可以用来作为traceId</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GenRequestUUID</span>:</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gen_uuid_str</span>(<span class="params">cls</span>):</span><br><span class="line">        clock_seq = <span class="built_in">int</span>(time.time()) * random.randint(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">        uuid_str = uuid.uuid1(clock_seq=clock_seq)</span><br><span class="line">        uuid_str_list = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>(uuid_str).split(<span class="string">&quot;-&quot;</span>)]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([uuid_str_list[<span class="number">0</span>], uuid_str_list[<span class="number">3</span>]])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/uuid.html">https://docs.python.org/3/library/uuid.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/248285.htm">https://www.jb51.net/article/248285.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44621343/article/details/115958618">https://blog.csdn.net/weixin_44621343&#x2F;article&#x2F;details&#x2F;115958618</a></p>
</blockquote>
<h4 id="2-2-自定义trace中间件"><a href="#2-2-自定义trace中间件" class="headerlink" title="2.2 自定义trace中间件"></a>2.2 自定义trace中间件</h4><blockquote>
<p>自定义中间件的步骤：</p>
<ol>
<li>编写自定义中间件，对请求对象和响应对象按需进行修改，编写自定义中间件的代码示例参考：<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/3.2/topics/http/middleware/">https://docs.djangoproject.com/zh-hans/3.2/topics/http/middleware/</a></li>
<li>配置中间件，将自定义中间件添加到Django的settings.py文件中的<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-MIDDLEWARE"><code>MIDDLEWARE</code></a>列表中<ul>
<li>在<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-MIDDLEWARE"><code>MIDDLEWARE</code></a> 中，每个中间件组件由字符串表示：指向中间件工厂的类或函数名的完整 Python 路径</li>
</ul>
</li>
</ol>
</blockquote>
<h5 id="2-2-1-编写自定义中间件"><a href="#2-2-1-编写自定义中间件" class="headerlink" title="2.2.1 编写自定义中间件"></a>2.2.1 编写自定义中间件</h5><blockquote>
<p>下面代码位置可存放在：</p>
<ul>
<li><p>utils&#x2F;middleware&#x2F;tracing.py</p>
</li>
<li><p><code>utils</code>目录是在django项目根目录下</p>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GenRequestUUID</span>:</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gen_uuid_str</span>(<span class="params">cls</span>):</span><br><span class="line">        clock_seq = <span class="built_in">int</span>(time.time()) * random.randint(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">        uuid_str = uuid.uuid1(clock_seq=clock_seq)</span><br><span class="line">        uuid_str_list = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>(uuid_str).split(<span class="string">&quot;-&quot;</span>)]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([uuid_str_list[<span class="number">0</span>], uuid_str_list[<span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TraceMiddleware</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, get_response</span>):</span><br><span class="line">        self.get_response = get_response</span><br><span class="line">        self.trace_id_tag = <span class="string">&quot;Request-X-ID&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, request</span>):</span><br><span class="line">        r = request</span><br><span class="line">        trace_id = request.META.get(self.trace_id_tag, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> trace_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            trace_id = GenRequestUUID.gen_uuid_str()</span><br><span class="line"></span><br><span class="line">        request.META[self.trace_id_tag] = trace_id</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.get_response(request)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里自定义中间件有个需要注意的点</p>
<ul>
<li><p>在自定义中间件中如果设置了一个值想透传给后面的视图函数去使用，建议使用请求对象request的<code>META</code>属性，因为<code>META</code>属性是个字典类型，可以进行key&#x2F;value的增删，然后再将修改后的request请求对象传给后面的视图函数</p>
</li>
<li><p>对接口进行debug可以看出来request请求对象的属性以及属性类型，其中<code>META</code>属性就是字典类型</p>
</li>
</ul>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20230314140246390.png" class="" title="image-20230314140246390">

<h5 id="2-2-2-配置自定义中间件"><a href="#2-2-2-配置自定义中间件" class="headerlink" title="2.2.2 配置自定义中间件"></a>2.2.2 配置自定义中间件</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># 注册trace自定义中间件</span></span><br><span class="line">    <span class="string">&#x27;utils.middleware.tracing.TraceMiddleware&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="2-3-视图函数中处理traceId"><a href="#2-3-视图函数中处理traceId" class="headerlink" title="2.3 视图函数中处理traceId"></a>2.3 视图函数中处理traceId</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infos</span>(<span class="params">request</span>):</span><br><span class="line">    trace_id = request.META.get(<span class="string">&quot;Request-X-ID&quot;</span>)</span><br><span class="line">    ret = &#123;</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">        <span class="string">&quot;traceId&quot;</span>: trace_id</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(ret, safe=<span class="literal">False</span>, json_dumps_params=&#123;<span class="string">&quot;ensure_ascii&quot;</span>: <span class="literal">False</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="2-4-查看响应返回traceId"><a href="#2-4-查看响应返回traceId" class="headerlink" title="2.4 查看响应返回traceId"></a>2.4 查看响应返回traceId</h4><img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20230314135758733.png" class="" title="image-20230314135758733">



<h4 id="2-5-自定义中间件修改响应对象"><a href="#2-5-自定义中间件修改响应对象" class="headerlink" title="2.5 自定义中间件修改响应对象"></a>2.5 自定义中间件修改响应对象</h4><blockquote>
<p>在中间件中对响应对象修改后再返回</p>
<p>注意response对象类型是JsonResponse类型，其中<code>content</code>属性是字节类型的字典，可以用来key&#x2F;value的增删</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20230314142035573.png" class="" title="image-20230314142035573">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TraceMiddleware</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, get_response</span>):</span><br><span class="line">        self.get_response = get_response</span><br><span class="line">        self.trace_id_tag = <span class="string">&quot;Request-X-ID&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, request</span>):</span><br><span class="line">        r = request</span><br><span class="line">        trace_id = request.META.get(self.trace_id_tag, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> trace_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            trace_id = GenRequestUUID.gen_uuid_str()</span><br><span class="line"></span><br><span class="line">        request.META[self.trace_id_tag] = trace_id</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理请求</span></span><br><span class="line">        response = self.get_response(request)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># response的content属性是字节类型json，所以decode为字符串</span></span><br><span class="line">        content_str = response.content.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将字符串的content转为字典，并且增加一个`new_ret`的key，value是`this is resp`</span></span><br><span class="line">        content_dict = json.loads(content_str)</span><br><span class="line">        content_dict[<span class="string">&quot;new_ret&quot;</span>] = <span class="string">&quot;this is resp&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 重新对response对象的content对象赋值，content值为修改后的content，因为增加了一个新的key/value</span></span><br><span class="line">        <span class="comment"># 这里注意使用json序列化为字符串，不要直接使用str将字典转为字符串，否则接口响应返回的就不是一个json类型，而是字符串类型</span></span><br><span class="line">        <span class="comment"># 将字典转为字符串以后，再encode为字节类型，因为网络传输时使用的就是字节类型</span></span><br><span class="line">        response.content = json.dumps(content_dict).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<blockquote>
<p>浏览器查看响应接口，发现响应中已经将修改后响应返回了</p>
</blockquote>
<img src="/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/image-20230314142242901.png" class="" title="image-20230314142242901">

<h2 id="七、Django使用Gunicorn部署"><a href="#七、Django使用Gunicorn部署" class="headerlink" title="七、Django使用Gunicorn部署"></a>七、Django使用Gunicorn部署</h2><blockquote>
<p>gunicron官网：<a target="_blank" rel="noopener" href="https://docs.gunicorn.org/en/stable/">https://docs.gunicorn.org/en/stable/</a></p>
</blockquote>
<h3 id="1、Gunicorn介绍"><a href="#1、Gunicorn介绍" class="headerlink" title="1、Gunicorn介绍"></a>1、Gunicorn介绍</h3><blockquote>
<h2 id="Gunicorn-和-WSGI-简介"><a href="#Gunicorn-和-WSGI-简介" class="headerlink" title="Gunicorn 和 WSGI 简介"></a>Gunicorn 和 WSGI 简介</h2><p> 先说说 WSGI。啥是 WSGI？<strong>Web服务器网关接口</strong>（<strong>Python Web Server Gateway Interface</strong>，<strong>缩写为WSGI</strong>）是为 Python 语言定义的 Web 服务器和 Web 应用程序或框架之间的一种简单而通用的接口。</p>
<p> 咱们平时写的 Flask 的业务代码，是 Web application，是无法处理客户端发的那些 HTTP 请求的，需要一个实现了 WSGI 的 Server 帮忙处理 HTTP 请求，让 HTTP 请求变成业务代码可以处理的形式之后再给 application 的业务代码，然后业务代码进行一系列处理，把处理结果给 Server，Server 再把这个结果封装后给客户端。用这样的方式，就可以专心的写业务代码，不用考虑怎么解析 HTTP 请求，怎么封装 HTTP 回复，这些都是 Server 的工作。</p>
<p> Gunicorn 就是这样一个实现了 WSGI 的 HTTP Server，它在 Flask 和 客户端之间充当一个翻译的角色，并且相比于 Flask 自带的 Server，有很好的并发性能。</p>
</blockquote>
<h4 id="1-1-安装Gunicorn"><a href="#1-1-安装Gunicorn" class="headerlink" title="1.1 安装Gunicorn"></a>1.1 安装Gunicorn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gunicorn</span><br></pre></td></tr></table></figure>

<h4 id="1-2-Django使用Gunicorn"><a href="#1-2-Django使用Gunicorn" class="headerlink" title="1.2 Django使用Gunicorn"></a>1.2 Django使用Gunicorn</h4><blockquote>
<p>如果没有指定，Gunicorn会寻找一个名为 “application “的WSGI可调用程序。因此，对于一个典型的Django项目来说，调用Gunicorn会是这样的。</p>
<p>注意</p>
<ul>
<li>这需要你的项目在Python路径上；最简单的方法是在你的<code>manage.py</code>文件的同一目录下运行这个命令。</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn myproject.wsgi</span><br></pre></td></tr></table></figure>

<blockquote>
<p>你可以使用 <a target="_blank" rel="noopener" href="http://docs.gunicorn.org/en/latest/settings.html#raw-env">-env</a> 选项来设置加载设置的路径。如果你需要，你也可以使用 <a target="_blank" rel="noopener" href="http://docs.gunicorn.org/en/latest/settings.html#pythonpath">-pythonpath</a> 选项将你的应用程序路径添加到<code>PYTHONPATH</code>中</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903950676656141">https://juejin.cn/post/6844903950676656141</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903983388213256">https://juejin.cn/post/6844903983388213256</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.venv/bin/gunicorn -b :8090 -w 5  --<span class="built_in">env</span> DJANGO_SETTINGS_MODULE=tester_tools.settings.production tester_tools.wsgi</span><br></pre></td></tr></table></figure>

<h4 id="1-3-Django自带server启动"><a href="#1-3-Django自带server启动" class="headerlink" title="1.3 Django自带server启动"></a>1.3 Django自带server启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.venv/bin/python3 manage.py runserver 0.0.0.0:8090 --settings tester_tools.settings.production</span><br></pre></td></tr></table></figure>

<h4 id="1-4-requirement管理项目依赖"><a href="#1-4-requirement管理项目依赖" class="headerlink" title="1.4 requirement管理项目依赖"></a>1.4 requirement管理项目依赖</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/whatday/article/details/100523107">https://blog.csdn.net/whatday/article/details/100523107</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/guo_qiangqiang/article/details/107582987">https://blog.csdn.net/guo_qiangqiang/article/details/107582987</a></p>
</blockquote>
<h3 id="2、uwsgi部署"><a href="#2、uwsgi部署" class="headerlink" title="2、uwsgi部署"></a>2、uwsgi部署</h3><h4 id="2-x-问题解决"><a href="#2-x-问题解决" class="headerlink" title="2.x 问题解决"></a>2.x 问题解决</h4><p>2.x.1 出现接口504</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/tmpbook/article/details/43734699?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-43734699-blog-91354299.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-43734699-blog-91354299.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=1">https://blog.csdn.net/tmpbook/article/details/43734699?spm=1001.2101.3001.6661.1&utm_medium&#x3D;distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-43734699-blog-91354299.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&amp;depth_1-utm_source&#x3D;distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-43734699-blog-91354299.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&amp;utm_relevant_index&#x3D;1</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/crookie/article/details/112667387?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-112667387-blog-107494928.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-112667387-blog-107494928.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=5">https://blog.csdn.net/crookie/article/details/112667387?spm=1001.2101.3001.6650.2&utm_medium&#x3D;distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-112667387-blog-107494928.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&amp;depth_1-utm_source&#x3D;distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-112667387-blog-107494928.235%5Ev27%5Epc_relevant_3mothn_strategy_and_data_recovery&amp;utm_relevant_index&#x3D;5</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">504</span> Gateway Time out</span><br><span class="line">原因是因为相关参数设置的不当，还是很容易解决的</span><br><span class="line"></span><br><span class="line">nginx和uwsgi整合时有三个参数可以用于设置超时时间：</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>uwsgi_connect_timeout<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">默认<span class="number">60</span>秒，与uwsgi-server连接的超时时间，该值不能超过<span class="number">75</span>秒.若在超时时间内未能成功连接则断开连接尝试</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>uwsgi_read_timeout<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">默认<span class="number">60</span>秒，nginx等待uwsgi进程发送响应数据的超时时间。若有需要长时间运行才能产生输出结果的uwsgi进程则需将此参数调高。若在错误日志文件中看到</span><br><span class="line">upstream timed out需将此参数调高。若超过超时时间还未收到响应则nginx关闭连接</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>uwsgi_send_timeout<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">默认<span class="number">60</span>秒，nginx向uwsgi进程发送请求的超时时间。超时时间由两次写操作的时间间隔算，而非整个请求。若超过超时时间仍没写入动作则nginx关闭连接</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解决：</span><br><span class="line">在nginx配置的server - location中添加 uwsgi_send_timeout 和 uwsgi_read_timeout</span><br><span class="line">在uwsgi启动命令行添加 --http-timeout</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.lynote.top">刘阳</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.lynote.top/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/">https://www.lynote.top/2022/05/16/python/django%E7%AC%94%E8%AE%B0/django%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.lynote.top" target="_blank">笔记小窝</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="social-share" data-image="/posts_cover_img/python/django.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/16/python/python%E7%AC%94%E8%AE%B0/python%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="/posts_cover_img/python/python_logo.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python基础编程</div></div></a></div><div class="next-post pull-right"><a href="/2021/05/16/database/rabbitmq%E7%AC%94%E8%AE%B0/rabbitmq%E7%AC%94%E8%AE%B0/"><img class="next-cover" src="/posts_cover_img/database/rabbitmq_logo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RabbitMQ笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/06/28/python/python%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/python%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" title="Python异步编程"><img class="cover" src="/posts_cover_img/python/python_logo.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-28</div><div class="title">Python异步编程</div></div></a></div><div><a href="/2022/05/16/python/python%E7%AC%94%E8%AE%B0/python%E7%AC%94%E8%AE%B0/" title="Python基础编程"><img class="cover" src="/posts_cover_img/python/python_logo.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-16</div><div class="title">Python基础编程</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">刘阳</div><div class="author-info__description">学习与记录</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lyzin"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Web%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">一、Web框架介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Socket%E5%AE%9E%E7%8E%B0http%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">1、Socket实现http服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81http%E8%AF%B7%E6%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-text">2、http请求协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-GET%E8%AF%B7%E6%B1%82"><span class="toc-text">1.1 GET请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-POST%E8%AF%B7%E6%B1%82"><span class="toc-text">1.2 POST请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81http%E5%93%8D%E5%BA%94%E5%8D%8F%E8%AE%AE"><span class="toc-text">3、http响应协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-GET%E5%93%8D%E5%BA%94"><span class="toc-text">1.1 GET响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-POST%E5%93%8D%E5%BA%94"><span class="toc-text">1.2 POST响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E7%9A%84%E5%93%8D%E5%BA%94%E9%A6%96%E8%A1%8C%E5%AD%97%E6%AE%B5"><span class="toc-text">1.3 响应报文的响应首行字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-text">1.4 响应状态码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81wsgiref%E6%A8%A1%E5%9D%97"><span class="toc-text">4、wsgiref模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89wsgiref%E6%A8%A1%E5%9D%97%EF%BC%9F"><span class="toc-text">1.1 为什么要有wsgiref模块？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-text">1.1.1 请求参数解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E8%BF%94%E5%9B%9E"><span class="toc-text">1.1.2 响应数据返回</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E6%80%BB%E7%BB%93"><span class="toc-text">1.1.3 总结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-wsgiref%E6%A8%A1%E5%9D%97%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BA%8B%E6%83%85%EF%BC%9F"><span class="toc-text">1.2 wsgiref模块做了哪些事情？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-wsgiref%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.1.1 wsgiref实现服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-environ%E5%8F%82%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">1.1.2 environ参数是什么？</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%9F%BA%E4%BA%8Ewsgiref%E8%87%AA%E5%AE%9A%E4%B9%89web%E6%A1%86%E6%9E%B6"><span class="toc-text">1.3 基于wsgiref自定义web框架</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%AE%9E%E7%8E%B0%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91"><span class="toc-text">1.1.1 实现路由分发</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E4%BC%98%E5%8C%96"><span class="toc-text">1.1.2 路由分发优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-text">1.1.3 路由分发的优点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-environ%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-text">1.1.4 environ参数处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-5-%E6%8B%86%E5%88%86%E5%AE%9E%E7%8E%B0web%E6%A1%86%E6%9E%B6"><span class="toc-text">1.1.5 拆分实现web框架</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-django%E4%B8%AD%E7%9A%84wsgiref"><span class="toc-text">1.4 django中的wsgiref</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Django%E4%B8%8A%E6%89%8B"><span class="toc-text">二、Django上手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Django%E5%AE%89%E8%A3%85"><span class="toc-text">1、Django安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">2、创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><span class="toc-text">3、创建应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%BA%94%E7%94%A8%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">1.1 应用的目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%B3%A8%E5%86%8C%E5%BA%94%E7%94%A8"><span class="toc-text">1.2 注册应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">4、项目目录结构介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%90%AF%E5%8A%A8Django%E9%A1%B9%E7%9B%AE"><span class="toc-text">5、启动Django项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81templates%E7%9B%AE%E5%BD%95"><span class="toc-text">6、templates目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81Django%E4%B8%89%E7%BB%84%E4%BB%B6"><span class="toc-text">7、Django三组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-HttpResponse"><span class="toc-text">1.1 HttpResponse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-render"><span class="toc-text">1.2 render</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E5%88%9B%E5%BB%BAhtml%E6%96%87%E4%BB%B6"><span class="toc-text">1.1.1 创建html文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E7%BC%96%E5%86%99%E8%B7%AF%E7%94%B1"><span class="toc-text">1.1.2 编写路由</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E7%BC%96%E5%86%99%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-text">1.1.3 编写视图函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-%E8%AF%B7%E6%B1%82%E9%A1%B5%E9%9D%A2"><span class="toc-text">1.1.4 请求页面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-redirect"><span class="toc-text">1.3 redirect</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">8、静态文件配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="toc-text">1.1 静态文件绝对路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%90%AF%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%85%A5%E5%8F%A3"><span class="toc-text">1.2 服务端开启静态资源入口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%81%B5%E6%B4%BB%E5%8F%96%E4%BB%A4%E7%89%8C%E5%80%BC"><span class="toc-text">1.3 灵活取令牌值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81request%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-text">9、request对象方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%85%B3%E9%97%ADcsrf%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">1.1 关闭csrf中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-request%E5%AF%B9%E8%B1%A1"><span class="toc-text">1.2 request对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-request-method"><span class="toc-text">1.1.1 request.method</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-request-POST"><span class="toc-text">1.1.2 request.POST</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-request-GET"><span class="toc-text">1.1.3 request.GET</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-4-POST%E8%AF%B7%E6%B1%82%E7%9F%A5%E8%AF%86%E6%89%A9%E5%B1%95"><span class="toc-text">1.1.4 POST请求知识扩展</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-5-%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E7%9F%A5%E8%AF%86%E6%89%A9%E5%B1%95"><span class="toc-text">1.1.5 编码方式知识扩展</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-request-path%E7%9B%B8%E5%85%B3"><span class="toc-text">1.3 request.path相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-path%E5%B1%9E%E6%80%A7-%E6%8E%A8%E8%8D%90"><span class="toc-text">1.1.1 path属性(推荐)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-path-info%E5%B1%9E%E6%80%A7-%E4%B8%8D%E6%8E%A8%E8%8D%90"><span class="toc-text">1.1.1 path_info属性(不推荐)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-get-full-path%E6%96%B9%E6%B3%95"><span class="toc-text">1.1.1 get_full_path方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-request-body%E7%9B%B8%E5%85%B3"><span class="toc-text">1.4 request.body相关</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81Pycharm%E6%93%8D%E4%BD%9CDjango%E6%8A%80%E5%B7%A7"><span class="toc-text">10、Pycharm操作Django技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BADjango%E5%BA%94%E7%94%A8"><span class="toc-text">1.1 快速创建Django应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BF%AE%E6%94%B9Django%E7%AB%AF%E5%8F%A3"><span class="toc-text">1.2 修改Django端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E9%A1%B5%E9%9D%A2%E4%B8%8D%E8%B5%B0%E7%BC%93%E5%AD%98"><span class="toc-text">1.3 浏览器访问页面不走缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text">11、路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D"><span class="toc-text">1.1 路由匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%97%A0%E5%90%8D%E5%88%86%E7%BB%84"><span class="toc-text">1.2 无名分组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E6%97%A0%E5%90%8D%E5%88%86%E7%BB%84%E4%BD%BF%E7%94%A8"><span class="toc-text">1.1.1 无名分组使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E6%97%A0%E5%90%8D%E5%88%86%E7%BB%84%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-text">1.1.2 无名分组反向解析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%9C%89%E5%90%8D%E5%88%86%E7%BB%84"><span class="toc-text">1.3 有名分组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E6%9C%89%E5%90%8D%E5%88%86%E7%BB%84%E4%BD%BF%E7%94%A8"><span class="toc-text">1.1.1 有名分组使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E6%9C%89%E5%90%8D%E5%88%86%E7%BB%84%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-text">1.1.2 有名分组反向解析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%9C%89%E5%90%8D%E5%88%86%E7%BB%84%E5%92%8C%E6%97%A0%E5%90%8D%E5%88%86%E7%BB%84%E6%B3%A8%E6%84%8F"><span class="toc-text">1.4 有名分组和无名分组注意</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91"><span class="toc-text">1.5 路由分发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E7%AC%AC%E4%B8%80%E6%AD%A5"><span class="toc-text">1.1.1 路由分发第一步</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E7%AC%AC%E4%BA%8C%E6%AD%A5"><span class="toc-text">1.1.2 路由分发第二步</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-%E8%AE%BF%E9%97%AE%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">1.1.3 访问路由分发的应用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-text">1.6 名称空间（了解）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-%E4%BC%AA%E9%9D%99%E6%80%81%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-text">1.7 伪静态（了解）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81JsonResponse%E5%AF%B9%E8%B1%A1"><span class="toc-text">12、JsonResponse对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%93%8D%E4%BD%9C"><span class="toc-text">13、文件上传操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14%E3%80%81FBV%E5%92%8CCBV"><span class="toc-text">14、FBV和CBV</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-FBV"><span class="toc-text">1.1 FBV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-CBV"><span class="toc-text">1.2 CBV</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81ORM%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">三、ORM数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Pycharm%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">1、Pycharm连接数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-mac%E4%B8%8B%E8%BF%9E%E6%8E%A5docker%E7%9A%84mysql"><span class="toc-text">1.1 mac下连接docker的mysql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-windows%E4%B8%8B%E8%BF%9E%E6%8E%A5docker%E7%9A%84mysql"><span class="toc-text">1.2 windows下连接docker的mysql</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Django%E8%BF%9E%E6%8E%A5Mysql"><span class="toc-text">2、Django连接Mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E9%85%8D%E7%BD%AEmysql%E8%BF%9E%E6%8E%A5"><span class="toc-text">2.1 配置mysql连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AEmysql%E5%90%AF%E5%8A%A8Django%E9%94%99%E8%AF%AF%E4%BF%AE%E5%A4%8D"><span class="toc-text">2.2 配置mysql启动Django错误修复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E8%AE%BE%E7%BD%AEDjango%E7%9A%84%E6%97%B6%E5%8C%BA"><span class="toc-text">2.3 设置Django的时区</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81ORM%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3、ORM的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-ORM%E7%AE%80%E4%BB%8B"><span class="toc-text">3.1 ORM简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-ORM%E7%BC%96%E5%86%99%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="toc-text">3.2 ORM编写建表语句</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-AutoField%E5%AD%97%E6%AE%B5"><span class="toc-text">3.2.1 AutoField字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-CharField%E5%AD%97%E6%AE%B5"><span class="toc-text">3.2.2 CharField字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-3-DateTimeField%E5%AD%97%E6%AE%B5"><span class="toc-text">3.2.3 DateTimeField字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-4-DateField%E5%AD%97%E6%AE%B5"><span class="toc-text">3.2.4 DateField字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-5-verbose-name%E5%8F%82%E6%95%B0"><span class="toc-text">3.2.5 verbose_name参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-6-%E7%BC%96%E5%86%99%E7%A4%BA%E4%BE%8B"><span class="toc-text">3.2.6 编写示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-7-%E8%A1%A8%E5%AD%97%E6%AE%B5%E6%B3%A8%E9%87%8A"><span class="toc-text">3.2.7 表字段注释</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-Django%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB%E5%91%BD%E4%BB%A4"><span class="toc-text">3.3 Django数据库迁移命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-%E7%94%9F%E6%88%90%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95"><span class="toc-text">3.3.1 生成迁移记录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-2-%E6%9F%A5%E7%9C%8B%E7%9C%9F%E6%AD%A3%E7%9A%84%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="toc-text">3.3.2 查看真正的建表语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-%E7%9C%9F%E6%AD%A3%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">3.3.3 真正同步数据到数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-4-migrate%E4%B8%8D%E6%88%90%E5%8A%9F%E5%8E%9F%E5%9B%A0"><span class="toc-text">3.3.4 migrate不成功原因</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-ORM%E7%9A%84%E4%BC%98%E5%8C%96%E7%82%B9"><span class="toc-text">3.4 ORM的优化点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-ORM%E5%AD%97%E6%AE%B5%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-text">3.5 ORM字段的增删改查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-ORM%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E5%8A%A0"><span class="toc-text">3.6 ORM表数据的增加</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-1-%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-text">3.6.1 增加数据</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-ORM%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-text">3.7 ORM表数据的删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-ORM%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9B%B4%E6%94%B9"><span class="toc-text">3.8 ORM表数据的更改</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-8-1-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE-%E6%8E%A8%E8%8D%90"><span class="toc-text">3.8.1 更新数据(推荐)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-8-2-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE-%E4%B8%8D%E6%8E%A8%E8%8D%90"><span class="toc-text">3.8.2 更新数据(不推荐)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-ORM%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.9 ORM表数据的查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-9-1-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E4%B8%8D%E8%B0%83%E7%94%A8first%E6%96%B9%E6%B3%95"><span class="toc-text">3.9.1 查询数据不调用first方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-9-2-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E8%B0%83%E7%94%A8first%E6%96%B9%E6%B3%95"><span class="toc-text">3.9.2 查询数据调用first方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-9-3-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE-%E4%B8%8D%E6%8E%A8%E8%8D%90"><span class="toc-text">3.9.3 查询所有数据(不推荐)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-9-4-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE-%E6%8E%A8%E8%8D%90"><span class="toc-text">3.9.4 查询所有数据(推荐)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-9-5-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">3.9.5 查询数据注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A13%E6%9D%A1"><span class="toc-text">3.10 必知必会13条</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.11 双下划线查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-12-%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">3.12 多表操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-13-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-text">3.13 批量操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">4、数据序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81pymysql%E5%87%BA%E7%8E%B0%E8%B6%85%E6%97%B6"><span class="toc-text">5、pymysql出现超时</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81forms%E7%BB%84%E4%BB%B6"><span class="toc-text">四、forms组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81forms"><span class="toc-text">1、forms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81forms%E6%A0%A1%E9%AA%8C%E5%8F%82%E6%95%B0"><span class="toc-text">2、forms校验参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81cookie%E5%92%8Csession"><span class="toc-text">五、cookie和session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81cookie%E5%92%8Csession"><span class="toc-text">1、cookie和session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Django%E6%93%8D%E4%BD%9Ccookie"><span class="toc-text">2、Django操作cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%AE%BE%E7%BD%AEcookie"><span class="toc-text">2.1 设置cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-1-%E8%AE%BE%E7%BD%AEcookie%E7%A4%BA%E4%BE%8B"><span class="toc-text">2.1.1 设置cookie示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%8E%B7%E5%8F%96cookie"><span class="toc-text">2.2 获取cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-cookie%E7%BB%B4%E6%8C%81%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81"><span class="toc-text">2.2.1 cookie维持登录状态</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-cookie%E8%AE%BE%E7%BD%AE%E6%9C%89%E6%95%88%E6%9C%9F"><span class="toc-text">2.3 cookie设置有效期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%88%A0%E9%99%A4cookie"><span class="toc-text">2.4 删除cookie</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81Django%E6%93%8D%E4%BD%9Csession"><span class="toc-text">3、Django操作session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81Django%E8%A7%A3%E5%86%B3%E5%89%8D%E7%AB%AF%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-text">4、Django解决前端跨域问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%AE%89%E8%A3%85%E8%B7%A8%E5%9F%9F%E7%BB%84%E4%BB%B6"><span class="toc-text">4.1 安装跨域组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E4%BF%AE%E6%94%B9settings-py"><span class="toc-text">4.2 修改settings.py</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Django%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">六、Django中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81"><span class="toc-text">1、接口限流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%85%A8%E5%B1%80%E9%99%90%E6%B5%81"><span class="toc-text">1.1 全局限流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%B1%80%E9%83%A8%E9%99%90%E6%B5%81"><span class="toc-text">1.2 局部限流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-IP%E9%99%90%E6%B5%81"><span class="toc-text">1.3 IP限流</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81trace%E8%B7%9F%E8%B8%AA"><span class="toc-text">2、trace跟踪</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%94%9F%E6%88%90traceId"><span class="toc-text">2.1 生成traceId</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%87%AA%E5%AE%9A%E4%B9%89trace%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2.2 自定义trace中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2.2.1 编写自定义中间件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-2-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2.2.2 配置自定义中间件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%E4%B8%AD%E5%A4%84%E7%90%86traceId"><span class="toc-text">2.3 视图函数中处理traceId</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E6%9F%A5%E7%9C%8B%E5%93%8D%E5%BA%94%E8%BF%94%E5%9B%9EtraceId"><span class="toc-text">2.4 查看响应返回traceId</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BF%AE%E6%94%B9%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="toc-text">2.5 自定义中间件修改响应对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Django%E4%BD%BF%E7%94%A8Gunicorn%E9%83%A8%E7%BD%B2"><span class="toc-text">七、Django使用Gunicorn部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Gunicorn%E4%BB%8B%E7%BB%8D"><span class="toc-text">1、Gunicorn介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gunicorn-%E5%92%8C-WSGI-%E7%AE%80%E4%BB%8B"><span class="toc-text">Gunicorn 和 WSGI 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%AE%89%E8%A3%85Gunicorn"><span class="toc-text">1.1 安装Gunicorn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Django%E4%BD%BF%E7%94%A8Gunicorn"><span class="toc-text">1.2 Django使用Gunicorn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-Django%E8%87%AA%E5%B8%A6server%E5%90%AF%E5%8A%A8"><span class="toc-text">1.3 Django自带server启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-requirement%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96"><span class="toc-text">1.4 requirement管理项目依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81uwsgi%E9%83%A8%E7%BD%B2"><span class="toc-text">2、uwsgi部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-x-%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-text">2.x 问题解决</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/28/java/Mybatis%E4%BD%BF%E7%94%A8/Mybatis%E4%BD%BF%E7%94%A8/" title="Mybatis使用"><img src="/img/index.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mybatis使用"/></a><div class="content"><a class="title" href="/2024/09/28/java/Mybatis%E4%BD%BF%E7%94%A8/Mybatis%E4%BD%BF%E7%94%A8/" title="Mybatis使用">Mybatis使用</a><time datetime="2024-09-27T18:33:26.000Z" title="发表于 2024-09-28 02:33:26">2024-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/28/java/Maven%E4%BD%BF%E7%94%A8/Maven%E4%BD%BF%E7%94%A8/" title="Maven使用"><img src="/source/posts_cover_img/java/maven-logo-black-on-white.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Maven使用"/></a><div class="content"><a class="title" href="/2024/09/28/java/Maven%E4%BD%BF%E7%94%A8/Maven%E4%BD%BF%E7%94%A8/" title="Maven使用">Maven使用</a><time datetime="2024-09-27T18:23:10.000Z" title="发表于 2024-09-28 02:23:10">2024-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/22/java/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" title="Java基础语法"><img src="/posts_cover_img/java/java_logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java基础语法"/></a><div class="content"><a class="title" href="/2024/09/22/java/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" title="Java基础语法">Java基础语法</a><time datetime="2024-09-22T07:08:33.000Z" title="发表于 2024-09-22 15:08:33">2024-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/17/golang/kafka%E4%BD%BF%E7%94%A8/kafka%E4%BD%BF%E7%94%A8/" title="kafka使用"><img src="/posts_cover_img/golang/kafka_logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kafka使用"/></a><div class="content"><a class="title" href="/2024/09/17/golang/kafka%E4%BD%BF%E7%94%A8/kafka%E4%BD%BF%E7%94%A8/" title="kafka使用">kafka使用</a><time datetime="2024-09-17T01:48:14.000Z" title="发表于 2024-09-17 09:48:14">2024-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/11/golang/elasticsearch/elasticsearch%E4%BD%BF%E7%94%A8/" title="elasticsearch使用"><img src="/posts_cover_img/golang/elastic.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="elasticsearch使用"/></a><div class="content"><a class="title" href="/2024/09/11/golang/elasticsearch/elasticsearch%E4%BD%BF%E7%94%A8/" title="elasticsearch使用">elasticsearch使用</a><time datetime="2024-09-11T05:49:03.000Z" title="发表于 2024-09-11 13:49:03">2024-09-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/posts_cover_img/python/django.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By 刘阳</div><div class="footer_custom_text">努力终会有回报</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="/pluginsSrc/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>